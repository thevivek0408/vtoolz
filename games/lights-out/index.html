<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Lights Out</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0f0f1a;color:#e0e0e0;font-family:'Segoe UI',Arial,sans-serif;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:16px;user-select:none}
h1{font-size:1.5rem;margin-bottom:8px;background:linear-gradient(135deg,#f1c40f,#f39c12);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}
.info{color:#888;font-size:.85rem;margin-bottom:12px;text-align:center}
.stats{display:flex;gap:12px;margin-bottom:14px;flex-wrap:wrap;justify-content:center;font-size:.85rem}
.stat{background:#1a1a2e;padding:8px 16px;border-radius:20px;border:1px solid #333}
.stat b{color:#f1c40f}
.size-sel{display:flex;gap:6px;margin-bottom:12px}
.size-sel button{background:#1e1e3a;border:1px solid #444;color:#aaa;padding:5px 14px;border-radius:6px;cursor:pointer;font-size:.8rem;transition:all .2s}
.size-sel button.active{border-color:#f1c40f;color:#f1c40f}
.board{display:inline-grid;gap:4px}
.cell{aspect-ratio:1;border-radius:8px;cursor:pointer;transition:all .15s;border:2px solid transparent;width:clamp(44px,12vw,64px)}
.cell.on{background:#f1c40f;box-shadow:0 0 18px rgba(241,196,15,.5);border-color:#f39c12}
.cell.off{background:#1a1a2e;border-color:#2a2a4e}
.cell:active{transform:scale(.92)}
.controls{margin-top:14px;display:flex;gap:8px}
.controls button{background:#1e1e3a;border:1px solid #444;color:#e0e0e0;padding:8px 20px;border-radius:8px;cursor:pointer;font-size:.85rem;transition:all .2s}
.controls button:hover{background:#f39c12;border-color:#f39c12;color:#000}
.win{display:none;font-size:1.3rem;color:#f1c40f;margin-top:14px;text-align:center}
.win.show{display:block}
</style>
</head>
<body>
<h1>Lights Out</h1>
<div class="info">Toggle all lights OFF to win!<br>Clicking a cell toggles it and its neighbors.</div>
<div class="size-sel" id="sizes"></div>
<div class="stats">
  <div class="stat">Moves: <b id="moves">0</b></div>
  <div class="stat">Level: <b id="level">1</b></div>
  <div class="stat">Best: <b id="best">-</b></div>
</div>
<div class="board" id="board"></div>
<div class="controls">
  <button onclick="newPuzzle()">New Puzzle</button>
  <button onclick="resetPuzzle()">Reset</button>
</div>
<div class="win" id="win">ðŸŽ‰ Lights Out! Solved!</div>
<script>
let size=5,grid=[],initial=[],moves=0,lvl=1,solved=false;
const SIZES=[3,4,5,6,7];

function buildSizeButtons(){
  const el=document.getElementById('sizes');el.innerHTML='';
  SIZES.forEach(s=>{
    const b=document.createElement('button');b.textContent=s+'Ã—'+s;
    if(s===size)b.classList.add('active');
    b.addEventListener('click',()=>{size=s;lvl=1;newPuzzle();buildSizeButtons()});
    el.appendChild(b);
  });
}

function newPuzzle(){
  moves=0;solved=false;
  document.getElementById('moves').textContent=0;
  document.getElementById('level').textContent=lvl;
  document.getElementById('win').classList.remove('show');
  // Generate solvable puzzle by random clicks from solved state
  grid=Array.from({length:size},()=>Array(size).fill(false));
  let numClicks=Math.min(lvl+2,size*size);
  for(let i=0;i<numClicks;i++){
    let r=Math.floor(Math.random()*size),c=Math.floor(Math.random()*size);
    toggle(r,c,true);
  }
  // Make sure it's not already solved
  if(grid.every(row=>row.every(v=>!v))){
    toggle(Math.floor(size/2),Math.floor(size/2),true);
  }
  initial=grid.map(r=>[...r]);
  updateBest();
  render();
}

function resetPuzzle(){
  grid=initial.map(r=>[...r]);moves=0;solved=false;
  document.getElementById('moves').textContent=0;
  document.getElementById('win').classList.remove('show');
  render();
}

function toggle(r,c,silent){
  const dirs=[[0,0],[-1,0],[1,0],[0,-1],[0,1]];
  dirs.forEach(([dr,dc])=>{
    let nr=r+dr,nc=c+dc;
    if(nr>=0&&nr<size&&nc>=0&&nc<size)grid[nr][nc]=!grid[nr][nc];
  });
  if(!silent){
    moves++;document.getElementById('moves').textContent=moves;
    if(grid.every(row=>row.every(v=>!v))){
      solved=true;
      document.getElementById('win').classList.add('show');
      let key='lo_best_'+size+'_'+lvl;
      let b=localStorage.getItem(key);
      if(!b||moves<+b)localStorage.setItem(key,moves);
      updateBest();
      setTimeout(()=>{lvl++;newPuzzle()},1500);
    }
  }
}

function updateBest(){
  let key='lo_best_'+size+'_'+lvl;
  let b=localStorage.getItem(key);
  document.getElementById('best').textContent=b||'-';
}

function render(){
  const board=document.getElementById('board');board.innerHTML='';
  board.style.gridTemplateColumns=`repeat(${size},clamp(44px,12vw,64px))`;
  for(let r=0;r<size;r++){
    for(let c=0;c<size;c++){
      const cell=document.createElement('div');
      cell.className='cell '+(grid[r][c]?'on':'off');
      cell.addEventListener('click',()=>{
        if(solved)return;toggle(r,c);render();
      });
      board.appendChild(cell);
    }
  }
}

buildSizeButtons();newPuzzle();
</script>
</body>
</html>
