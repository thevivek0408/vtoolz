<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibox Arcade - 200+ Free Offline Games</title>
    <link rel="icon" href="../favicon.png" type="image/png">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <header>
        <div class="container">
            <a href="../index.html" class="logo">Vibox</a>
            <nav>
                <ul>
                    <li><a href="../index.html"><i class="fas fa-home"></i> Home</a></li>
                    <li><a href="index.html" class="active"><i class="fas fa-gamepad"></i> Games</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <div class="games-header">
            <div class="container">
                <h1>üéÆ Vibox Arcade</h1>
                <p>200+ Free Offline Games. No Ads. No Tracking.</p>

                <div class="search-container">
                    <input type="text" id="gameSearch" placeholder="Search games (e.g. Sudoku, Snake)...">
                    <select id="categoryFilter">
                        <option value="all">All Categories</option>
                        <option value="arcade">Arcade</option>
                        <option value="puzzle">Puzzle</option>
                        <option value="card">Card</option>
                        <option value="word">Word</option>
                        <option value="strategy">Strategy</option>
                        <option value="sports">Sports</option>
                        <option value="brain">Brain</option>
                        <option value="two-player">Two Player</option>
                    </select>
                </div>
            </div>
        </div>

        <section class="container">
            <div id="gamesGrid" class="games-grid">
                <!-- Games will be loaded here -->
                <div class="loading-spinner">Loading 200+ Games...</div>
            </div>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const container = document.getElementById('gamesGrid'); // Renaming logically in head, but purely ID based here
            // Actually I need to replace the container logic
            const mainContainer = document.querySelector('main .container');
            const searchInput = document.getElementById('gameSearch');
            // Remove filter dropdown (since we are grouping by default) or keep it to jump?
            // Let's keep it to filter the groups.
            const categoryFilter = document.getElementById('categoryFilter');

            // Clear initial loading
            const loading = document.querySelector('.loading-spinner');
            if (loading) loading.remove();

            let allGames = [];

            try {
                const response = await fetch('data/games-config.json');
                allGames = await response.json();
                renderCategorized(allGames);
            } catch (error) {
                mainContainer.innerHTML += '<p class="error">Failed to load games database.</p>';
                console.error(error);
            }

            // Search & Filter
            function filterGames() {
                const term = searchInput.value.toLowerCase();
                const cat = categoryFilter.value;

                const filtered = allGames.filter(game => {
                    const matchesSearch = game.name.toLowerCase().includes(term);
                    const matchesCat = cat === 'all' || game.category === cat;
                    return matchesSearch && matchesCat;
                });

                renderCategorized(filtered, term !== '' || cat !== 'all');
            }

            searchInput.addEventListener('input', filterGames);
            categoryFilter.addEventListener('change', filterGames);

            function renderCategorized(games, isFiltered) {
                // Clear existing game grids
                const existingSections = document.querySelectorAll('.game-category-section');
                existingSections.forEach(s => s.remove());

                const gridPlacement = document.getElementById('gamesGrid');
                if (gridPlacement) gridPlacement.style.display = 'none'; // Hide default grid container

                if (games.length === 0) {
                    // Show no results
                    return;
                }

                // If filtered, maybe just show a single grid?
                // The user asked to "arrange by category".
                // Even when filtered, we can keep categories or just list results.
                // Let's Show List if searching, Categories if browsing.

                if (isFiltered) {
                    if (gridPlacement) {
                        gridPlacement.style.display = 'grid';
                        gridPlacement.innerHTML = '';
                        games.forEach(g => gridPlacement.appendChild(createGameCard(g)));
                    }
                    return;
                }

                // Group by Category
                const categories = {
                    'arcade': 'üïπÔ∏è Arcade',
                    'puzzle': 'üß© Puzzle',
                    'card': 'üÉè Card & Solitaire',
                    'word': 'üìù Word Games',
                    'strategy': '‚ôüÔ∏è Strategy',
                    'two-player': 'üë• Two Player',
                    'brain': 'üß† Brain Training',
                    'sports': '‚öΩ Sports',
                    'other': 'üéÆ Other'
                };

                // Get unique categories present in games list
                const presentCats = [...new Set(games.map(g => g.category))];

                // Sort categories manually or alphabetically? Manual order is better
                const order = ['arcade', 'puzzle', 'card', 'two-player', 'word', 'brain', 'strategy', 'sports'];

                order.forEach(catKey => {
                    if (presentCats.includes(catKey)) {
                        renderSection(catKey, categories[catKey] || catKey.toUpperCase(), games.filter(g => g.category === catKey));
                    }
                });

                // Others
                const leftovers = games.filter(g => !order.includes(g.category));
                if (leftovers.length > 0) {
                    renderSection('other', 'Other Games', leftovers);
                }
            }

            function renderSection(id, title, matches) {
                const section = document.createElement('section');
                section.className = 'container game-category-section';
                section.style.marginTop = '40px';

                section.innerHTML = `
                    <h2 class="category-title">${title} <span style="font-size:0.6em; opacity:0.6; margin-left:10px;">(${matches.length})</span></h2>
                    <div class="games-grid"></div>
                `;

                const grid = section.querySelector('.games-grid');
                matches.forEach(g => grid.appendChild(createGameCard(g)));

                mainContainer.appendChild(section);
            }

            function createGameCard(game) {
                const card = document.createElement('a');
                card.className = 'game-card';
                card.href = `play.html?id=${game.id}`;

                let icon = 'üéÆ';
                let color = '#3498db';

                if (game.category === 'arcade') { icon = 'üïπÔ∏è'; color = '#e74c3c'; }
                if (game.category === 'puzzle') { icon = 'üß©'; color = '#9b59b6'; }
                if (game.category === 'card') { icon = 'üÉè'; color = '#2ecc71'; }
                if (game.category === 'word') { icon = 'üìù'; color = '#f1c40f'; }
                if (game.category === 'strategy') { icon = '‚ôüÔ∏è'; color = '#34495e'; }
                if (game.category === 'sports') { icon = '‚öΩ'; color = '#e67e22'; }
                if (game.category === 'two-player') { icon = 'üë•'; color = '#e67e22'; }

                if (game.name.includes('Snake')) icon = 'üêç';
                if (game.name.includes('Sudoku')) icon = 'üî¢';
                if (game.name.includes('Solitaire')) icon = 'üÇ°';
                if (game.name.includes('Chess')) icon = '‚ôüÔ∏è';
                if (game.name.includes('Checkers')) icon = 'üèÅ';
                if (game.name.includes('Connect')) icon = 'üî¥';

                card.innerHTML = `
                    <div class="game-thumbnail" style="background: ${color}; color: white;">${icon}</div>
                    <div class="game-info">
                        <div class="game-title">${game.name}</div>
                        <div class="game-meta">
                            <span class="tag ${game.mode}">${game.category}</span>
                        </div>
                    </div>
                `;
                return card;
            }
        });
    </script>
</body>

</html>