<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibox Arcade - 200+ Free Offline Games</title>
    <link rel="icon" href="../favicon.png" type="image/png">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <header>
        <div class="container">
            <a href="../index.html" class="logo">Vibox</a>
            <nav>
                <ul>
                    <li><a href="../index.html"><i class="fas fa-home"></i> Home</a></li>
                    <li><a href="index.html" class="active"><i class="fas fa-gamepad"></i> Games</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <div class="games-header">
            <div class="container">
                <h1>üéÆ Vibox Arcade</h1>
                <p>200+ Free Offline Games. No Ads. No Tracking.</p>

                <div class="search-container">
                    <input type="text" id="gameSearch" placeholder="Search games (e.g. Sudoku, Snake)...">
                    <select id="categoryFilter">
                        <option value="all">All Categories</option>
                        <option value="arcade">Arcade</option>
                        <option value="puzzle">Puzzle</option>
                        <option value="card">Card</option>
                        <option value="word">Word</option>
                        <option value="strategy">Strategy</option>
                        <option value="sports">Sports</option>
                        <option value="brain">Brain</option>
                        <option value="two-player">Two Player</option>
                    </select>
                </div>
            </div>
        </div>

        <section class="container">
            <div id="gamesGrid" class="games-grid">
                <!-- Games will be loaded here -->
                <div class="loading-spinner">Loading 200+ Games...</div>
            </div>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const grid = document.getElementById('gamesGrid');
            const searchInput = document.getElementById('gameSearch');
            const categoryFilter = document.getElementById('categoryFilter');

            let allGames = [];

            try {
                const response = await fetch('data/games-config.json');
                allGames = await response.json();
                renderGames(allGames);
            } catch (error) {
                grid.innerHTML = '<p class="error">Failed to load games database.</p>';
                console.error(error);
            }

            // Search & Filter
            function filterGames() {
                const term = searchInput.value.toLowerCase();
                const cat = categoryFilter.value;

                const filtered = allGames.filter(game => {
                    const matchesSearch = game.name.toLowerCase().includes(term);
                    const matchesCat = cat === 'all' || game.category === cat;
                    return matchesSearch && matchesCat;
                });

                renderGames(filtered);
            }

            searchInput.addEventListener('input', filterGames);
            categoryFilter.addEventListener('change', filterGames);

            function renderGames(games) {
                grid.innerHTML = '';

                if (games.length === 0) {
                    grid.innerHTML = '<p class="no-results">No games found.</p>';
                    return;
                }

                games.forEach(game => {
                    const card = document.createElement('a');
                    card.className = 'game-card';
                    card.href = `play.html?id=${game.id}`;

                    // Engine status check
                    const isStub = ['word', 'turn', 'physics', 'idle'].includes(game.engine);
                    if (isStub) {
                        // card.classList.add('coming-soon'); 
                        // Actually, I stubbed them so they ARE playable (display text), 
                        // but maybe we mark them differently?
                        // User wants "Games Platform" so let's make them look active.
                    }

                    // Icon/Thumbnail generation based on category/name
                    let icon = 'üéÆ';
                    let color = '#3498db';

                    if (game.category === 'arcade') { icon = 'üïπÔ∏è'; color = '#e74c3c'; }
                    if (game.category === 'puzzle') { icon = 'üß©'; color = '#9b59b6'; }
                    if (game.category === 'card') { icon = 'üÉè'; color = '#2ecc71'; }
                    if (game.category === 'word') { icon = 'üìù'; color = '#f1c40f'; }
                    if (game.category === 'strategy') { icon = '‚ôüÔ∏è'; color = '#34495e'; }
                    if (game.category === 'sports') { icon = '‚öΩ'; color = '#e67e22'; }
                    if (game.name.includes('Snake')) icon = 'üêç';
                    if (game.name.includes('Sudoku')) icon = 'üî¢';
                    if (game.name.includes('Solitaire')) icon = 'üÇ°';

                    card.innerHTML = `
                        <div class="game-thumbnail" style="background: ${color}; color: white;">${icon}</div>
                        <div class="game-info">
                            <div class="game-title">${game.name}</div>
                            <div class="game-meta">
                                <span class="tag ${game.mode}">${game.category}</span>
                            </div>
                        </div>
                    `;

                    grid.appendChild(card);
                });
            }
        });
    </script>
</body>

</html>