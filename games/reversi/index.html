<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Reversi</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0f0f1a;color:#e0e0e0;font-family:'Segoe UI',Arial,sans-serif;display:flex;flex-direction:column;align-items:center;min-height:100vh;padding:16px;user-select:none}
h1{font-size:1.5rem;margin-bottom:8px;background:linear-gradient(135deg,#6c5ce7,#a29bfe);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}
.stats{display:flex;gap:12px;margin-bottom:10px;font-size:.85rem;flex-wrap:wrap;justify-content:center}
.stat{background:#1a1a2e;padding:8px 16px;border-radius:20px;border:1px solid #333;display:flex;align-items:center;gap:6px}
.disc-b{width:16px;height:16px;border-radius:50%;background:#1a1a2e;border:2px solid #fff}
.disc-w{width:16px;height:16px;border-radius:50%;background:#fff}
.stat b{color:#a29bfe}
.msg{min-height:1.2em;margin-bottom:8px;font-size:.9rem;color:#a29bfe}
.board{display:inline-grid;grid-template-columns:repeat(8,clamp(36px,8vw,50px));gap:2px;background:#1a6b1a;padding:4px;border-radius:8px;border:2px solid #0d4d0d}
.cell{width:clamp(36px,8vw,50px);height:clamp(36px,8vw,50px);display:flex;align-items:center;justify-content:center;background:#2d8a2d;border-radius:4px;cursor:pointer;transition:all .15s;position:relative}
.cell:hover{background:#3a9a3a}
.cell.valid::after{content:'';width:30%;height:30%;border-radius:50%;background:#ffffff33;position:absolute}
.piece{width:80%;height:80%;border-radius:50%;transition:all .3s;box-shadow:0 2px 4px #0008}
.piece.black{background:radial-gradient(circle at 35% 35%,#444,#111)}
.piece.white{background:radial-gradient(circle at 35% 35%,#fff,#ccc)}
.piece.flip{animation:flip .4s ease}
@keyframes flip{0%{transform:scaleX(1)}50%{transform:scaleX(0)}100%{transform:scaleX(1)}}
.controls{margin-top:10px}
.controls button{background:#1e1e3a;border:1px solid #444;color:#e0e0e0;padding:8px 20px;border-radius:8px;cursor:pointer;font-size:.85rem}
.controls button:hover{background:#6c5ce7;border-color:#6c5ce7;color:#fff}
</style>
</head>
<body>
<h1>Reversi</h1>
<div class="stats">
  <div class="stat"><div class="disc-b"></div>You: <b id="bCount">2</b></div>
  <div class="stat"><div class="disc-w"></div>AI: <b id="wCount">2</b></div>
  <div class="stat">Turn: <b id="turn">You</b></div>
</div>
<div class="msg" id="msg"></div>
<div class="board" id="board"></div>
<div class="controls"><button onclick="newGame()">New Game</button></div>
<script>
const SZ=8,B=1,W=2,DIRS=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];
let board,turn,gameOver;

function newGame(){
  board=Array.from({length:SZ},()=>Array(SZ).fill(0));
  board[3][3]=W;board[3][4]=B;board[4][3]=B;board[4][4]=W;
  turn=B;gameOver=false;
  document.getElementById('msg').textContent='';
  render();
}

function getFlips(b,r,c,player){
  if(b[r][c]!==0)return[];
  let opp=player===B?W:B,allFlips=[];
  DIRS.forEach(([dr,dc])=>{
    let flips=[],nr=r+dr,nc=c+dc;
    while(nr>=0&&nr<SZ&&nc>=0&&nc<SZ&&b[nr][nc]===opp){
      flips.push([nr,nc]);nr+=dr;nc+=dc;
    }
    if(flips.length>0&&nr>=0&&nr<SZ&&nc>=0&&nc<SZ&&b[nr][nc]===player){
      allFlips.push(...flips);
    }
  });
  return allFlips;
}

function getValidMoves(b,player){
  let moves=[];
  for(let r=0;r<SZ;r++)for(let c=0;c<SZ;c++){
    let f=getFlips(b,r,c,player);
    if(f.length)moves.push({r,c,flips:f});
  }
  return moves;
}

function makeMove(r,c){
  if(gameOver||turn!==B)return;
  let flips=getFlips(board,r,c,B);
  if(!flips.length)return;
  board[r][c]=B;
  flips.forEach(([fr,fc])=>board[fr][fc]=B);
  render();
  turn=W;
  document.getElementById('turn').textContent='AI';
  checkTurn();
}

function aiMove(){
  if(gameOver)return;
  let moves=getValidMoves(board,W);
  if(!moves.length){turn=B;document.getElementById('turn').textContent='You';checkTurn();return}
  // Weighted: corners > edges > center
  const weights=[[100,-20,10,5,5,10,-20,100],[-20,-50,-2,-2,-2,-2,-50,-20],[10,-2,1,1,1,1,-2,10],[5,-2,1,0,0,1,-2,5],[5,-2,1,0,0,1,-2,5],[10,-2,1,1,1,1,-2,10],[-20,-50,-2,-2,-2,-2,-50,-20],[100,-20,10,5,5,10,-20,100]];
  // Minimax-lite: evaluate each move by flips + position weight
  let best=moves[0],bestScore=-Infinity;
  moves.forEach(m=>{
    let score=m.flips.length*2+weights[m.r][m.c];
    // Look one step ahead
    let tmpBoard=board.map(r=>[...r]);
    tmpBoard[m.r][m.c]=W;
    m.flips.forEach(([fr,fc])=>tmpBoard[fr][fc]=W);
    let oppMoves=getValidMoves(tmpBoard,B);
    let oppBest=oppMoves.reduce((a,om)=>Math.max(a,om.flips.length+weights[om.r][om.c]),0);
    score-=oppBest*0.7;
    if(score>bestScore){bestScore=score;best=m}
  });
  board[best.r][best.c]=W;
  best.flips.forEach(([fr,fc])=>board[fr][fc]=W);
  turn=B;
  document.getElementById('turn').textContent='You';
  render();
  checkTurn();
}

function checkTurn(){
  let bMoves=getValidMoves(board,B);
  let wMoves=getValidMoves(board,W);
  if(!bMoves.length&&!wMoves.length){endGame();return}
  if(turn===B&&!bMoves.length){
    document.getElementById('msg').textContent='No moves â€” AI\'s turn';
    turn=W;document.getElementById('turn').textContent='AI';
    setTimeout(aiMove,600);return;
  }
  if(turn===W&&!wMoves.length){
    document.getElementById('msg').textContent='AI has no moves â€” your turn';
    turn=B;document.getElementById('turn').textContent='You';
    render();return;
  }
  if(turn===W)setTimeout(aiMove,500);
  else render();
}

function endGame(){
  gameOver=true;
  let bC=0,wC=0;
  for(let r=0;r<SZ;r++)for(let c=0;c<SZ;c++){if(board[r][c]===B)bC++;if(board[r][c]===W)wC++}
  let msg=bC>wC?'ðŸŽ‰ You win!':wC>bC?'ðŸ’€ AI wins!':'ðŸ¤ Draw!';
  document.getElementById('msg').textContent=`Game Over â€” ${msg} (${bC} vs ${wC})`;
  document.getElementById('turn').textContent='â€”';
}

function render(){
  const el=document.getElementById('board');el.innerHTML='';
  let bC=0,wC=0;
  let validMoves=turn===B?getValidMoves(board,B):[];
  let validSet=new Set(validMoves.map(m=>m.r*SZ+m.c));
  for(let r=0;r<SZ;r++){
    for(let c=0;c<SZ;c++){
      const cell=document.createElement('div');cell.className='cell';
      if(board[r][c]===B){bC++;const p=document.createElement('div');p.className='piece black';cell.appendChild(p)}
      else if(board[r][c]===W){wC++;const p=document.createElement('div');p.className='piece white';cell.appendChild(p)}
      else if(validSet.has(r*SZ+c)){cell.classList.add('valid');cell.onclick=()=>makeMove(r,c)}
      el.appendChild(cell);
    }
  }
  document.getElementById('bCount').textContent=bC;
  document.getElementById('wCount').textContent=wC;
}

newGame();
</script>
</body>
</html>
