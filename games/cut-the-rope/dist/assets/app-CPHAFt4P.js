import{A as e,D as t,Jn as n,Kn as r,O as i,Rn as a,S as o,T as s,Yn as c,_ as l,a as u,c as d,d as f,f as p,i as m,k as h,l as g,n as _,o as v,qn as y,r as b,s as x,t as S,u as C,v as w,w as T,x as E,y as D}from"./Doors-iAfFIQWS.js";import{C as ee,D as te,E as ne,O as re,S as O,T as k,_ as ie,a as ae,b as oe,c as se,d as A,f as j,g as ce,h as M,i as N,l as le,m as P,n as ue,o as F,p as de,r as fe,s as pe,t as me,u as I,v as he,w as ge,x as _e,y as ve}from"./GameScene-BRMWkQVQ.js";var ye=(e,t)=>new Promise((n,r)=>{let i;try{i=e.decodeAudioData(t,e=>n(e),e=>r(e))}catch(e){r(e);return}i&&typeof i.then==`function`&&i.then(n).catch(r)}),be=new class{completeListeners=[];progressListeners=[];startRequested=!1;soundManagerReady=!1;hasStartedLoading=!1;currentCompleted=0;currentFailed=0;currentTotal=0;constructor(){ne.onReady(()=>{this.soundManagerReady=!0,this.startIfReady()})}start(){this.startRequested=!0,this.startIfReady()}onMenuComplete(e){this.completeListeners.push(e)}onProgress(e){if(this.progressListeners.push(e),this.currentTotal>0)try{e(this.currentCompleted,this.currentTotal)}catch(e){window.console?.error?.(`Sound progress listener failed`,e)}}getSoundCount(){return o.menuSoundIds.length+o.gameSoundIds.length}startIfReady=async()=>{if(!this.startRequested||!this.soundManagerReady||this.hasStartedLoading)return;this.hasStartedLoading=!0;let e=v.audioBaseUrl,t=v.getAudioExtension(),n=re(),r=[...o.menuSoundIds.map(e=>({id:e,tag:`MENU`})),...o.gameSoundIds.map(e=>({id:e,tag:`GAME`}))];this.currentTotal=r.length,this.currentCompleted=0,this.currentFailed=0;let i=()=>{for(let e of this.progressListeners)try{e(this.currentCompleted,this.currentTotal)}catch(e){window.console?.error?.(`Sound progress listener failed`,e)}},a=()=>{for(let e of this.completeListeners)try{e()}catch(e){window.console?.error?.(`Sound completion listener failed`,e)}};if(!n||this.currentTotal===0){this.currentCompleted=this.currentTotal,i(),a();return}let s=async({id:r})=>{let i=h[r];if(!i)throw Error(`Resource not found for sound ID: ${r}`);let a=`s${r}`,o=e+i.path+t,s=await fetch(o);if(!s.ok)throw Error(`Failed to load audio: ${s.status} ${s.statusText}`);let c=await ye(n,await s.arrayBuffer()),l=n.createGain();l.connect(n.destination),te.set(a,{buffer:c,gainNode:l,playingSources:new Set,isPaused:!1,volume:1})};await Promise.all(r.map(e=>s(e).then(()=>{this.currentCompleted++,i()}).catch(t=>{this.currentFailed++,window.console?.error?.(`Failed to load audio`,e.id,t),i()}))),this.currentFailed>0&&window.console?.warn?.(`Sound loading completed with ${this.currentFailed} failure(s) out of ${this.currentTotal} total`),a()}},xe=new class{menuImagesLoadComplete=!1;menuSoundLoadComplete=!1;menuJsonLoadComplete=!1;menuCompleteLocked=!1;completeCallback=null;loadedImages=0;loadedSounds=0;loadedJsonFiles=0;failedImages=0;failedSounds=0;totalImages=0;totalSounds=0;totalJsonFiles=0;MENU_TAG=`MENU`;FONT_TAG=`FONT`;GAME_TAG=`GAME`;supportsImageBitmap=typeof createImageBitmap==`function`;getUrlFacade(){if(typeof URL<`u`&&typeof URL.createObjectURL==`function`)return URL;if(typeof window<`u`){let e=window.webkitURL;if(e&&typeof e.createObjectURL==`function`)return e}return null}async loadImageElement(e){return new Promise((t,n)=>{let r=new Image;r.decoding=`async`;let i=()=>{r.removeEventListener(`load`,a),r.removeEventListener(`error`,o)},a=()=>{i(),t(r)},o=()=>{i(),n(Error(`Failed to load image: ${e}`))};r.addEventListener(`load`,a),r.addEventListener(`error`,o),r.src=e})}async loadBitmapFromElement(e){let t=await this.loadImageElement(e);if(typeof t.decode==`function`)try{await t.decode()}catch(e){window.console?.warn?.(`Image decode failed, continuing with bitmap creation`,e)}return createImageBitmap(t)}createImageAsset(e,t){return{drawable:e,width:(`naturalWidth`in e?e.naturalWidth:e.width)??0,height:(`naturalHeight`in e?e.naturalHeight:e.height)??0,sourceUrl:t}}async fetchImageBlob(e){let t=await fetch(e);if(!t.ok)throw Error(`Request failed with status ${t.status}`);return t.blob()}async loadImageFromBlob(e,t){let n=this.getUrlFacade();if(!n){if(t)return this.loadImageElement(t);throw Error(`Object URL API not available`)}let r=n.createObjectURL(e);try{return await this.loadImageElement(r)}finally{n.revokeObjectURL(r)}}async loadImageAsset(e){if(!e)throw Error(`Image URL must be provided`);if(!this.supportsImageBitmap&&!this.getUrlFacade()){let t=await this.loadImageElement(e);return this.createImageAsset(t,e)}if(this.supportsImageBitmap){try{let t=await this.loadBitmapFromElement(e);return this.createImageAsset(t,e)}catch(t){window.console?.warn?.(`ImageBitmap from HTMLImageElement failed, falling back to blob`,e,t)}try{let t=await this.fetchImageBlob(e),n=await createImageBitmap(t);return this.createImageAsset(n,e)}catch(t){window.console?.warn?.(`Falling back to HTMLImageElement for`,e,t)}}let t=await this.fetchImageBlob(e),n=await this.loadImageFromBlob(t,e);return this.createImageAsset(n,e)}async loadJson(e){let t=await fetch(e);if(!t.ok)throw Error(`Request failed with status ${t.status}`);let n=await t.text();return JSON.parse(n)}updateProgress(){let e=this.totalJsonFiles>0?this.loadedJsonFiles/this.totalJsonFiles*10:0,t=this.totalImages>0?this.loadedImages/this.totalImages*60:0,n=this.totalSounds>0?this.loadedSounds/this.totalSounds*30:0,r=e+t+n;E.publish(E.ChannelId.PreloaderProgress,{progress:r})}checkMenuLoadComplete(){this.menuCompleteLocked||!this.menuImagesLoadComplete||!this.menuSoundLoadComplete||!this.menuJsonLoadComplete||((this.failedImages>0||this.failedSounds>0)&&window.console?.warn?.(`Loading completed with failures - Images: ${this.failedImages}, Sounds: ${this.failedSounds}`),this.completeCallback&&setTimeout(this.completeCallback,0),this.menuCompleteLocked=!0)}collectImageResources(e){let n=[],r=0,i=(e,t,i=null)=>{e&&(n.push({url:e,tag:t,resId:i}),(t===this.MENU_TAG||t===this.FONT_TAG)&&r++)},a=(e,t=v.uiImageBaseUrl)=>{if(!e)return;let n=Array.isArray(e)?e:[e];for(let e of n)e&&i(t+e,this.MENU_TAG)};a(o.menuImageFilenames),a(o.boxImages,v.boxImageBaseUrl),a(o.boxBorders),a(o.boxDoors),a(o.drawingImageNames),a(o.editionImages,v.resolutionBaseUrl+(o.editionImageDirectory||``));let s=(t,n)=>{if(t)for(let r of t){let t=h[r];t&&(i(e+t.path,n,r),t.atlasPath&&this.loadJson(e+t.atlasPath).then(e=>f.onAtlasLoaded(r,e)).catch(e=>f.onAtlasError(r,e)))}};return s(t.StandardFonts,this.FONT_TAG),s(o.gameImageIds,this.GAME_TAG),s(o.levelBackgroundIds,this.GAME_TAG),s(o.levelOverlayIds,this.GAME_TAG),{resources:n,menuResourceCount:r}}loadImages(){let e=`${v.imageBaseUrl}${l.CANVAS_WIDTH}/game/`,{resources:t,menuResourceCount:n}=this.collectImageResources(e),r=0,i=0,a=e=>e===this.MENU_TAG||e===this.FONT_TAG,o=()=>{this.loadedImages=r+i,this.failedImages=i,this.updateProgress(),r+i===n&&(this.menuImagesLoadComplete=!0,this.checkMenuLoadComplete())};n===0&&(this.menuImagesLoadComplete=!0,this.checkMenuLoadComplete());for(let{url:e,tag:n,resId:s}of t)this.loadImageAsset(e).then(e=>{(n===this.FONT_TAG||n===this.GAME_TAG)&&s!==null&&f.onResourceLoaded(s,e),a(n)&&r++}).catch(t=>{window.console?.error?.(`Failed to load image:`,e,t),a(n)&&i++}).finally(()=>{a(n)&&o()});return{trackedResourceCount:n}}start(){p()}domReady(){let e=document.getElementById(`betterLoader`),t=()=>this.startResourceLoading();if(!e){t();return}let n=window.getComputedStyle(e).backgroundImage.match(/url\(["']?([^"']*)["']?\)/);if(n&&n[1]){let e=new Image;e.onload=t,e.onerror=t,e.src=n[1]}else t()}run(e){this.completeCallback=e,this.checkMenuLoadComplete()}startResourceLoading(){this.totalJsonFiles=i.getJsonFileCount(),i.onProgress((e,t)=>{this.loadedJsonFiles=e,this.updateProgress()}),i.onMenuComplete(()=>{this.menuJsonLoadComplete=!0;let{trackedResourceCount:e}=this.loadImages();this.totalImages=e,this.totalSounds=be.getSoundCount(),be.onProgress((e,t)=>{this.loadedSounds=e,this.updateProgress()}),be.onMenuComplete(()=>{this.menuSoundLoadComplete=!0,this.checkMenuLoadComplete()}),be.start()}),i.start()}},Se=class{_showMiniOptionMessage(e,t,r){if(e===void 0)return;let i=r||500,a=document.getElementById(e);if(!a)return;let o=a.querySelector(`img`);o||(o=document.createElement(`img`),a.appendChild(o)),g.drawSmall({text:t,img:o,scaleToUI:!0,alpha:.6,alignment:n.LEFT}),he(a),I(a,500).then(()=>se(a,i)).then(()=>A(a,750))}_updateMiniSoundButton(e,t,n){let r=O.soundEnabled,i=O.musicEnabled;e&&(r&&i?(r=!0,i=!1):!r&&!i?(r=!0,i=!0):(r=!1,i=!1),O.setSoundEnabled(r),O.setMusicEnabled(i));let a=!r&&!i?`noSound`:r&&!i?`effectsOnly`:`allSound`,o=`effectsOnly noSound allSound`;M(`#optionSound`,o),F(`#optionSound`,a),M(`#gameSound`,o),F(`#gameSound`,a),ce(`#soundBtn .options-x`,`display`,r?`none`:`block`),ce(`#musicBtn .options-x`,`display`,i?`none`:`block`);let s;if(!i&&!r)s=d.menuText(x.EVERYTHING_OFF);else{let e=i?x.MUSIC_ON:x.MUSIC_OFF,t=r?x.SOUNDS_ON:x.SOUNDS_OFF;s=d.menuText(x.AND_TEMPLATE).replace(`{0}`,d.menuText(e).toLowerCase()).replace(`{1}`,d.menuText(t).toLowerCase())}this._showMiniOptionMessage(n,s,500)}};const Ce=(e,t)=>{g.drawBig({text:d.menuText(t),imgSel:e,scaleToUI:!0})};var we={INACTIVE:0,ACTIVE:1,PAUSED:2},Te=1/60,L=class e{static StateType=we;static StateNumType=we;controllerState;views;children;activeViewID;activeChildID;pausedViewID;parent;lastTime;delta;frames;accumDt;frameRate;frameBalance;avgDelta;pastDeltas;constructor(e){this.controllerState=we.INACTIVE,this.views=[],this.children=[],this.activeViewID=y.UNDEFINED,this.activeChildID=y.UNDEFINED,this.pausedViewID=y.UNDEFINED,this.parent=e,this.lastTime=y.UNDEFINED,this.delta=0,this.frames=0,this.accumDt=0,this.frameRate=0,this.frameBalance=0,this.avgDelta=1/60,this.pastDeltas=[this.avgDelta,this.avgDelta,this.avgDelta,this.avgDelta,this.avgDelta]}activate(){this.controllerState=e.StateType.ACTIVE,E.publish(E.ChannelId.ControllerActivated,this)}deactivate(){E.publish(E.ChannelId.ControllerDeactivateRequested,this)}deactivateImmediately(){this.controllerState=e.StateType.INACTIVE,this.activeViewID!==y.UNDEFINED&&this.hideActiveView(),E.publish(E.ChannelId.ControllerDeactivated,this),this.parent.onChildDeactivated(this.parent.activeChildID)}pause(){this.controllerState=e.StateType.PAUSED,E.publish(E.ChannelId.ControllerPaused,this),this.activeViewID!=y.UNDEFINED&&(this.pausedViewID=this.activeViewID,this.hideActiveView())}unpause(){this.controllerState=e.StateType.ACTIVE,this.activeChildID!==y.UNDEFINED&&(this.activeChildID=y.UNDEFINED),E.publish(E.ChannelId.ControllerUnpaused,this),this.pausedViewID!==y.UNDEFINED&&this.showView(this.pausedViewID)}update(){if(this.activeViewID===y.UNDEFINED)return;let e=this.activeView();if(!e)return;let t=Math.min(3,this.frameBalance|0);for(let n=0;n<t;n++)e.update(Te),--this.frameBalance}resetLastTime(){this.lastTime=y.UNDEFINED}calculateTimeDelta(e){e&&(this.delta=this.lastTime===y.UNDEFINED?0:(e-this.lastTime)/1e3,this.lastTime=e);let t=Math.min(this.delta,.05);this.frameBalance+=t/Te}clampDelta(e){return e<Te?Te:e>.05?.05:e}calculateFPS(){if(this.frames++,this.accumDt+=this.delta,this.accumDt>1){this.frameRate=this.frames/this.accumDt,this.frames=0,this.accumDt=0,this.pastDeltas.shift(),this.pastDeltas.push(this.clampDelta(1/this.frameRate)),this.avgDelta=0;let e=this.pastDeltas.length;for(let t=0;t<e;t++)this.avgDelta+=this.pastDeltas[t]??0;this.avgDelta/=e}}addView(e,t){this.views[t]=e}deleteView(e){this.views[e]=null}hideActiveView(){let e=this.views[this.activeViewID];e&&(E.publish(E.ChannelId.ControllerViewHidden,e),e.hide(),this.activeViewID=y.UNDEFINED)}showView(e){this.activeViewID!=y.UNDEFINED&&this.hideActiveView(),this.activeViewID=e;let t=this.views[e];t&&(E.publish(E.ChannelId.ControllerViewShow,t),t.show())}activeView(){return this.views[this.activeViewID]}getView(e){return this.views[e]}addChildWithID(e,t){this.children[t]=e}deleteChild(e){this.children[e]=null,this.activeChildID===e&&(this.activeChildID=y.UNDEFINED)}deactivateActiveChild(){if(this.activeChildID!==y.UNDEFINED){let e=this.children[this.activeChildID];e&&e.deactivate(),this.activeChildID=y.UNDEFINED}}activateChild(e){this.activeChildID!==y.UNDEFINED&&this.deactivateActiveChild(),this.pause(),this.activeChildID=e;let t=this.children[e];t&&t.activate()}onChildDeactivated(e){this.unpause()}activeChild(){return this.children[this.activeChildID]}getChild(e){return this.children[e]}mouseDown(e,t){if(this.activeViewID===y.UNDEFINED)return!1;let n=this.views[this.activeViewID];return n?n.onTouchDown(e,t):!1}mouseUp(e,t){if(this.activeViewID===y.UNDEFINED)return!1;let n=this.views[this.activeViewID];return n?n.onTouchUp(e,t):!1}mouseDragged(e,t){if(this.activeViewID===y.UNDEFINED)return!1;let n=this.views[this.activeViewID];return n?n.onTouchMove(e,t):!1}mouseMoved(e,t){return!1}doubleClick(e,t){if(this.activeViewID===y.UNDEFINED)return!1;let n=this.views[this.activeViewID];return n?n.onDoubleClick(e,t):!1}},Ee=.3,De={SLIDE_HORIZONTAL_RIGHT:0,SLIDE_HORIZONTAL_LEFT:1,SLIDE_VERTICAL_UP:2,SLIDE_VERTICAL_DOWN:3,FADE_OUT_BLACK:4,FADE_OUT_WHITE:5,REVEAL:6,COUNT:7},Oe=class extends L{static ViewTransition=De;suspended;currentController;viewTransition;transitionTime;previousView;transitionDelay;deactivateCurrentController;dragMode;controllerSubscriptions;pointerCapture;stopAnimation;idealDelta;constructor(e){super(e),this.suspended=!1,this.currentController=null,this.viewTransition=y.UNDEFINED,this.transitionTime=y.UNDEFINED,this.previousView=null,this.transitionDelay=Ee,this.deactivateCurrentController=!1,this.dragMode=!1,this.controllerSubscriptions=[],this.pointerCapture=null,this.stopAnimation=!1,this.idealDelta=void 0,this.subscribeToControllerEvents()}subscribeToControllerEvents(){this.controllerSubscriptions.length>0||this.controllerSubscriptions.push(E.subscribe(E.ChannelId.ControllerActivated,e=>this.onControllerActivated(e)),E.subscribe(E.ChannelId.ControllerDeactivateRequested,e=>this.onControllerDeactivationRequest(e)),E.subscribe(E.ChannelId.ControllerDeactivated,e=>this.onControllerDeactivated(e)),E.subscribe(E.ChannelId.ControllerPaused,e=>this.onControllerPaused(e)),E.subscribe(E.ChannelId.ControllerUnpaused,e=>this.onControllerUnpaused(e)),E.subscribe(E.ChannelId.ControllerViewHidden,e=>this.onControllerViewHide(e)),E.subscribe(E.ChannelId.ControllerViewShow,e=>this.onControllerViewShow(e)))}unsubscribeFromControllerEvents(){for(;this.controllerSubscriptions.length;){let e=this.controllerSubscriptions.pop();e&&E.unsubscribe(e)}}operateCurrentMVC(e){if(!(this.suspended||this.currentController===null)&&(this.currentController.calculateTimeDelta(e),this.transitionTime===y.UNDEFINED&&this.currentController.update(),this.deactivateCurrentController&&(this.deactivateCurrentController=!1,this.currentController.deactivateImmediately()),this.currentController.activeViewID!==y.UNDEFINED&&(this.currentController.activeView()?.draw(),this.currentController.calculateFPS(),w.fpsEnabled))){let e=this.currentController.frameRate.toFixed(0);if(Number(e)>0){let t=r.context;t&&(t.font=`30px system-ui, sans-serif`,t.fillStyle=c.styles.SOLID_OPAQUE,t.fillText(`${e} fps`,10,l.CANVAS_HEIGHT-10))}}}activateMouseEvents(){if(!this.pointerCapture){let e=r.element;if(!e)return;this.pointerCapture=new ge({element:e,onStart:this.mouseDown.bind(this),onMove:this.mouseMove.bind(this),onEnd:this.mouseUp.bind(this),onOut:this.mouseOut.bind(this),getZoom(){return ee.getCanvasZoom()}})}this.pointerCapture?.activate()}deactivateMouseEvents(){this.pointerCapture?.deactivate()}activate(){super.activate(),this.subscribeToControllerEvents(),this.activateMouseEvents();let e=window.requestAnimationFrame.bind(window),t=()=>{let n=Date.now();this.operateCurrentMVC(n),this.stopAnimation||e(t)};this.stopAnimation=!1,t()}deactivate(){super.deactivate(),this.stopAnimation=!0,this.deactivateMouseEvents(),this.unsubscribeFromControllerEvents()}setCurrentController(e){if(this.currentController=e,!e)return;let t=e;t.idealDelta=1/60}getCurrentController(){return this.currentController}onControllerActivated(e){this.setCurrentController(e)}onControllerDeactivated(e){this.currentController=null}onControllerPaused(e){this.currentController=null}onControllerUnpaused(e){this.setCurrentController(e)}onControllerDeactivationRequest(e){this.deactivateCurrentController=!0}onControllerViewShow(e){if(this.viewTransition!==y.UNDEFINED&&this.previousView!=null){let e=this.currentController;e&&(e.calculateTimeDelta(void 0),this.transitionTime=e.lastTime+this.transitionDelay,e.activeView()?.draw())}}onControllerViewHide(e){this.previousView=e,this.viewTransition!==y.UNDEFINED&&this.previousView!=null&&this.previousView.draw()}isSuspended(){return this.suspended}suspend(){this.suspended=!0}resume(){this.currentController&&this.currentController.resetLastTime(),this.suspended=!1}mouseDown(e,t){return this.currentController&&this.currentController!==this?(this.dragMode=!0,this.currentController.mouseDown(e,t)):!1}mouseMove(e,t){return this.currentController&&this.currentController!==this?(this.dragMode&&this.currentController.mouseDragged(e,t),this.currentController.mouseMoved(e,t)):!1}mouseUp(e,t){if(this.currentController&&this.currentController!==this){let n=this.currentController.mouseUp(e,t);return this.dragMode=!1,n}return!1}mouseOut(e,t){if(this.currentController&&this.currentController!==this&&this.dragMode){let n=this.currentController.mouseUp(e,t);return this.dragMode=!1,n}return!1}doubleClick(e,t){return this.currentController&&this.currentController!==this?(this.currentController.mouseUp(e,t),this.dragMode=!1,this.currentController.doubleClick(e,t)):!1}},ke=class extends a{constructor(){super(),this.width=l.CANVAS_WIDTH,this.height=l.CANVAS_HEIGHT}},Ae={GAME_SCENE:0,PAUSE_BUTTON:1,RESTART_BUTTON:2,NEXT_BUTTON:3,PAUSE_MENU:4,RESULTS:5},R=class e extends ke{static ElementType=Ae;draw(){let t=this.children,n=t.length;for(let e=0;e<n;e++){let n=t[e];!n||!n.visible||n.draw()}let i=this.getChild(e.ElementType.GAME_SCENE);if(!i||i.dimTime<=0)return;let a=i.dimTime/y.DIM_TIMEOUT;typeof i.isFadingIn==`function`&&i.isFadingIn()&&(a=1-a);let o=r.context;o&&(o.fillStyle=new c(1,1,1,a).rgbaStyle(),o.fillRect(0,0,l.CANVAS_WIDTH,l.CANVAS_HEIGHT))}show(){super.show();let t=this.getChild(e.ElementType.GAME_SCENE);t?.animateRestartDim&&t.animateLevelRestart?.()}},je={PAUSE_RESUME:0,PAUSE_RESTART:1,PAUSE_SKIP:2,PAUSE_LEVEL_SELECT:3,PAUSE_EXIT:4,WIN_EXIT:5,PAUSE:6,NEXT_LEVEL:7,WIN_RESTART:8,WIN_NEXT_LEVEL:9},Me={PAUSE_MENU:0,PAUSE_MENU_LEVEL_SELECT:1,PAUSE_MENU_LEVEL_SELECT_NEXT_PACK:2},Ne=class extends L{static GameButton=je;static ExitCodeFrom=Me;animateRestart;isGamePaused;constructor(e){super(e),this.animateRestart=!1,this.isGamePaused=!1}activate(){super.activate(),O.playGameMusic(),this.createGameView(),this.initGameView(),this.showView(0)}createGameView(){let e=new R,t=new me;t.gameController=this,t.animateRestartDim=this.animateRestart,this.animateRestart=!1,e.addChildWithID(t,R.ElementType.GAME_SCENE),this.addView(e,0)}initGameView(){this.setPaused(!1),this.levelFirstStart()}levelFirstStart(){this.isGamePaused=!1}levelStart(){this.isGamePaused=!1}onLevelWon(){O.playSound(e.SND_WIN),this.deactivate()}onLevelLost(){this.restartLevel()}setPaused(e){this.isGamePaused=e;let t=this.getView(0);if(!t)return;let n=t.getChild(R.ElementType.GAME_SCENE);n&&(n.touchable=!e,n.updateable=!e,e?O.pauseAudio():O.resumeAudio())}pauseLevel(){let e=this.getView(0);if(!e)return;let t=e.getChild(R.ElementType.GAME_SCENE);t&&(t.dimTime=0,this.setPaused(!0))}resumeLevel(){this.setPaused(!1)}restartLevel(){this.deleteView(0),this.animateRestart=!0,this.activate()}mouseDown(e,t){if(super.mouseDown(e,t))return!0;let n=this.getView(0);if(!n)return!1;let r=n.getChild(R.ElementType.GAME_SCENE);return r?.touchable?(r.touchDown(e,t,0),!0):!1}mouseDragged(e,t){if(super.mouseDragged(e,t))return!0;let n=this.getView(0);if(!n)return!1;let r=n.getChild(R.ElementType.GAME_SCENE);return r?.touchable?(r.touchDragged(e,t,0),!0):!1}mouseMoved(e,t){if(super.mouseMoved(e,t))return!0;let n=this.getView(0);if(!n)return!1;let r=n.getChild(R.ElementType.GAME_SCENE);return r?.touchable?(r.touchMove(e,t,0),!0):!1}mouseUp(e,t){if(super.mouseUp(e,t))return!0;let n=this.getView(0);if(!n)return!1;let r=n.getChild(R.ElementType.GAME_SCENE);return r?.touchable?(r.touchUp(e,t,0),!0):!1}doubleClick(e,t){if(super.doubleClick(e,t))return!0;let n=this.getView(0);if(!n)return!1;let r=n.getChild(R.ElementType.GAME_SCENE);return r?.touchable?(r.doubleClick(e,t,0),!0):!1}},z={START:0,MENU:1,LOADING:2,GAME:3},B=new class extends Oe{static ChildController=z;startLevel(e,t){fe.loadLevel(e,t),this.controllerState===L.StateType.INACTIVE&&this.activate();let n=this.getChild(z.GAME);n&&n.deactivateImmediately(),n=new Ne(this),this.addChildWithID(n,z.GAME),this.activateChild(z.GAME)}pauseLevel(){this.getChild(z.GAME)?.pauseLevel()}resumeLevel(){this.getChild(z.GAME)?.resumeLevel()}restartLevel(){this.getChild(z.GAME)?.restartLevel()}stopLevel(){this.deactivateActiveChild()}isLevelActive(){if(this.controllerState===L.StateType.INACTIVE)return!1;let e=this.getChild(z.GAME);return!(!e||e.controllerState===L.StateType.INACTIVE||e.isGamePaused)}onChildDeactivated(e){super.onChildDeactivated(e),e===z.GAME&&this.deleteChild(z.GAME)}},Pe=()=>T?0:1,Fe=()=>{let e=document.getElementById(`vid`);if(!e){try{e=document.createElement(`video`)}catch{return null}e.id=`vid`,e.className=`ctrPointer`,document.getElementById(`video`)?.appendChild(e)}return e},Ie=new class{closeIntroCallback=null;loadIntroVideo=()=>{let e=Pe();if((m.getStars(e,0)||0)===0){let e=Fe(),t=l.VIDEO_WIDTH,n=v.getVideoExtension(),r=v.videoBaseUrl;if(e!=null&&n!=null)try{e.src=`${r}intro_${t}${n}`,e.load()}catch{}}};removeIntroVideo=()=>{let e=Pe();if((m.getStars(e,0)||0)>0){let e=document.getElementById(`vid`);e&&e.remove()}};playIntroVideo=e=>{let t=Pe(),n=m.getStars(t,0)||0,r=document.getElementById(`vid`);if(this.closeIntroCallback=e,n===0&&r){let e=r.readyState;if(e===2||e===3||e===4){O.pauseMusic(),I(r,300,`block`).then(()=>{r.play()}),r.addEventListener(`ended`,this.closeIntroVideo),r.addEventListener(`mousedown`,this.closeIntroVideo);return}}this.closeIntroVideo()};closeIntroVideo=()=>{let e=document.getElementById(`vid`);e&&A(e,500).then(()=>{e.pause(),e.currentTime=0}),this.closeIntroCallback&&this.closeIntroCallback()};loadOutroVideo=()=>{let e=Fe(),t=l.VIDEO_WIDTH,n=v.getVideoExtension(),r=v.videoBaseUrl;if(e!=null&&n!=null)try{e.src=`${r}outro_${t}${n}`,e.load()}catch{}};playOutroVideo=()=>{let e=document.getElementById(`vid`);if(e){let t=e.readyState;t===2||t===3||t===4?(O.pauseMusic(),O.musicEnabled||(e.volume=0),I(e,300,`block`).then(()=>{e.play()}),e.addEventListener(`ended`,this.closeOutroVideo),e.addEventListener(`mousedown`,this.closeOutroVideo)):(e.remove(),N.showPanel(k.GAMECOMPLETE,!1))}};closeOutroVideo=()=>{N.showPanel(k.GAMECOMPLETE,!0);let e=document.getElementById(`vid`);e&&A(e,500).then(()=>{e.pause(),e.currentTime=0,e.remove()})};domReady=()=>{this.loadIntroVideo()}};E.subscribe(E.ChannelId.LoadIntroVideo,()=>{Ie.loadIntroVideo()});var V=Ie,Le=`gameComplete`,H=new class{borderElement=null;ensureBorderElement=()=>(this.borderElement||=document.getElementById(`gameBorder`),this.borderElement);applyFade=({fadeIn:e,duration:t=0,delay:n=0})=>{let r=this.ensureBorderElement();if(!r)return;let i=Math.max(n,0),a=Math.max(t,0);if(a===0){e?(r.style.opacity=`1`,r.style.display=``):(r.style.opacity=`0`,r.style.display=`none`);return}let o=e?`1`:`0`,s=e?`0`:`1`;e&&(r.style.display=``,r.style.opacity=s),r.style.transition=`none`,requestAnimationFrame(()=>{if(!r)return;r.style.transition=`opacity ${a}ms ease`,e||(r.style.opacity=s),setTimeout(()=>{r&&(r.style.opacity=o)},i);let t=()=>{r.removeEventListener(`transitionend`,t),e||(r.style.display=`none`),r.style.transition=``};r.addEventListener(`transitionend`,t,{once:!0})})};domReady=()=>{this.ensureBorderElement()};setBoxBorder=e=>{let t=this.ensureBorderElement();if(!t)return;let n=o.boxBorders[e],r=n?`${v.uiImageBaseUrl}${n}`:``;t.classList.remove(Le),t.style.backgroundImage=r?`url("${r}")`:``};setGameCompleteBorder=()=>{let e=this.ensureBorderElement();e&&(e.style.backgroundImage=``,e.classList.add(Le))};hide=()=>{let e=this.ensureBorderElement();e&&(e.style.display=`none`)};show=()=>{let e=this.ensureBorderElement();e&&(e.style.display=``)};fadeIn=(e,t)=>{this.applyFade({fadeIn:!0,duration:e,delay:t})};fadeOut=(e,t)=>{this.applyFade({fadeIn:!1,duration:e,delay:t})}},Re=new class t{static FADE_DURATION_MS=200;static SELECTORS={popupOuter:`.popupOuterFrame`,popupInner:`.popupInnerFrame`,popupWindow:`#popupWindow`};static activeControllers=new WeakMap;static cancelAnimation(e,n){let r=t.activeControllers.get(e);r&&(r.abort(),t.activeControllers.delete(e)),typeof n==`number`&&(e.style.opacity=n.toString())}static async fadeElement(e,{from:n,to:r,duration:i,display:a}){t.cancelAnimation(e),a!==void 0&&(e.style.display=a);let o=typeof n==`number`?n:parseFloat(getComputedStyle(e).opacity||`0`)||0,s=r;e.style.opacity=String(o);let c=new AbortController;t.activeControllers.set(e,c);let{signal:l}=c,u;await new Promise(n=>{let r=a=>{if(l.aborted)return n();u===void 0&&(u=a);let c=Math.min((a-u)/i,1),d=o+(s-o)*c;e.style.opacity=String(d),c<1&&!l.aborted?requestAnimationFrame(r):(t.activeControllers.delete(e),n())};requestAnimationFrame(r)})}async showPopup(e){B.pauseLevel();let n=document.querySelector(t.SELECTORS.popupWindow);if(!n)return;document.querySelectorAll(t.SELECTORS.popupOuter).forEach(e=>t.cancelAnimation(e,0)),document.querySelectorAll(t.SELECTORS.popupInner).forEach(e=>e.style.display=`none`),n.style.display=`block`,await t.fadeElement(n,{from:0,to:1,duration:t.FADE_DURATION_MS});let r=document.getElementById(e);r&&(r.style.display=`block`,document.querySelectorAll(t.SELECTORS.popupOuter).forEach(e=>{t.cancelAnimation(e),e.style.display=`block`,t.fadeElement(e,{from:0,to:1,duration:t.FADE_DURATION_MS})}))}async closePopup(){O.playSound(e.SND_TAP);let n=document.querySelector(t.SELECTORS.popupWindow);if(!n)return;t.cancelAnimation(n);let r=parseFloat(getComputedStyle(n).opacity||`1`)||1;await t.fadeElement(n,{from:r,to:0,duration:t.FADE_DURATION_MS}),n.style.display=`none`,B.resumeLevel()}showPayDialog(){O.playSound(e.SND_TAP),this.showPopup(`payDialog`)}showSlowComputerPopup(){let e=document.getElementById(`slowComputer`);if(!e)return;e.querySelectorAll(`img`).forEach(e=>e.remove());let t=g.drawBig({text:d.menuText(x.SLOW_TITLE),alignment:n.CENTER,width:1200*l.CANVAS_SCALE,scale:1.25*l.UI_TEXT_SCALE}),r=g.drawBig({text:d.menuText(x.SLOW_TEXT),width:1200*l.CANVAS_SCALE,scale:.8*l.UI_TEXT_SCALE});r.style.marginLeft=`${l.uiScaledNumber(30)}px`,e.append(t,r),g.drawBig({text:d.menuText(x.LETS_PLAY),imgSel:`#slowComputerBtn img`,scale:.8*l.UI_TEXT_SCALE}),this.showPopup(`slowComputer`)}initEventListeners(){[[`slowComputerBtn`,this.closePopup.bind(this)],[`missingOkBtn`,this.closePopup.bind(this)],[`resetNoBtn`,this.closePopup.bind(this)],[`holidayOkBtn`,this.closePopup.bind(this)]].forEach(([e,t])=>{let n=document.getElementById(e);n&&n.addEventListener(`click`,t)})}onPayClick(){E.publish(E.ChannelId.PurchaseBoxesPrompt),this.closePopup()}initLocalization(){E.subscribe(E.ChannelId.LanguageChanged,()=>{g.drawBig({text:d.menuText(x.UPGRADE_TO_FULL),imgParentId:`payMessage`,width:l.uiScaledNumber(650),alignment:n.CENTER,scale:.8*l.UI_TEXT_SCALE}),g.drawBig({text:d.menuText(x.BUY_FULL_GAME),imgParentId:`payBtn`,scale:.6*l.UI_TEXT_SCALE})})}init(){b.registerDialogs(this),document.readyState===`loading`?document.addEventListener(`DOMContentLoaded`,()=>this.initEventListeners()):this.initEventListeners(),this.initLocalization()}};Re.init();var ze=Re,Be=1920*1080,Ve=80,He=30,Ue=250,U=40,We=30,Ge=70,Ke=15,qe=8,Je=22,Ye=.5,Xe=1.2,Ze=.4,Qe=1,$e=2e3,et=new class{canvas;ctx;snowflakes;texture;running;frameHandle;retryHandle;lastTimestamp;fading;fadeElapsed;fadeDuration;globalAlpha;startTimeout;constructor(){this.canvas=null,this.ctx=null,this.snowflakes=[],this.texture=null,this.running=!1,this.frameHandle=null,this.retryHandle=null,this.lastTimestamp=0,this.fading=!1,this.fadeElapsed=0,this.fadeDuration=.6,this.globalAlpha=1,this.startTimeout=null,this.tick=this.tick.bind(this)}domReady(){if(this.canvas)return;let e=document.getElementById(`gameArea`);if(!e)return;let t=document.createElement(`canvas`);t.id=`snowOverlay`,t.width=l.CANVAS_WIDTH,t.height=l.CANVAS_HEIGHT,t.style.position=`absolute`,t.style.top=`0`,t.style.left=`0`,t.style.pointerEvents=`none`,t.style.zIndex=`80`,t.style.display=`none`,e.appendChild(t),this.canvas=t,this.ctx=t.getContext(`2d`),this.updateCanvasSize(),window.addEventListener(`resize`,()=>this.updateCanvasSize());let n=document.getElementById(`fadeToBlack`);n&&!n.style.zIndex&&(n.style.zIndex=`120`)}updateCanvasSize(){if(!this.canvas)return;let e=l.CANVAS_WIDTH,t=l.CANVAS_HEIGHT;(this.canvas.width!==e||this.canvas.height!==t)&&(this.canvas.width=e,this.canvas.height=t),this.canvas.style.width=`${e}px`,this.canvas.style.height=`${t}px`}start(){this.canvas||this.domReady(),!(!this.canvas||!this.ctx)&&(this.startTimeout&&=(clearTimeout(this.startTimeout),null),this.running&&this._stopImmediate(),this.fading=!1,this.fadeElapsed=0,this.globalAlpha=0,this.ensureTexture()&&(this.startTimeout=window.setTimeout(()=>{this.startTimeout=null,this._beginSnowfall()},$e)))}stop(e=!1){if(e||!this.running){this._stopImmediate();return}this.fading=!0,this.fadeElapsed=0}ensureTexture(){if(this.texture)return!0;let t=f.getTexture(e.IMG_SNOWFLAKES);return t?(this.texture=t,!0):(this.retryHandle||=window.setTimeout(()=>{this.retryHandle=null,this.start()},Ue),!1)}computeSnowflakeCount(){let e=l.CANVAS_WIDTH*l.CANVAS_HEIGHT/Be||1,t=Math.round(e*Ve);return C.fitToBoundaries(t,He,Ve)}prepareSnowflakes(){if(!this.canvas)return;this.snowflakes.length=0;let e=this.computeSnowflakeCount();for(let t=0;t<e;t++){let e=this.createSnowflake(!0);e.y=-Math.random()*this.canvas.height,this.snowflakes.push(e)}}createSnowflake(e=!1){if(!this.canvas)throw Error(`Canvas not initialized`);let t=this.texture?.rects?.length||0,n=t>0?C.randomRange(0,t-1):0,r=Math.random()*.5+.5,i=C.randomRange(We,Ge),a=C.randomRange(-Ke,Ke),o=C.randomRange(qe*10,Je*10)/10,s=C.randomRange(Ye*100,Xe*100)/100,c=Math.random()*.3+.5,l=Math.random()*.25+.15,u=e?Math.random()*(this.canvas.width+U*2)-U:Math.random()*this.canvas.width;return{frameIndex:n,scale:r,speedY:i,speedX:a,swingAmplitude:o,swingSpeed:s,swingPhase:Math.random()*Math.PI*2,alphaBase:c,alphaRange:l,twinklePhase:Math.random()*Math.PI*2,twinkleSpeed:C.randomRange(Ze*100,Qe*100)/100,baseX:u,y:e?-Math.random()*this.canvas.height:-U}}resetSnowflake(e){let t=this.createSnowflake(!1);Object.assign(e,t)}_beginSnowfall(){if(!this.ensureTexture()){this.start();return}this.canvas&&(this.fading=!1,this.fadeElapsed=0,this.globalAlpha=1,this.canvas.style.display=`block`,this.prepareSnowflakes(),this.running=!0,this.lastTimestamp=performance.now(),this.frameHandle=requestAnimationFrame(this.tick))}_stopImmediate(){if(this.frameHandle){let e=window.cancelAnimationFrame?.bind(window)||window.clearTimeout?.bind(window);e&&e(this.frameHandle),this.frameHandle=null}this.retryHandle&&=(clearTimeout(this.retryHandle),null),this.startTimeout&&=(clearTimeout(this.startTimeout),null),this.running=!1,this.fading=!1,this.fadeElapsed=0,this.globalAlpha=0,this.ctx&&this.canvas&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas&&(this.canvas.style.display=`none`)}tick(e){if(!this.running)return;let t=(e-this.lastTimestamp)/1e3||0;if(this.lastTimestamp=e,this.updateSnowflakes(t),this.fading){this.fadeElapsed+=t;let e=C.fitToBoundaries(this.fadeElapsed/this.fadeDuration,0,1);if(this.globalAlpha=Math.max(0,1-e),e>=1){this._stopImmediate();return}}this.drawSnowflakes(),this.running&&(this.frameHandle=requestAnimationFrame(this.tick))}updateSnowflakes(e){if(!this.canvas)return;let t=this.canvas.width,n=this.canvas.height;for(let r=0,i=this.snowflakes.length;r<i;r++){let i=this.snowflakes[r];if(!i)continue;i.y+=i.speedY*e,i.baseX+=i.speedX*e,i.swingPhase+=i.swingSpeed*e,i.twinklePhase+=i.twinkleSpeed*e;let a=Math.sin(i.swingPhase)*i.swingAmplitude,o=n+U,s=t+U,c=-U,l=i.baseX+a;(i.y>o||l<c||l>s)&&this.resetSnowflake(i)}}drawSnowflakes(){if(!this.ctx||!this.texture||!this.canvas)return;let e=this.ctx;e.clearRect(0,0,this.canvas.width,this.canvas.height);let t=this.texture.rects||[],n=this.texture.offsets||[],r=this.texture.preCutSize?.x||0,i=this.texture.preCutSize?.y||0,a=this.texture.image;if(a){for(let o=0,s=this.snowflakes.length;o<s;o++){let s=this.snowflakes[o];if(!s)continue;let c=t[s.frameIndex];if(!c)continue;let l=n[s.frameIndex]||{x:0,y:0},u=c.w*s.scale,d=c.h*s.scale,f=Number.isFinite(r)&&r>0&&r<1e4?r:c.w,p=Number.isFinite(i)&&i>0&&i<1e4?i:c.h,m=f*s.scale,h=p*s.scale,g=l.x*s.scale,_=l.y*s.scale,v=Math.sin(s.swingPhase)*s.swingAmplitude,y=s.baseX+v-m/2+g,b=s.y-h/2+_,x=s.alphaBase+Math.sin(s.twinklePhase)*s.alphaRange,S=C.fitToBoundaries(x,0,1)*C.fitToBoundaries(this.globalAlpha,0,1);S<=0||(e.globalAlpha=S,e.drawImage(a,c.x,c.y,c.w,c.h,y,b,u,d))}e.globalAlpha=1}}},tt=o.menuMusicId;const nt=(typeof tt==`number`?tt:typeof tt==`string`?e[tt]:void 0)??(T?e.SND_MENU_MUSIC_XMAS:e.SND_MENU_MUSIC),rt=/MSIE|Trident/.test(window.navigator.userAgent),it=()=>{T&&et.start()},at=()=>{T&&et.stop()},ot=()=>T?0:1;var st=class{manager;constructor(e){this.manager=e}onInitializePanel(t){let r=this.manager,{gameFlow:i}=r,a=N.getPanelById(t),c=document.getElementById(`soundBtn`),u=document.getElementById(`musicBtn`),f=document.getElementById(`resetBtn`),p=document.getElementById(`optionsBack`),h=document.getElementById(`optionMsg`),y=document.getElementById(`resetText`),b=document.getElementById(`resetHoldYes`),C=document.getElementById(`lang`),T=document.getElementById(`menuCandySkin`);switch(t){case k.MENU:{ue.updateMenuCandySkin(),T&&(T.classList.add(`ctrPointer`),T.addEventListener(`click`,()=>{O.playSound(e.SND_TAP),ue.markCandyAsChanged(),N.showPanel(k.SKIN_SELECT)})),P(`#playBtn`,`click`,()=>{O.playSound(e.SND_TAP),V.playIntroVideo(()=>{if((m.getStars(ot(),0)||0)===0)i.noMenuStartLevel(ot(),0);else{let e=o.disableBoxMenu?k.LEVELS:k.BOXES;N.showPanel(e,!0)}})}),P(`#optionsBtn`,`click`,()=>{O.playSound(e.SND_TAP),v.customOptions?E.publish(E.ChannelId.ShowOptions):N.showPanel(k.OPTIONS)}),P(`#achievementsBtn`,`click`,()=>{r._signedIn&&(O.playSound(e.SND_TAP),N.showPanel(k.ACHIEVEMENTS))}),r._updateSignInControls(),P(`#leaderboardsBtn`,`click`,()=>{r._signedIn&&(O.playSound(e.SND_TAP),N.showPanel(k.LEADERBOARDS))}),r._updateSignInControls();let t=null;P(`#resetYesBtn`,ge.startEventName,()=>{O.playSound(e.SND_TAP),t=window.setTimeout(()=>{ze.closePopup(),t=null,w.clear(),m.resetGame(),_.resetLocks(),E.publish(E.ChannelId.LoadIntroVideo)},3e3)}),P(`#resetYesBtn`,ge.endEventName,()=>{t!=null&&clearTimeout(t)}),r._updateMiniSoundButton(!1,`optionSound`,``),P(`#optionSound`,`click`,()=>{r._updateMiniSoundButton(!0,`optionSound`,`optionMsg`)});let n;r.useHDVersion?(F(`#optionHd`,`activeResolution`),F(`#optionSd`,`inActiveResolution`),F(`#optionSd`,`ctrPointer`),de(`#optionSd`,()=>{r._showMiniOptionMessage(`optionMsg`,d.menuText(x.RELOAD_SD),4e3)},()=>{h&&(he(h),A(h,500))}),n=`optionSd`):(F(`#optionSd`,`activeResolution`),F(`#optionHd`,`inActiveResolution`),F(`#optionHd`,`ctrPointer`),de(`#optionHd`,()=>{r._showMiniOptionMessage(`optionMsg`,d.menuText(x.RELOAD_HD),4e3)},()=>{h&&(he(h),A(h,500))}),n=`optionHd`),P(`#${n}`,`click`,()=>{w.setIsHD(!r.useHDVersion),window.location.reload()}),E.subscribe(E.ChannelId.LanguageChanged,()=>{r._setImageBigText(`#playBtn img`,x.PLAY),r._setImageBigText(`#optionsBtn img`,x.OPTIONS),r._setImageBigText(`#resetYesBtn img`,x.YES),r._setImageBigText(`#resetNoBtn img`,x.NO),g.drawBig({text:d.menuText(x.LEADERBOARDS),imgParentId:`leaderboardsBtn`,scale:.8*l.UI_TEXT_SCALE}),g.drawBig({text:d.menuText(x.ACHIEVEMENTS),imgParentId:`achievementsBtn`,scale:.8*l.UI_TEXT_SCALE})});break}case k.BOXES:P(`#boxBack`,`click`,()=>{O.playSound(e.SND_TAP),N.showPanel(k.MENU)}),a?.init?.(r);break;case k.PASSWORD:P(`#boxEnterCodeButton`,`click`,()=>{O.playSound(e.SND_TAP),N.showPanel(k.PASSWORD)}),P(`#codeBack`,`click`,()=>{O.playSound(e.SND_TAP),N.showPanel(k.BOXES)}),a?.init?.(r);break;case k.LEVELS:P(`#levelBack`,`click`,()=>{O.playSound(e.SND_TAP);let t=o.disableBoxMenu?k.MENU:k.BOXES;N.showPanel(t)}),S.renderDoors(!0,0),a?.init?.(r);break;case k.GAME:P(`#gameRestartBtn`,`click`,()=>{r.isTransitionActive||(O.playSound(e.SND_TAP),i._openLevel(_.currentLevelIndex,!0))}),P(`#gameMenuBtn`,`click`,()=>{r.isTransitionActive||(O.playSound(e.SND_TAP),i._openLevelMenu())});break;case k.GAMEMENU:P(`#continueBtn`,`click`,()=>{O.playSound(e.SND_TAP),i._closeLevelMenu(),B.resumeLevel()}),P(`#skipBtn`,`click`,()=>{O.playSound(e.SND_TAP),i._closeLevelMenu(),_.isNextLevelPlayable()?(m.setStars(_.currentBoxIndex,_.currentLevelIndex,0,!0),i._openLevel(_.currentLevelIndex+1,!1,!0)):(j(`#gameBtnTray`),i._completeBox())}),P(`#selectBtn`,`click`,()=>{O.playSound(e.SND_TAP),i._closeLevelMenu(),i._closeLevel(),r.isInLevelSelectMode=!0,r.isInMenuSelectMode=!1,i.closeBox()}),P(`#menuBtn`,`click`,()=>{O.playSound(e.SND_TAP),i._closeLevelMenu(),i._closeLevel(),r.isInLevelSelectMode=!0,r.isInMenuSelectMode=!0,i.closeBox()}),r._updateMiniSoundButton(!1,`gameSound`,``),P(`#gameSound`,`click`,()=>{r._updateMiniSoundButton(!0,`gameSound`,`gameMsg`)}),E.subscribe(E.ChannelId.LanguageChanged,()=>{r._setImageBigText(`#continueBtn img`,x.CONTINUE),r._setImageBigText(`#skipBtn img`,x.SKIP_LEVEL),r._setImageBigText(`#selectBtn img`,x.LEVEL_SELECT),r._setImageBigText(`#menuBtn img`,x.MAIN_MENU)});break;case k.LEVELCOMPLETE:P(`#nextBtn`,`click`,()=>{r.isTransitionActive||(i._notifyBeginTransition(1e3,`next level`),O.playSound(e.SND_TAP),_.isNextLevelPlayable()?i._openLevel(_.currentLevelIndex+1):i._completeBox())}),P(`#replayBtn`,`click`,()=>{r.isTransitionActive||(i._notifyBeginTransition(1e3,`replay`),O.playSound(e.SND_TAP),i._openLevel(_.currentLevelIndex))}),P(`#lrMenuBtn`,`click`,()=>{r.isTransitionActive||(i._notifyBeginTransition(1e3,`level menu`),O.playSound(e.SND_TAP),r.isInLevelSelectMode=!0,r.isInMenuSelectMode=!1,i.tapeBox())}),E.subscribe(E.ChannelId.LanguageChanged,()=>{r._setImageBigText(`#nextBtn img`,x.NEXT),r._setImageBigText(`#replayBtn img`,x.REPLAY),r._setImageBigText(`#lrMenuBtn img`,x.MENU),g.drawSmall({text:d.menuText(x.FINAL_SCORE),imgId:`resultTickerMessage`,scaleToUI:!0,canvas:!0})});break;case k.GAMECOMPLETE:P(`#gameCompleteBack`,`click`,()=>{O.playSound(e.SND_TAP),N.showPanel(k.MENU),H.hide()});break;case k.OPTIONS:{let t=v.updateSoundOption;v.setSoundButtonChange(c,()=>{let n=!w.getSoundEnabled();O.setSoundEnabled(n),O.playSound(e.SND_TAP),t(c,n),r._updateMiniSoundButton(!1,`gameSound`,``),r._updateMiniSoundButton(!1,`optionSound`,``)});let i=v.updateMusicOption;v.setMusicButtonChange(u,()=>{O.playSound(e.SND_TAP);let t=!w.getMusicEnabled();O.setMusicEnabled(t),i(u,t),r._updateMiniSoundButton(!1,`gameSound`,``),r._updateMiniSoundButton(!1,`optionSound`,``)});let a=v.updateLangSetting;v.setLangOptionClick(t=>{O.playSound(e.SND_TAP);let n;if(t==null){let e=o.languages;if(e.length===0)return;let t=(e.indexOf(w.getLangId())+1)%e.length,r=e[t<0?0:t]??e[0];if(r==null)return;n=r}else n=t;w.setLangId(n),E.publish(E.ChannelId.LanguageFontLoaded)});let m=v.updateCutSetting;v.setCutOptionClick(()=>{O.playSound(e.SND_TAP);let t=!w.getClickToCut();w.setClickToCut(t),m(t)}),f?.addEventListener(`click`,()=>{let t=g.drawBig({text:d.menuText(x.RESET_TEXT),alignment:n.CENTER,width:1250*l.CANVAS_SCALE,scaleToUI:!0}),r=g.drawSmall({text:d.menuText(x.RESET_HOLD_YES),scaleToUI:!0});y&&(le(y),pe(y,t)),b&&(le(b),pe(b,r)),O.playSound(e.SND_TAP),ze.showPopup(`resetGame`)}),p?.addEventListener(`click`,()=>{O.playSound(e.SND_TAP),N.showPanel(k.MENU)}),v.toggleLangUI(!o.disableLanguageOption);let h=()=>{r._setImageBigText(`#optionsTitle img`,x.OPTIONS),t(c,w.getSoundEnabled()),i(u,w.getMusicEnabled()),a(),m(w.getClickToCut()),v.setResetText(f,d.menuText(x.RESET));let e=w.getLangId();C&&(M(C,`lang-system lang-en lang-de lang-ru lang-fr lang-ca lang-br lang-es lang-it lang-nl lang-ko lang-ja lang-zh`),F(C,`lang-${s.toCountryCode(e)}`),F(C,`lang-system`))};E.subscribe(E.ChannelId.LanguageChanged,h),E.subscribe(E.ChannelId.ShowOptionsPage,h);break}case k.SKIN_SELECT:ue.init();break;case k.LEADERBOARDS:P(`#leaderboardBack`,`click`,()=>{O.playSound(e.SND_TAP),N.showPanel(k.MENU)});break;case k.ACHIEVEMENTS:P(`#achievementsBack`,`click`,()=>{O.playSound(e.SND_TAP),N.showPanel(k.MENU)});break}}},ct=document.getElementById(`congrats`),lt=class{manager;constructor(e){this.manager=e}onShowPanel(e){let t=N.getPanelById(e);switch(e){case k.MENU:case k.BOXES:case k.OPTIONS:H.fadeOut(300);break;case k.LEVELS:H.show();break}e!==k.GAMEMENU&&this.manager.gameFlow._closeLevelMenu(),(e===k.MENU||e===k.LEVELS)&&O.playMusic(nt);let n=N.getPanelById(k.BOXES);e===k.BOXES?(_.updateBoxLocks(),m.updateTotalScoreText(),n?.onShow?.(),this.manager.isInAdvanceBoxMode?(this.manager.isInAdvanceBoxMode=!1,window.setTimeout(()=>{j(`#levelResults`),n?.slideToNextBox?.(),_.isNextLevelPlayable()||ze.showPayDialog()},800)):(this.manager._bounceTimeOut&&clearTimeout(this.manager._bounceTimeOut),this.manager._bounceTimeOut=window.setTimeout(()=>{n?.bounceCurrentBox?.()},300))):n?.onHide?.();let r=N.getPanelById(k.PASSWORD);switch(r&&(e===k.PASSWORD?r.onShow?.():r.onHide?.()),e){case k.LEVELS:S.renderDoors(!0,0),t?.onShow?.();break;case k.GAME:this.manager._updateMiniSoundButton(!1,`optionSound`,``);break;case k.GAMECOMPLETE:{j(`#levelResults`),H.setGameCompleteBorder();let e=d.menuText(x.GAME_FINISHED_TEXT).replace(`%d`,String(m.totalStars()));g.drawBig({text:e,imgSel:`#finalScore img`,scale:.8*l.UI_TEXT_SCALE,alignment:1}),ct&&(le(ct),pe(ct,g.drawBig({text:d.menuText(x.CONGRATULATIONS),scale:1.2*l.UI_TEXT_SCALE}))),g.drawBig({text:d.menuText(x.SHARE_ELLIPSIS),imgSel:`#finalShareBtn img`,scale:.8*l.UI_TEXT_SCALE,maxScaleWidth:l.uiScaledNumber(130)}),g.drawBig({text:d.menuText(x.MORE_CTR_FUN),imgSel:`#finalFunBtn img`,scale:.8*l.UI_TEXT_SCALE,maxScaleWidth:l.uiScaledNumber(310)});break}case k.OPTIONS:E.publish(E.ChannelId.ShowOptionsPage);break;case k.ACHIEVEMENTS:case k.LEADERBOARDS:E.publish(E.ChannelId.UpdateCandyScroller);break}}};const ut=(e,t,n,r,i,a,o)=>{e.save(),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.restore(),e.save(),e.translate(r,i),e.scale(t,n),e.save(),e.beginPath(),e.moveTo(116.1,38.3),e.bezierCurveTo(117.2,37.9,118.2,37.4,119,36.8),e.lineTo(119.5,35.6),e.lineTo(123.3,21.1),e.bezierCurveTo(124.5,18.2,126.8,14.6,130.1,10.3),e.bezierCurveTo(129.9,15.3,133.6,18.2,141.3,19),e.bezierCurveTo(138.9,19.1,136.7,19.9,134.8,21.5),e.bezierCurveTo(132.4,23.5,130.7,25.2,129.7,26.8),e.bezierCurveTo(128.9,28.3,127.9,30.7,126.7,33.8),e.lineTo(126.4,36.8),e.lineTo(126.7,37.7),e.lineTo(128.6,38.7),e.bezierCurveTo(124.4,37.5,120.2,37.4,116.1,38.3),e.closePath(),e.moveTo(241.8,203.6),e.bezierCurveTo(241.6,202.9,241.1,202.2,240.5,201.5),e.lineTo(214.2,185.6),e.bezierCurveTo(212.8,190,210.9,194.2,208.4,198.1),e.lineTo(208.3,198),e.lineTo(209.4,192.8),e.lineTo(211,183.6),e.lineTo(211.2,182.6),e.lineTo(212.8,173.3),e.bezierCurveTo(212.3,176,211.3,179,210,182.1),e.bezierCurveTo(209.9,182.4,209.8,182.6,209.7,182.8),e.bezierCurveTo(208.6,185.2,207.3,187.8,205.8,190.5),e.bezierCurveTo(203.4,194.6,200.9,197.9,198.1,200.4),e.bezierCurveTo(198.7,201.8,199,203.2,199.2,204.7),e.bezierCurveTo(199.2,204.8,199.2,204.9,199.2,205),e.bezierCurveTo(199.5,207.9,199.6,209.6,199.7,210.2),e.bezierCurveTo(200,211.2,200.1,212,200.2,212.5),e.lineTo(199.6,207.8),e.bezierCurveTo(201.8,213.8,203.3,218.7,204,222.5),e.bezierCurveTo(205.3,222.4,206.5,222.4,207.7,222.3),e.bezierCurveTo(213.4,222,218.9,221.9,224.3,222.1),e.bezierCurveTo(227.5,222.5,230.1,222.1,232.3,221.1),e.bezierCurveTo(232.8,220.7,233.4,220.2,233.9,219.6),e.bezierCurveTo(235.2,218.1,236.5,216.5,237.8,215),e.bezierCurveTo(239.1,213.3,240.1,211.5,240.9,209.6),e.bezierCurveTo(241.8,207.4,242.1,205.4,241.8,203.6),e.closePath(),e.moveTo(148.8,222.8),e.bezierCurveTo(139.8,224.7,129.5,225.7,117.8,225.9),e.bezierCurveTo(109.6,226,101.7,225.5,94.3,224.3),e.bezierCurveTo(94.3,224.9,94.4,225.6,94.4,226.2),e.bezierCurveTo(94.4,228.1,94.3,230,94,232),e.lineTo(93.8,233),e.bezierCurveTo(103.6,234.6,113.4,235.1,123.2,234.4),e.bezierCurveTo(132.2,234.4,141,233.2,149.5,231),e.bezierCurveTo(149.4,230.6,149.4,230.3,149.4,230),e.bezierCurveTo(149,227.6,148.9,225.2,148.8,222.8),e.closePath(),e.moveTo(196.6,153.6),e.lineTo(194.5,152.6),e.bezierCurveTo(194.1,152.8,193.8,153,193.4,153.2),e.bezierCurveTo(192.6,153.8,191.7,154.5,191,155.2),e.lineTo(190.2,155.8),e.bezierCurveTo(186.6,158.8,183.8,160.7,182,161.5),e.bezierCurveTo(182,162.2,181.4,164,180.2,166.7),e.bezierCurveTo(183.2,164.8,186.2,162.7,189.3,160.6),e.bezierCurveTo(192.6,158.2,195.6,155.9,198.4,153.8),e.bezierCurveTo(197.6,153.8,197,153.7,196.6,153.6),e.closePath(),e.moveTo(121.1,189),e.bezierCurveTo(128,188.9,134.8,188,141.7,186),e.bezierCurveTo(141.3,185.9,141,185.7,140.7,185.6),e.bezierCurveTo(136.2,183.2,133,181.8,131.3,181.4),e.bezierCurveTo(128.8,181.8,125.7,181.8,121.9,181.4),e.bezierCurveTo(118.1,181,114,180.5,109.4,179.7),e.lineTo(109.3,179.7),e.bezierCurveTo(108.3,180.9,106.5,182.5,103.8,184.6),e.bezierCurveTo(103.6,184.7,103.4,184.9,103.2,185),e.lineTo(102.1,185.9),e.lineTo(102.9,186.1),e.bezierCurveTo(110.1,188.1,116.2,189,121.1,189),e.closePath(),e.moveTo(63.1,164.7),e.lineTo(50.7,157.9),e.lineTo(45.8,159.6),e.lineTo(46.2,159.9),e.bezierCurveTo(46.3,160,46.4,160.1,46.5,160.2),e.bezierCurveTo(52,164,57.9,167.5,64.4,170.9),e.lineTo(65.5,171.5),e.lineTo(65.2,170.7),e.bezierCurveTo(64,168,63.4,166,63.1,164.7),e.closePath(),e.moveTo(36.5,191.7),e.bezierCurveTo(35.2,189.5,34,187.3,33,185),e.lineTo(33.1,185.9),e.lineTo(34,192.4),e.lineTo(31.3,189.4),e.bezierCurveTo(30.8,188,27.8,189.3,22.4,193.3),e.bezierCurveTo(16.9,197.2,13.7,199.6,12.7,200.6),e.bezierCurveTo(11.6,201.6,10.2,202.9,8.4,204.6),e.bezierCurveTo(6.7,206.1,5.4,207.3,4.5,208.2),e.bezierCurveTo(3.6,209,3.2,210.1,3.3,211.5),e.bezierCurveTo(3.5,212.9,4,214.8,4.8,217.3),e.bezierCurveTo(5.6,219.7,6.5,221.8,7.4,223.5),e.bezierCurveTo(8.3,225.2,9.8,226.4,11.9,227.1),e.bezierCurveTo(13.9,227.7,15.9,227.9,17.8,227.7),e.bezierCurveTo(19.7,227.5,21.3,227.4,22.6,227.4),e.bezierCurveTo(24.5,227.3,26.4,227.2,28.4,227.2),e.bezierCurveTo(30.2,227.2,32,227.2,33.8,227.2),e.bezierCurveTo(35.8,227.2,37.7,227.2,39.7,227.2),e.bezierCurveTo(41.2,227.3,42.9,227.4,44.5,227.6),e.bezierCurveTo(44.5,225.9,44.5,223.5,44.6,220.3),e.lineTo(44.6,213.4),e.lineTo(44.7,207.6),e.lineTo(45.1,204.8),e.lineTo(45.4,203),e.bezierCurveTo(45.4,202.9,45.4,202.8,45.5,202.6),e.bezierCurveTo(43.8,201.2,42.3,199.7,40.9,198.1),e.bezierCurveTo(39.3,196,37.9,193.8,36.5,191.7),e.closePath(),e.fillStyle=`rgb(100, 150, 40)`,e.fill(),e.beginPath(),e.moveTo(212.6,151.5),e.bezierCurveTo(213.3,158.8,213.4,166.1,212.8,173.3),e.bezierCurveTo(212.3,176,211.3,179,210,182.2),e.bezierCurveTo(209.9,182.4,209.8,182.6,209.7,182.8),e.bezierCurveTo(208.6,185.3,207.3,187.8,205.8,190.5),e.bezierCurveTo(203.4,194.7,200.9,198,198.1,200.5),e.bezierCurveTo(198.7,201.8,199,203.3,199.2,204.7),e.bezierCurveTo(199.2,204.8,199.2,204.9,199.2,205.1),e.bezierCurveTo(199.5,207.9,199.6,209.7,199.7,210.2),e.bezierCurveTo(199.9,214.2,200,218.2,199.9,222.4),e.bezierCurveTo(199.9,222.5,199.9,222.7,199.9,222.9),e.bezierCurveTo(199.9,225,199.7,227,199.4,228.8),e.bezierCurveTo(199.1,230.5,198.7,232,198.3,233.5),e.lineTo(196.7,235.2),e.bezierCurveTo(196.6,235.3,196.5,235.4,196.3,235.5),e.bezierCurveTo(195.2,236.4,193.3,237.6,190.7,239.2),e.bezierCurveTo(188.1,240.8,184.5,241.7,179.9,242.1),e.bezierCurveTo(175.3,242.4,172,242.5,169.8,242.3),e.bezierCurveTo(167.8,242.2,165.5,241.7,162.9,240.8),e.bezierCurveTo(160.4,240,158,238,155.6,234.8),e.bezierCurveTo(155.4,234.6,155.3,234.4,155.1,234.2),e.bezierCurveTo(154.3,233,153.5,231.6,152.8,230.1),e.bezierCurveTo(151.9,227.9,151.2,225.3,150.7,222.4),e.bezierCurveTo(150.7,222.2,150.6,222.1,150.6,221.9),e.bezierCurveTo(149.7,216.4,149.3,213.1,149.2,212),e.bezierCurveTo(148.8,215.6,148.6,219.2,148.8,222.8),e.bezierCurveTo(139.8,224.7,129.5,225.7,117.8,225.9),e.bezierCurveTo(109.6,226,101.7,225.5,94.3,224.3),e.bezierCurveTo(94.2,220.8,94,217.1,93.8,213.5),e.bezierCurveTo(93.8,214.9,93.7,216,93.6,216.6),e.bezierCurveTo(93.5,217.2,93.5,217.7,93.4,218.1),e.bezierCurveTo(93.4,218.5,93.2,219.4,92.8,220.9),e.bezierCurveTo(92.6,222,92.3,223,92,224),e.bezierCurveTo(91.9,224.3,91.8,224.6,91.7,224.8),e.bezierCurveTo(91.3,226,90.8,227.2,90.2,228.3),e.bezierCurveTo(89.9,229,89.5,229.7,89.2,230.4),e.bezierCurveTo(88.8,230.9,88.4,231.4,88,231.9),e.bezierCurveTo(87.5,232.6,86.9,233.2,86.2,233.7),e.bezierCurveTo(85.8,234.1,85.4,234.5,84.9,234.9),e.bezierCurveTo(83.9,235.6,82.8,236.2,81.6,236.7),e.bezierCurveTo(80.2,237.3,78.7,237.8,77.1,238.2),e.bezierCurveTo(74.1,238.8,71,239.1,67.8,239.1),e.bezierCurveTo(60.2,239.2,53.4,237.3,47.4,233.3),e.bezierCurveTo(45.9,232.5,45,231.7,44.9,230.9),e.lineTo(44.6,229.2),e.bezierCurveTo(44.6,228.8,44.5,228.3,44.5,227.6),e.bezierCurveTo(44.5,226,44.5,223.5,44.6,220.3),e.lineTo(44.6,213.4),e.lineTo(44.7,207.6),e.lineTo(45.1,204.9),e.lineTo(45.4,203),e.bezierCurveTo(45.4,202.9,45.4,202.8,45.5,202.7),e.bezierCurveTo(43.8,201.2,42.3,199.7,40.9,198.2),e.bezierCurveTo(39.3,196,37.9,193.9,36.5,191.7),e.bezierCurveTo(35.2,189.6,34,187.4,33,185.1),e.lineTo(32.7,183.5),e.bezierCurveTo(31.8,176.3,31,168.9,30.3,161.3),e.bezierCurveTo(30.3,161,30.3,160.7,30.2,160.4),e.bezierCurveTo(34.5,162,39,162.1,43.8,160.4),e.bezierCurveTo(44.4,160.2,45.1,159.9,45.8,159.6),e.lineTo(46.2,159.9),e.bezierCurveTo(46.3,160,46.4,160.1,46.5,160.2),e.bezierCurveTo(52,164,57.9,167.6,64.4,170.9),e.lineTo(65.5,171.5),e.bezierCurveTo(66.9,174.7,68.3,177.8,69.8,180.9),e.bezierCurveTo(71.4,184.1,73.4,187,76,189.7),e.bezierCurveTo(78.5,192.3,81.7,193.4,85.5,193.1),e.bezierCurveTo(89.2,192.6,92.8,191.5,96.3,189.7),e.bezierCurveTo(98.5,188.7,100.4,187.4,102.1,185.9),e.lineTo(102.9,186.2),e.bezierCurveTo(110.1,188.1,116.2,189.1,121.1,189.1),e.bezierCurveTo(128,189,134.8,188,141.7,186.1),e.bezierCurveTo(142.1,186.3,142.6,186.5,143,186.7),e.bezierCurveTo(143.5,186.9,144,187.1,144.5,187.3),e.bezierCurveTo(147.1,188.4,149.8,189.4,152.5,190.3),e.bezierCurveTo(155.3,191.3,158.2,191.8,161.2,191.8),e.bezierCurveTo(164.2,191.8,166.7,190.7,168.6,188.6),e.bezierCurveTo(170,187.2,171.1,185.7,172,184.1),e.bezierCurveTo(173.4,181.7,174.7,179.2,175.9,176.6),e.bezierCurveTo(177.1,174,178.3,171.4,179.4,168.8),e.bezierCurveTo(179.7,168,180,167.4,180.2,166.8),e.bezierCurveTo(183.2,164.8,186.2,162.8,189.3,160.6),e.bezierCurveTo(192.6,158.2,195.6,156,198.4,153.8),e.bezierCurveTo(199.3,153.8,200.6,153.8,202.1,153.6),e.bezierCurveTo(204.6,153.5,207,153.1,209.4,152.5),e.bezierCurveTo(210.5,152.2,211.6,151.8,212.6,151.4),e.bezierCurveTo(212.6,151.4,212.6,151.4,212.6,151.5),e.closePath(),e.moveTo(124.3,61),e.bezierCurveTo(124.5,61.3,124.8,61.6,125,61.9),e.bezierCurveTo(133.4,55.3,142.8,50.4,153.1,47.4),e.bezierCurveTo(149.8,46,146.3,44.6,142.9,43.3),e.bezierCurveTo(139.9,42.5,137.6,41.7,135.8,41.1),e.bezierCurveTo(134.1,40.4,132.7,40,131.6,39.8),e.bezierCurveTo(130.5,39.6,129.5,39.2,128.6,38.8),e.bezierCurveTo(124.4,37.6,120.2,37.4,116.1,38.4),e.bezierCurveTo(115.7,38.5,115.2,38.6,114.8,38.7),e.bezierCurveTo(114.6,38.8,114.2,38.9,113.7,39),e.lineTo(106,40.5),e.bezierCurveTo(102.5,41.1,99.2,41.9,95.9,42.8),e.bezierCurveTo(106.9,45.7,116.3,51.7,124.3,61),e.closePath(),e.moveTo(141.3,19),e.lineTo(143.4,19),e.lineTo(144.6,19.1),e.bezierCurveTo(147.1,19.4,148.8,19.2,149.7,18.6),e.bezierCurveTo(151.7,17.6,152.9,16,153.3,13.7),e.bezierCurveTo(153.7,12.1,153.7,10.4,153.5,8.6),e.bezierCurveTo(152.9,5.3,150.9,3.4,147.6,3.1),e.bezierCurveTo(141,2.4,135.2,4.8,130.1,10.3),e.bezierCurveTo(129.9,15.3,133.6,18.2,141.3,19),e.closePath(),e.moveTo(221,104),e.bezierCurveTo(220.8,103.3,220.5,102.6,220.2,101.9),e.bezierCurveTo(219.3,99.7,218.2,97.5,216.9,95.4),e.bezierCurveTo(213.3,89.7,209.2,84.5,204.4,79.7),e.bezierCurveTo(205.4,83,205.9,86.5,205.9,90.2),e.bezierCurveTo(205.8,91.2,205.8,92.2,205.7,93.2),e.bezierCurveTo(205.5,95.7,205.1,98.2,204.6,100.6),e.bezierCurveTo(204.9,102.3,205.3,104.3,205.7,106.6),e.lineTo(205.7,106.6),e.bezierCurveTo(205.2,104.4,204.9,102.5,204.6,101),e.bezierCurveTo(204.2,103,203.6,104.9,203,106.9),e.lineTo(202.9,106.9),e.bezierCurveTo(200.6,113.5,197.1,119.7,192.3,125.5),e.bezierCurveTo(188.4,130,183.6,133.5,177.8,135.9),e.bezierCurveTo(169.7,139.6,161.7,140.9,153.7,139.7),e.bezierCurveTo(147.7,138.6,142.2,136.2,137.2,132.7),e.bezierCurveTo(131.7,128.8,126.4,125,121.3,121.5),e.lineTo(120.9,121.3),e.lineTo(120.6,121.5),e.bezierCurveTo(113.9,128,106.4,133.2,98,137.3),e.bezierCurveTo(83.7,144,70,142.9,56.8,134),e.bezierCurveTo(50.6,130,45.8,125.2,42.5,119.7),e.bezierCurveTo(38.6,113.5,36.7,106.4,36.6,98.3),e.bezierCurveTo(36.6,93.4,37.1,88.7,38.2,84.1),e.bezierCurveTo(37.7,84.8,37.1,85.5,36.6,86.2),e.bezierCurveTo(29.8,95.7,24.4,105.8,20.3,116.5),e.bezierCurveTo(20.4,116.4,20.4,117,20.3,118.2),e.bezierCurveTo(20.2,119.7,20.7,121.1,21.6,122.5),e.bezierCurveTo(22.2,123.4,23.3,125,25,127.3),e.lineTo(26.2,129.3),e.bezierCurveTo(26.3,129.4,26.4,129.6,26.5,129.7),e.bezierCurveTo(27.9,131.7,29.4,133.7,31.1,135.6),e.bezierCurveTo(34,138.9,37.4,142,41.1,144.9),e.bezierCurveTo(44.1,147.2,47.2,149.4,50.5,151.6),e.bezierCurveTo(52.5,152.9,54.7,154.4,57,155.8),e.bezierCurveTo(60.8,158.3,65.2,160.8,70.1,163.1),e.bezierCurveTo(71,163.6,72,164,72.9,164.4),e.bezierCurveTo(79.8,167.5,86.9,170.1,94.1,172.2),e.bezierCurveTo(101.5,174.4,109,175.9,116.7,176.5),e.bezierCurveTo(122.5,177.2,128.4,177.1,134.5,176.3),e.bezierCurveTo(141.6,175.3,147.4,174,152,172.4),e.bezierCurveTo(156.6,170.7,159.7,169.4,161.4,168.4),e.lineTo(181.4,156.2),e.bezierCurveTo(187.7,152,192.6,148.2,195.9,144.6),e.lineTo(202.9,136.6),e.lineTo(209.8,126.7),e.lineTo(211.7,124),e.lineTo(214.9,119.9),e.lineTo(216.7,117.5),e.bezierCurveTo(217.8,116.3,218.7,115.1,219.4,114),e.bezierCurveTo(219.8,113.5,220.1,113,220.3,112.5),e.bezierCurveTo(220.8,111.5,221.1,110.5,221.3,109.4),e.bezierCurveTo(221.5,108.5,221.6,107.6,221.6,106.7),e.bezierCurveTo(221.6,105.8,221.4,104.9,221,104),e.closePath(),e.fillStyle=`rgb(153, 205, 0)`,e.fill(),e.beginPath(),e.moveTo(245.5,203.6),e.bezierCurveTo(245.4,202.9,245.3,202.4,245.2,202),e.bezierCurveTo(244.7,200.9,244.1,200.1,243.5,199.7),e.bezierCurveTo(242.9,199.2,241.2,198.1,238.5,196.2),e.bezierCurveTo(238,195.9,237.5,195.5,237,195.2),e.bezierCurveTo(234.3,193.5,230.8,191.6,226.3,189.3),e.bezierCurveTo(223,187.4,219.4,185.7,215.7,184.2),e.lineTo(214.7,183.8),e.bezierCurveTo(216,179.3,216.8,174.4,217,169.3),e.bezierCurveTo(217.3,162.5,217.5,155.7,217.3,148.8),e.bezierCurveTo(217.5,148.7,217.7,148.6,217.9,148.5),e.bezierCurveTo(220.1,147,221.6,145.1,222.5,142.8),e.bezierCurveTo(223.5,140.2,224.2,137.4,224.6,134.6),e.bezierCurveTo(224.9,132.2,225,129.8,225.1,127.3),e.bezierCurveTo(225.1,124.8,225.1,122.4,224.8,119.9),e.bezierCurveTo(224.8,119.4,224.7,119,224.6,118.6),e.lineTo(224.5,115.9),e.bezierCurveTo(225.1,114.1,225.4,111.8,225.6,108.9),e.bezierCurveTo(225.7,107.4,225.5,105.8,224.9,104.3),e.bezierCurveTo(220.3,91.4,212.2,80.3,200.6,71),e.bezierCurveTo(195.8,62.6,189,55.8,180.1,50.6),e.bezierCurveTo(172.6,46.4,165.2,45,157.9,46.2),e.bezierCurveTo(155.1,45,152.3,43.9,149.4,42.8),e.bezierCurveTo(148.1,42.3,146.8,41.9,145.5,41.4),e.bezierCurveTo(143.2,40.6,140.8,39.9,138.4,39.2),e.bezierCurveTo(136.1,38.4,133.8,37.6,131.6,36.7),e.bezierCurveTo(131.1,36.6,130.8,36.3,130.4,36),e.bezierCurveTo(130.1,35.6,129.9,35.3,129.8,35),e.bezierCurveTo(129.8,34.3,129.9,33.8,130.1,33.5),e.bezierCurveTo(130.9,31.6,132.7,30,135.7,29),e.bezierCurveTo(137.8,27.6,140.6,26.5,144,25.5),e.bezierCurveTo(152.1,23,156.6,19.2,157.4,13.9),e.bezierCurveTo(158.5,7.2,155.6,2.8,148.7,.7),e.bezierCurveTo(141.1,-1.7,133.2,2,125,11.9),e.bezierCurveTo(121.9,15.6,120.1,19,119.4,22.1),e.lineTo(118.6,25.4),e.bezierCurveTo(118.2,30,117.2,33,115.7,34.5),e.bezierCurveTo(114.8,35.3,113.3,36,111.2,36.6),e.bezierCurveTo(104.1,37.5,97.2,39.2,90.6,41.6),e.bezierCurveTo(89.4,41.4,88.3,41.3,87.1,41.1),e.bezierCurveTo(71.9,41.6,59.7,47.8,50.4,59.6),e.bezierCurveTo(46,64.9,42.7,70.6,40.4,76.7),e.bezierCurveTo(39.8,77.4,39.2,78.1,38.5,78.8),e.bezierCurveTo(29.4,89.5,22.3,101,17.2,113.3),e.bezierCurveTo(16.8,114.3,16.4,115.3,16.1,116.3),e.bezierCurveTo(15.8,117,15.6,117.6,15.5,118.3),e.bezierCurveTo(15.4,118.7,15.3,119.1,15.3,119.5),e.bezierCurveTo(15.2,120.4,15.1,121.2,15.2,122.1),e.bezierCurveTo(15.5,124.5,16.4,127.1,18,129.6),e.bezierCurveTo(18.5,132,18.6,134.2,18.3,136),e.bezierCurveTo(17.4,144.5,19.9,151.6,25.9,157.5),e.bezierCurveTo(25.9,159.4,26,161.4,26.1,163.4),e.bezierCurveTo(26.4,169.1,27.2,175.1,28.4,181.4),e.bezierCurveTo(28.7,182.6,28.9,183.7,29.2,184.9),e.bezierCurveTo(29.1,184.9,29,185,28.9,185),e.bezierCurveTo(25.6,186.9,22.7,188.6,20.2,190.1),e.bezierCurveTo(17.8,191.7,15.6,193.1,13.8,194.4),e.bezierCurveTo(12.5,195.5,11.1,196.7,9.6,197.9),e.bezierCurveTo(7.9,199,6.3,200.4,4.9,201.9),e.bezierCurveTo(3.7,203,2.7,204.1,1.7,205),e.bezierCurveTo(.7,206,.2,207.4,0,209.2),e.bezierCurveTo(-.1,211,0,212.5,.2,213.8),e.bezierCurveTo(.4,215,.9,217,1.5,219.7),e.bezierCurveTo(2.1,222.4,3,224.6,4,226.5),e.bezierCurveTo(5.1,228.3,6.7,229.7,9,230.6),e.bezierCurveTo(9.6,230.8,10.3,231,11.1,231.2),e.bezierCurveTo(14.9,231.1,18.6,231.1,22.4,231.2),e.bezierCurveTo(24.2,231.3,26,231.5,27.8,231.7),e.bezierCurveTo(29.4,231.8,31,232,32.7,232.2),e.bezierCurveTo(34.1,232.3,35.6,232.5,37.1,232.6),e.bezierCurveTo(38.4,232.7,39.8,232.8,41.2,232.9),e.bezierCurveTo(41.5,232.9,41.8,233,42.1,233),e.lineTo(42.2,233.2),e.bezierCurveTo(42.4,233.8,42.8,234.4,43.1,234.8),e.bezierCurveTo(48.8,238.6,55,240.9,61.6,241.5),e.bezierCurveTo(68.7,242.6,75.6,242.3,82.4,240.5),e.bezierCurveTo(82.5,240.5,82.5,240.5,82.6,240.5),e.bezierCurveTo(84,240.2,85.4,239.9,86.7,239.6),e.bezierCurveTo(88.1,239.3,89.3,238.9,90.4,238.4),e.bezierCurveTo(90.9,238.1,91.4,237.8,91.8,237.3),e.bezierCurveTo(104.5,241.2,118.7,242,134.5,239.7),e.bezierCurveTo(139.8,238.9,145.2,237.5,150.9,235.6),e.bezierCurveTo(151.5,237,152.2,238.2,153.1,239.5),e.bezierCurveTo(153.8,240.1,154.6,240.7,155.6,241.3),e.bezierCurveTo(156.9,242.2,158.4,242.9,160.2,243.5),e.bezierCurveTo(161.9,243.8,163.7,244.1,165.5,244.5),e.bezierCurveTo(171.9,244.8,178,244.7,183.5,244.1),e.bezierCurveTo(188,243.7,192.3,242.6,196.2,240.7),e.bezierCurveTo(197,240.3,197.6,239.9,198.3,239.5),e.bezierCurveTo(200,238.4,201.4,237.4,202.3,236.5),e.bezierCurveTo(203.2,235.6,203.9,233.1,204.5,229.2),e.bezierCurveTo(204.5,229,204.6,228.7,204.6,228.3),e.lineTo(223.4,226.8),e.bezierCurveTo(225.5,226.6,227.6,226.4,229.8,226.3),e.bezierCurveTo(232,226.2,233.8,225.5,235.2,224.1),e.bezierCurveTo(237,222.5,238.5,220.8,239.4,219.1),e.bezierCurveTo(240.4,217.5,241.3,215.9,242.2,214.4),e.bezierCurveTo(243,212.9,243.6,211.6,244.1,210.5),e.bezierCurveTo(244.6,209.4,244.9,208.1,245.2,206.7),e.bezierCurveTo(245.4,205.2,245.5,204.2,245.5,203.6),e.closePath(),e.moveTo(219.9,140.2),e.bezierCurveTo(219.5,141.6,218.8,143,218,144.5),e.bezierCurveTo(217.8,144.9,217.6,145.2,217.3,145.6),e.bezierCurveTo(216.7,146.3,215.9,146.9,214.9,147.4),e.bezierCurveTo(214.1,147.8,213.2,148.2,212.3,148.4),e.bezierCurveTo(210.2,149.1,208,149.5,205.6,149.5),e.bezierCurveTo(204.5,149.5,203.4,149.4,202.3,149.3),e.bezierCurveTo(200.6,148.9,199.7,148,199.8,146.7),e.lineTo(200.7,145.2),e.bezierCurveTo(201.3,144.3,201.8,143.4,202.4,142.5),e.bezierCurveTo(202.7,141.9,203,141.3,203.4,140.8),e.bezierCurveTo(203.8,140,204.2,139.2,204.7,138.5),e.bezierCurveTo(205.3,137.7,205.9,136.8,206.5,136),e.bezierCurveTo(206.9,135.5,207.3,135,207.6,134.5),e.bezierCurveTo(208.3,133.7,209,132.8,209.7,132),e.bezierCurveTo(209.9,131.7,210.2,131.4,210.5,131),e.bezierCurveTo(211,130.4,211.5,129.9,212.1,129.3),e.bezierCurveTo(212.6,128.8,213.1,128.3,213.6,127.8),e.bezierCurveTo(214.1,127.4,214.6,127,215.1,126.6),e.bezierCurveTo(215.3,126.4,215.5,126.3,215.6,126.2),e.bezierCurveTo(216.8,125.4,217.9,124.8,219,124.5),e.lineTo(219.3,125.4),e.bezierCurveTo(220,127.9,220.5,130.6,220.8,133.3),e.bezierCurveTo(221,135.7,220.8,138,219.9,140.2),e.closePath(),e.moveTo(106,40.4),e.lineTo(113.7,38.9),e.bezierCurveTo(114.2,38.8,114.6,38.7,114.8,38.6),e.bezierCurveTo(115.2,38.6,115.7,38.4,116.1,38.3),e.bezierCurveTo(117.2,37.9,118.2,37.4,119,36.8),e.lineTo(119.5,35.6),e.lineTo(123.3,21.1),e.bezierCurveTo(124.5,18.2,126.8,14.6,130.1,10.3),e.bezierCurveTo(135.2,4.8,141,2.4,147.6,3.1),e.bezierCurveTo(150.9,3.4,152.9,5.2,153.5,8.5),e.bezierCurveTo(153.7,10.3,153.7,12,153.3,13.7),e.bezierCurveTo(152.9,15.9,151.7,17.6,149.7,18.6),e.bezierCurveTo(148.8,19.2,147.1,19.4,144.6,19.1),e.lineTo(143.4,19),e.lineTo(141.3,19),e.bezierCurveTo(138.9,19.1,136.7,19.9,134.8,21.5),e.bezierCurveTo(132.4,23.5,130.7,25.2,129.7,26.8),e.bezierCurveTo(128.9,28.3,127.9,30.7,126.7,33.8),e.lineTo(126.4,36.8),e.lineTo(126.7,37.7),e.lineTo(128.6,38.7),e.bezierCurveTo(129.5,39.2,130.5,39.5,131.6,39.8),e.bezierCurveTo(132.7,40,134.1,40.4,135.8,41),e.bezierCurveTo(137.6,41.7,139.9,42.4,142.9,43.3),e.bezierCurveTo(146.3,44.6,149.8,46,153.1,47.4),e.bezierCurveTo(142.8,50.4,133.4,55.2,125,61.8),e.bezierCurveTo(124.8,61.6,124.5,61.3,124.3,61),e.bezierCurveTo(116.3,51.7,106.9,45.6,95.9,42.7),e.bezierCurveTo(99.2,41.9,102.5,41.1,106,40.4),e.closePath(),e.moveTo(41.7,90.1),e.bezierCurveTo(42.4,84.8,43.6,79.9,45.5,75.3),e.bezierCurveTo(46.5,72.7,47.7,70.1,49.2,67.7),e.bezierCurveTo(52.7,61.9,57.3,56.8,63,52.3),e.bezierCurveTo(70.4,46.7,77.8,43.8,85.3,43.7),e.bezierCurveTo(87.3,43.6,89.3,43.8,91.3,44.1),e.bezierCurveTo(95.6,44.9,100,46.5,104.4,49.1),e.bezierCurveTo(111.9,53.4,117.3,59.5,120.8,67.4),e.lineTo(124.2,73.8),e.lineTo(124.6,73.8),e.bezierCurveTo(124.7,73.5,124.9,73.2,125,72.9),e.bezierCurveTo(126.3,71.1,127.5,69.4,128.6,67.7),e.bezierCurveTo(136,57.6,146.1,51.7,158.7,50.1),e.bezierCurveTo(158.9,50.1,159.1,50.1,159.2,50.1),e.bezierCurveTo(162.5,50.1,165.7,50.5,168.8,51.2),e.bezierCurveTo(176.5,53,183.4,56.7,189.4,62.4),e.bezierCurveTo(190,63,190.6,63.5,191.1,64.1),e.bezierCurveTo(193.9,67,196.1,70.1,197.8,73.5),e.bezierCurveTo(201.1,79.7,202.5,86.8,202.2,94.7),e.bezierCurveTo(202,99,201.3,103.2,199.9,107.1),e.bezierCurveTo(197.5,114.2,193.1,120.7,186.7,126.4),e.bezierCurveTo(177.6,134.4,168.3,137.9,158.5,137),e.bezierCurveTo(153.1,136.4,149.4,135.6,147.3,134.6),e.bezierCurveTo(137.6,129.8,130.4,122.6,125.6,113),e.bezierCurveTo(124.9,111.7,124.3,110.4,123.8,109),e.bezierCurveTo(123.3,107.9,122.9,106.7,122.6,105.5),e.bezierCurveTo(121.9,106.9,121.2,108.3,120.5,109.6),e.bezierCurveTo(119.7,111,118.8,112.4,118,113.7),e.bezierCurveTo(110.3,125.2,100.6,132.5,88.9,135.6),e.bezierCurveTo(75.9,139.1,64.3,136.3,54.2,127.3),e.bezierCurveTo(51.5,124.9,49.2,122.2,47.4,119.3),e.bezierCurveTo(42.2,111.4,40.4,101.7,41.7,90.1),e.closePath(),e.moveTo(20.3,118.2),e.bezierCurveTo(20.4,117,20.4,116.4,20.3,116.5),e.bezierCurveTo(24.4,105.8,29.8,95.7,36.6,86.2),e.bezierCurveTo(37.1,85.5,37.7,84.8,38.2,84.1),e.bezierCurveTo(37.1,88.6,36.6,93.4,36.6,98.3),e.bezierCurveTo(36.7,106.3,38.6,113.5,42.5,119.7),e.bezierCurveTo(45.8,125.2,50.6,129.9,56.8,134),e.bezierCurveTo(70,142.9,83.7,143.9,98,137.2),e.bezierCurveTo(106.4,133.2,113.9,127.9,120.6,121.5),e.lineTo(120.9,121.3),e.lineTo(121.3,121.5),e.bezierCurveTo(126.4,125,131.7,128.7,137.2,132.7),e.bezierCurveTo(142.2,136.2,147.7,138.6,153.7,139.7),e.bezierCurveTo(161.7,140.8,169.7,139.6,177.8,135.9),e.bezierCurveTo(183.6,133.5,188.4,130,192.3,125.5),e.bezierCurveTo(197.1,119.7,200.6,113.5,202.9,106.8),e.bezierCurveTo(203.6,104.8,204.2,102.7,204.6,100.6),e.bezierCurveTo(205.1,98.2,205.5,95.7,205.7,93.2),e.bezierCurveTo(205.8,92.2,205.8,91.1,205.9,90.2),e.bezierCurveTo(205.9,86.5,205.4,83,204.4,79.6),e.bezierCurveTo(209.2,84.5,213.3,89.7,216.9,95.4),e.bezierCurveTo(218.2,97.5,219.3,99.6,220.2,101.8),e.bezierCurveTo(220.5,102.5,220.8,103.3,221,104),e.bezierCurveTo(221.4,104.9,221.6,105.7,221.6,106.6),e.bezierCurveTo(221.6,107.6,221.5,108.5,221.3,109.4),e.bezierCurveTo(221.1,110.4,220.8,111.5,220.3,112.5),e.bezierCurveTo(220.1,113,219.8,113.5,219.4,114),e.bezierCurveTo(218.7,115.1,217.8,116.3,216.7,117.4),e.lineTo(214.9,119.9),e.lineTo(211.7,124),e.lineTo(209.8,126.7),e.lineTo(202.9,136.6),e.lineTo(195.9,144.6),e.bezierCurveTo(192.6,148.2,187.7,152,181.4,156.2),e.lineTo(161.4,168.4),e.bezierCurveTo(159.7,169.4,156.6,170.7,152,172.3),e.bezierCurveTo(147.4,173.9,141.6,175.3,134.5,176.2),e.bezierCurveTo(128.4,177.1,122.5,177.2,116.7,176.5),e.bezierCurveTo(109,175.8,101.5,174.4,94.1,172.2),e.bezierCurveTo(86.9,170,79.8,167.4,72.9,164.4),e.bezierCurveTo(72,164,71,163.5,70.1,163.1),e.bezierCurveTo(65.2,160.7,60.8,158.3,57,155.8),e.bezierCurveTo(54.7,154.3,52.5,152.9,50.5,151.5),e.bezierCurveTo(47.2,149.4,44.1,147.1,41.1,144.8),e.bezierCurveTo(37.4,142,34,138.9,31.1,135.5),e.bezierCurveTo(29.4,133.7,27.9,131.7,26.5,129.7),e.bezierCurveTo(26.4,129.5,26.3,129.4,26.2,129.3),e.lineTo(25,127.3),e.bezierCurveTo(23.3,125,22.2,123.4,21.6,122.5),e.bezierCurveTo(20.7,121.1,20.2,119.7,20.3,118.2),e.closePath(),e.moveTo(177.9,163.2),e.lineTo(174.9,169.8),e.lineTo(174.7,170.3),e.lineTo(174.4,170.9),e.bezierCurveTo(174,172.1,173.5,173.3,173.1,174.5),e.bezierCurveTo(172.2,177.2,171.1,179.7,169.6,182.2),e.bezierCurveTo(168.3,184.5,166.3,186.1,163.6,187.2),e.bezierCurveTo(160.6,188.4,157.5,188.5,154.4,187.3),e.bezierCurveTo(151.9,186.4,149.5,185.5,147.2,184.7),e.lineTo(146.7,184.5),e.lineTo(146.3,184.3),e.lineTo(140.9,182.4),e.bezierCurveTo(142.8,182.1,145,181.4,147.5,180.4),e.bezierCurveTo(148.2,180,148.9,179.7,149.6,179.4),e.bezierCurveTo(152.5,178,155.3,176.5,158.1,174.8),e.bezierCurveTo(161.2,172.9,164.4,171.1,167.5,169.3),e.bezierCurveTo(170.7,167.7,173.7,165.9,176.8,163.9),e.bezierCurveTo(177.2,163.7,177.6,163.5,177.9,163.2),e.closePath(),e.moveTo(101.1,181.4),e.lineTo(97.1,184.2),e.lineTo(96.8,184.3),e.lineTo(96.3,184.7),e.bezierCurveTo(93.2,186.5,90.2,187.9,87.1,188.9),e.bezierCurveTo(83.9,189.9,81.1,189.2,78.6,186.6),e.bezierCurveTo(76,184.1,74,181.3,72.5,178.3),e.bezierCurveTo(71.3,175.7,70.1,172.9,69,170.1),e.lineTo(68,167.8),e.bezierCurveTo(67.8,167.3,67.7,166.8,67.5,166.3),e.bezierCurveTo(69.1,167.1,70.7,167.9,72.4,168.8),e.bezierCurveTo(74.1,169.6,75.9,170.5,77.9,171.4),e.bezierCurveTo(79.9,172.3,83.2,173.8,87.9,175.9),e.bezierCurveTo(92.5,177.9,95.7,179.3,97.5,180),e.bezierCurveTo(99.2,180.7,100.4,181.2,101.1,181.4),e.closePath(),e.moveTo(25.8,151.1),e.bezierCurveTo(23.2,147.7,22,143.6,22.3,139),e.bezierCurveTo(22.3,139,22.3,139,22.3,139),e.lineTo(22.4,135.1),e.bezierCurveTo(22.5,134.4,22.9,134.4,23.6,134.9),e.bezierCurveTo(24.4,135.4,25.2,136,26,136.6),e.bezierCurveTo(27.6,137.8,29.1,139,30.7,140.2),e.bezierCurveTo(34.1,142.9,37.3,145.8,40.4,148.8),e.bezierCurveTo(42.4,150.6,44.1,152.6,45.6,154.7),e.bezierCurveTo(45.8,155.3,45.9,155.7,45.7,156),e.lineTo(45.5,156.1),e.bezierCurveTo(40.5,158.4,35.6,158.3,30.9,155.9),e.bezierCurveTo(30.6,155.7,30.3,155.6,30,155.4),e.bezierCurveTo(30,155.3,29.9,155.3,29.9,155.3),e.bezierCurveTo(28.3,154,26.9,152.6,25.8,151.1),e.closePath(),e.moveTo(240.9,209.6),e.bezierCurveTo(240.1,211.5,239.1,213.3,237.8,215),e.bezierCurveTo(236.5,216.5,235.2,218.1,233.9,219.6),e.bezierCurveTo(233.4,220.2,232.8,220.7,232.3,221.1),e.bezierCurveTo(230.1,222.1,227.5,222.5,224.3,222.1),e.bezierCurveTo(218.9,221.9,213.4,222,207.7,222.3),e.bezierCurveTo(206.5,222.4,205.3,222.4,204,222.5),e.bezierCurveTo(203.3,218.7,201.8,213.8,199.6,207.8),e.lineTo(200.2,212.5),e.bezierCurveTo(200.1,212,200,211.2,199.7,210.2),e.bezierCurveTo(199.9,214.1,200,218.2,199.9,222.3),e.bezierCurveTo(199.9,222.5,199.9,222.7,199.9,222.9),e.bezierCurveTo(199.9,225,199.7,226.9,199.4,228.8),e.bezierCurveTo(199.1,230.4,198.7,232,198.3,233.5),e.lineTo(196.7,235.1),e.bezierCurveTo(196.6,235.2,196.5,235.4,196.3,235.5),e.bezierCurveTo(195.2,236.4,193.3,237.6,190.7,239.1),e.bezierCurveTo(188.1,240.7,184.5,241.7,179.9,242.1),e.bezierCurveTo(175.3,242.4,172,242.5,169.8,242.3),e.bezierCurveTo(167.8,242.1,165.5,241.6,162.9,240.8),e.bezierCurveTo(160.4,239.9,158,237.9,155.6,234.8),e.bezierCurveTo(155.4,234.6,155.3,234.4,155.1,234.2),e.bezierCurveTo(154.3,233,153.5,231.6,152.8,230),e.bezierCurveTo(151.9,227.8,151.2,225.3,150.7,222.4),e.bezierCurveTo(150.7,222.2,150.6,222.1,150.6,221.9),e.bezierCurveTo(149.7,216.4,149.3,213.1,149.2,212),e.bezierCurveTo(148.8,215.6,148.6,219.2,148.8,222.8),e.bezierCurveTo(148.9,225.2,149,227.6,149.4,230),e.bezierCurveTo(149.4,230.3,149.4,230.6,149.5,231),e.bezierCurveTo(141,233.2,132.2,234.4,123.2,234.4),e.bezierCurveTo(113.4,235.1,103.6,234.6,93.8,233),e.lineTo(94,232),e.bezierCurveTo(94.3,230,94.4,228.1,94.4,226.2),e.bezierCurveTo(94.4,225.6,94.3,224.9,94.3,224.3),e.bezierCurveTo(94.2,220.7,94,217.1,93.8,213.5),e.bezierCurveTo(93.8,214.9,93.7,215.9,93.6,216.6),e.bezierCurveTo(93.5,217.2,93.5,217.7,93.4,218.1),e.bezierCurveTo(93.4,218.5,93.2,219.4,92.8,220.9),e.bezierCurveTo(92.6,222,92.3,223,92,223.9),e.bezierCurveTo(91.9,224.2,91.8,224.5,91.7,224.8),e.bezierCurveTo(91.3,226,90.8,227.1,90.2,228.3),e.bezierCurveTo(89.9,229,89.5,229.7,89.2,230.4),e.bezierCurveTo(88.8,230.9,88.4,231.4,88,231.9),e.bezierCurveTo(87.5,232.5,86.9,233.1,86.2,233.7),e.bezierCurveTo(85.8,234.1,85.4,234.5,84.9,234.8),e.bezierCurveTo(83.9,235.6,82.8,236.2,81.6,236.7),e.bezierCurveTo(80.2,237.3,78.7,237.7,77.1,238.1),e.bezierCurveTo(74.1,238.7,71,239,67.8,239),e.bezierCurveTo(60.3,239.1,53.6,237.3,47.7,233.5),e.bezierCurveTo(47.6,233.4,47.5,233.4,47.4,233.3),e.bezierCurveTo(45.9,232.5,45,231.7,44.9,230.9),e.lineTo(44.6,229.2),e.bezierCurveTo(44.6,228.8,44.5,228.2,44.5,227.6),e.bezierCurveTo(44.5,225.9,44.5,223.5,44.6,220.3),e.lineTo(44.6,213.4),e.lineTo(44.7,207.6),e.lineTo(43.7,213),e.lineTo(42.4,220.3),e.bezierCurveTo(41.9,223.1,41.7,225.4,41.6,227.4),e.bezierCurveTo(41,227.3,40.3,227.3,39.7,227.2),e.bezierCurveTo(37.7,227.2,35.8,227.2,33.8,227.2),e.bezierCurveTo(32,227.2,30.2,227.2,28.4,227.2),e.bezierCurveTo(26.4,227.2,24.5,227.3,22.6,227.4),e.bezierCurveTo(21.3,227.4,19.7,227.5,17.8,227.7),e.bezierCurveTo(15.9,227.9,13.9,227.7,11.9,227.1),e.bezierCurveTo(9.8,226.4,8.3,225.2,7.4,223.5),e.bezierCurveTo(6.5,221.8,5.6,219.7,4.8,217.3),e.bezierCurveTo(4,214.8,3.5,212.9,3.3,211.5),e.bezierCurveTo(3.2,210.1,3.6,209,4.5,208.2),e.bezierCurveTo(5.4,207.3,6.7,206.1,8.4,204.6),e.bezierCurveTo(10.2,202.9,11.6,201.6,12.7,200.6),e.bezierCurveTo(13.7,199.6,16.9,197.2,22.4,193.3),e.bezierCurveTo(26.1,190.5,28.7,189.1,30.1,188.9),e.bezierCurveTo(31.2,193,32.3,197,33.7,201),e.bezierCurveTo(34.2,202.8,35,204.4,36,205.9),e.lineTo(33.3,187.7),e.lineTo(33.1,185.9),e.lineTo(32.9,184.7),e.lineTo(32.7,183.4),e.bezierCurveTo(31.8,176.3,31,168.9,30.3,161.3),e.bezierCurveTo(30.3,161,30.3,160.7,30.2,160.3),e.bezierCurveTo(34.5,162,39,162,43.8,160.4),e.bezierCurveTo(44.4,160.1,45.1,159.9,45.8,159.6),e.lineTo(50.7,157.9),e.lineTo(63.1,164.7),e.bezierCurveTo(63.4,166,64,168,65.2,170.7),e.lineTo(65.5,171.5),e.bezierCurveTo(66.9,174.7,68.3,177.8,69.8,180.9),e.bezierCurveTo(71.4,184.1,73.4,187,76,189.6),e.bezierCurveTo(78.5,192.2,81.7,193.4,85.5,193.1),e.bezierCurveTo(89.2,192.6,92.8,191.5,96.3,189.7),e.bezierCurveTo(98.5,188.6,100.4,187.4,102.1,185.9),e.lineTo(103.2,185),e.bezierCurveTo(103.4,184.9,103.6,184.7,103.8,184.6),e.bezierCurveTo(106.5,182.5,108.3,180.9,109.3,179.7),e.lineTo(109.4,179.7),e.bezierCurveTo(114,180.5,118.1,181,121.9,181.4),e.bezierCurveTo(125.7,181.8,128.8,181.8,131.3,181.4),e.bezierCurveTo(133,181.8,136.2,183.2,140.7,185.6),e.bezierCurveTo(141,185.7,141.3,185.9,141.7,186),e.bezierCurveTo(142.1,186.3,142.6,186.5,143,186.7),e.bezierCurveTo(143.5,186.9,144,187.1,144.5,187.3),e.bezierCurveTo(147.1,188.4,149.8,189.4,152.5,190.3),e.bezierCurveTo(155.3,191.3,158.2,191.7,161.2,191.7),e.bezierCurveTo(164.2,191.7,166.7,190.7,168.6,188.6),e.bezierCurveTo(170,187.2,171.1,185.6,172,184.1),e.bezierCurveTo(173.4,181.6,174.7,179.1,175.9,176.6),e.bezierCurveTo(177.1,174,178.3,171.4,179.4,168.7),e.bezierCurveTo(179.7,168,180,167.3,180.2,166.7),e.bezierCurveTo(181.4,164,182,162.2,182,161.5),e.bezierCurveTo(183.8,160.7,186.6,158.8,190.2,155.8),e.lineTo(191,155.2),e.bezierCurveTo(191.7,154.5,192.6,153.8,193.4,153.2),e.bezierCurveTo(193.8,153,194.1,152.8,194.5,152.6),e.lineTo(196.6,153.6),e.bezierCurveTo(197,153.7,197.6,153.8,198.4,153.8),e.bezierCurveTo(199.3,153.8,200.6,153.7,202.1,153.6),e.bezierCurveTo(204.6,153.5,207,153.1,209.4,152.5),e.bezierCurveTo(210.5,152.1,211.6,151.8,212.6,151.3),e.bezierCurveTo(212.6,151.4,212.6,151.4,212.6,151.4),e.bezierCurveTo(213.3,158.8,213.4,166.1,212.8,173.3),e.lineTo(211.2,182.6),e.lineTo(211,183.6),e.lineTo(209.4,192.8),e.lineTo(208.3,198),e.lineTo(208.4,198.1),e.bezierCurveTo(210.9,194.2,212.8,190,214.2,185.6),e.lineTo(240.5,201.5),e.bezierCurveTo(241.1,202.2,241.6,202.9,241.8,203.6),e.bezierCurveTo(242.1,205.4,241.8,207.4,240.9,209.6),e.closePath(),e.fillStyle=`rgb(35, 44, 30)`,e.fill(),e.beginPath(),e.moveTo(219.9,140.2),e.bezierCurveTo(219.5,141.6,218.8,143,218,144.5),e.bezierCurveTo(217.8,144.9,217.6,145.2,217.3,145.6),e.bezierCurveTo(216.7,146.3,215.9,146.9,214.9,147.4),e.bezierCurveTo(214.1,147.8,213.2,148.2,212.3,148.4),e.bezierCurveTo(210.2,149.1,208,149.5,205.6,149.5),e.bezierCurveTo(204.5,149.5,203.4,149.4,202.3,149.3),e.bezierCurveTo(200.6,148.9,199.7,148,199.8,146.7),e.lineTo(200.7,145.2),e.bezierCurveTo(201.3,144.3,201.8,143.4,202.4,142.5),e.bezierCurveTo(202.7,141.9,203,141.3,203.4,140.8),e.bezierCurveTo(203.8,140,204.2,139.2,204.7,138.5),e.bezierCurveTo(205.3,137.7,205.9,136.8,206.5,136),e.bezierCurveTo(206.9,135.5,207.3,135,207.6,134.5),e.bezierCurveTo(208.3,133.7,209,132.8,209.7,132),e.bezierCurveTo(209.9,131.7,210.2,131.4,210.5,131),e.bezierCurveTo(211,130.4,211.5,129.9,212.1,129.3),e.bezierCurveTo(212.6,128.8,213.1,128.3,213.6,127.8),e.bezierCurveTo(214.1,127.4,214.6,127,215.1,126.6),e.bezierCurveTo(215.3,126.4,215.5,126.3,215.6,126.2),e.bezierCurveTo(216.8,125.4,217.9,124.8,219,124.5),e.lineTo(219.3,125.4),e.bezierCurveTo(220,127.9,220.5,130.6,220.8,133.3),e.bezierCurveTo(221,135.7,220.8,138,219.9,140.2),e.closePath(),e.moveTo(40.4,148.8),e.bezierCurveTo(37.3,145.8,34.1,142.9,30.7,140.2),e.bezierCurveTo(29.1,139,27.6,137.8,26,136.6),e.bezierCurveTo(25.2,136,24.4,135.4,23.6,134.9),e.bezierCurveTo(22.9,134.4,22.5,134.4,22.4,135.1),e.lineTo(22.3,139),e.bezierCurveTo(22.3,139,22.3,139,22.3,139),e.bezierCurveTo(22,143.6,23.2,147.7,25.8,151.1),e.bezierCurveTo(26.9,152.6,28.3,154,29.9,155.3),e.bezierCurveTo(29.9,155.3,30,155.3,30,155.4),e.bezierCurveTo(30.3,155.6,30.6,155.7,30.9,155.9),e.bezierCurveTo(35.6,158.3,40.5,158.4,45.5,156.1),e.lineTo(45.7,156),e.bezierCurveTo(45.9,155.7,45.8,155.3,45.6,154.7),e.bezierCurveTo(44.1,152.6,42.4,150.6,40.4,148.8),e.closePath(),e.moveTo(87.9,175.9),e.bezierCurveTo(83.2,173.8,79.9,172.3,77.9,171.4),e.bezierCurveTo(75.9,170.5,74.1,169.6,72.4,168.8),e.bezierCurveTo(70.7,167.9,69.1,167.1,67.5,166.3),e.bezierCurveTo(67.7,166.8,67.8,167.3,68,167.8),e.lineTo(69,170.1),e.bezierCurveTo(70.1,172.9,71.3,175.7,72.5,178.3),e.bezierCurveTo(74,181.3,76,184.1,78.6,186.6),e.bezierCurveTo(81.1,189.2,83.9,189.9,87.1,188.9),e.bezierCurveTo(90.2,187.9,93.2,186.5,96.3,184.7),e.lineTo(96.8,184.3),e.lineTo(97.1,184.2),e.lineTo(101.1,181.4),e.bezierCurveTo(100.4,181.2,99.2,180.7,97.5,180),e.bezierCurveTo(95.7,179.3,92.5,177.9,87.9,175.9),e.closePath(),e.moveTo(167.5,169.3),e.bezierCurveTo(164.4,171.1,161.2,172.9,158.1,174.8),e.bezierCurveTo(155.3,176.5,152.5,178,149.6,179.4),e.bezierCurveTo(148.9,179.7,148.2,180,147.5,180.4),e.bezierCurveTo(145,181.4,142.8,182.1,140.9,182.4),e.lineTo(146.3,184.3),e.lineTo(146.7,184.5),e.lineTo(147.2,184.7),e.bezierCurveTo(149.5,185.5,151.9,186.4,154.4,187.3),e.bezierCurveTo(157.5,188.5,160.6,188.4,163.6,187.2),e.bezierCurveTo(166.3,186.1,168.3,184.5,169.6,182.2),e.bezierCurveTo(171.1,179.7,172.2,177.2,173.1,174.5),e.bezierCurveTo(173.5,173.3,174,172.1,174.4,170.9),e.lineTo(174.7,170.3),e.lineTo(174.9,169.8),e.lineTo(177.9,163.2),e.bezierCurveTo(177.6,163.5,177.2,163.7,176.8,163.9),e.bezierCurveTo(173.7,165.9,170.7,167.7,167.5,169.3),e.closePath(),e.moveTo(202.2,94.7),e.bezierCurveTo(202.5,86.8,201.1,79.7,197.8,73.5),e.bezierCurveTo(196.1,70.1,193.9,67,191.1,64.1),e.bezierCurveTo(190.6,63.5,190,63,189.4,62.4),e.bezierCurveTo(183.4,56.7,176.5,53,168.8,51.2),e.bezierCurveTo(165.7,50.5,162.5,50.1,159.2,50.1),e.bezierCurveTo(159.1,50.1,158.9,50.1,158.7,50.1),e.bezierCurveTo(146.1,51.7,136,57.6,128.6,67.7),e.bezierCurveTo(127.5,69.4,126.3,71.1,125,72.9),e.bezierCurveTo(124.9,73.2,124.7,73.5,124.6,73.8),e.lineTo(124.4,74.2),e.lineTo(124.2,73.8),e.lineTo(120.8,67.4),e.bezierCurveTo(117.3,59.5,111.9,53.4,104.4,49.1),e.bezierCurveTo(100,46.5,95.6,44.9,91.3,44.1),e.bezierCurveTo(89.3,43.8,87.3,43.6,85.3,43.7),e.bezierCurveTo(77.8,43.8,70.4,46.7,63,52.3),e.bezierCurveTo(57.3,56.8,52.7,61.9,49.2,67.7),e.bezierCurveTo(47.7,70.1,46.5,72.7,45.5,75.3),e.bezierCurveTo(43.6,79.9,42.4,84.8,41.7,90.1),e.bezierCurveTo(40.4,101.7,42.2,111.4,47.4,119.3),e.bezierCurveTo(49.2,122.2,51.5,124.9,54.2,127.3),e.bezierCurveTo(64.3,136.3,75.9,139.1,88.9,135.6),e.bezierCurveTo(100.6,132.5,110.3,125.2,118,113.7),e.bezierCurveTo(118.8,112.4,119.7,111,120.5,109.6),e.bezierCurveTo(121.2,108.3,121.9,106.9,122.6,105.5),e.bezierCurveTo(122.9,106.7,123.3,107.9,123.8,109),e.bezierCurveTo(124.3,110.4,124.9,111.7,125.6,113),e.bezierCurveTo(130.4,122.6,137.6,129.8,147.3,134.6),e.bezierCurveTo(149.4,135.6,153.1,136.4,158.5,137),e.bezierCurveTo(168.3,137.9,177.6,134.4,186.7,126.4),e.bezierCurveTo(193.1,120.7,197.5,114.2,199.9,107.1),e.bezierCurveTo(201.3,103.2,202,99,202.2,94.7),e.closePath(),e.fillStyle=`rgb(255, 255, 255)`,e.fill(),e.save(),e.translate(a,0),e.beginPath(),e.moveTo(101.3,71.1),e.bezierCurveTo(101,71.1,100.7,71.2,100.5,71.3),e.bezierCurveTo(100.5,71.3,100.5,71.3,100.5,71.3),e.bezierCurveTo(102.7,72.9,103.8,75.8,104,79.9),e.bezierCurveTo(104.1,84.2,100.5,86.1,93,85.6),e.bezierCurveTo(91,85.5,89.2,85.4,87.8,85.3),e.bezierCurveTo(87.7,86.6,87.6,87.9,87.6,89.3),e.bezierCurveTo(87.8,91.8,88.6,94.3,89.9,96.7),e.bezierCurveTo(91.9,101.5,95.2,103.9,99.8,103.9),e.bezierCurveTo(107.4,103.7,112.3,98,114.7,86.8),e.bezierCurveTo(114.7,74.4,110.2,69.2,101.3,71.1),e.closePath(),e.fillStyle=`rgb(0, 0, 0)`,e.fill(),e.restore(),e.save(),e.translate(o,0),e.beginPath(),e.moveTo(150.4,74.1),e.bezierCurveTo(147.9,71.7,145.3,70.5,142.4,70.5),e.bezierCurveTo(141.5,70.5,140.5,70.7,139.6,71),e.bezierCurveTo(140.1,71.3,140.6,71.6,141.1,72),e.bezierCurveTo(143.3,73.6,144.5,76.5,144.6,80.6),e.bezierCurveTo(144.8,84.9,141.1,86.8,133.7,86.3),e.bezierCurveTo(132.1,86.2,130.8,86.2,129.6,86.1),e.bezierCurveTo(129.6,86.2,129.6,86.2,129.6,86.3),e.bezierCurveTo(129.6,89.1,130.2,91.7,131.5,94.1),e.bezierCurveTo(134.1,99,138.3,101.5,144,101.5),e.bezierCurveTo(146.8,101.7,149.7,99.7,152.5,95.6),e.bezierCurveTo(154.5,91.6,155.5,88.9,155.5,87.5),e.bezierCurveTo(155.5,81.9,153.8,77.5,150.4,74.1),e.closePath(),e.fillStyle=`rgb(0, 0, 0)`,e.fill(),e.restore(),e.restore(),e.restore()};var W=document.querySelector(`#e`),dt=document.querySelector(`#moreCanvas`);document.querySelector(`#dshareBtn`);var ft=document.querySelector(`#d`),pt=document.querySelector(`#moreLink`),mt=document.querySelector(`#d`),G=document.querySelector(`#dframe`),K=document.querySelector(`#dmsg`),q=document.querySelector(`#dshareBtn`),J=document.querySelector(`#dpic`),Y=document.querySelector(`#gameBtnTray`),ht=new class{domReady;appReady;showOmNom;showDrawing;constructor(){let e=l.uiScaledNumber(2.2),t=(e,t,n={})=>e?e.animate(t,{fill:`forwards`,...n}).finished.catch(e=>{console.warn(`Easter egg animation interrupted`,e)}):Promise.resolve(),n=(e,{from:t=null,to:n=1,duration:r=200,delay:i=0,display:a}={})=>{if(!e)return Promise.resolve();a&&(e.style.removeProperty(`display`),window.getComputedStyle(e).display===`none`&&(e.style.display=a));let o=t===null?Number.parseFloat(getComputedStyle(e).opacity)||0:t;return t!==null&&(e.style.opacity=String(t)),e.animate([{opacity:o},{opacity:n}],{duration:r,delay:i,easing:`linear`,fill:`forwards`}).finished.catch(e=>{console.warn(`Easter egg fade animation interrupted`,e)}).then(()=>{n===0&&a===`none`&&(e.style.display=`none`)})},r=e=>`${e}px`,i={easeOutBack:`cubic-bezier(0.175, 0.885, 0.32, 1.275)`,easeInExpo:`cubic-bezier(0.95, 0.05, 0.795, 0.035)`},a=null,o=null;this.domReady=()=>{W&&(W.width=l.uiScaledNumber(1024),W.height=l.uiScaledNumber(576)),dt&&(dt.width=51,dt.height=51),ft&&ft.addEventListener(`click`,()=>{c()}),pt&&pt.addEventListener(`mouseenter`,()=>{f||(f=!0,p(()=>{f=!1}))})},this.appReady=()=>{E.subscribe(E.ChannelId.LanguageChanged,()=>{g.drawBig({text:d.menuText(x.FOUND_DRAWING),imgId:`dmsg`,scaleToUI:!0}),g.drawBig({text:d.menuText(x.SHARE),imgSel:`#dshareBtn img`,scaleToUI:!0})}),E.subscribe(E.ChannelId.OmNomClicked,this.showOmNom),E.subscribe(E.ChannelId.DrawingClicked,(...e)=>{this.showDrawing(e[0])})};let s=null;this.showDrawing=e=>{if(s=e+1,B.pauseLevel(),Y){if(o===null){let e=getComputedStyle(Y).display;o=e===`none`?``:e}Y.style.display=`none`}J&&(a===null?a=J.className:J.className=a,J.classList.add(`drawing${s}`));let c=r(l.uiScaledNumber(100)),u=r(l.uiScaledNumber(60));G&&(G.style.top=c,G.style.transform=`scale(0.35)`,G.style.opacity=`0`),K&&(K.style.top=u,K.style.transform=`scale(0.5)`,K.style.opacity=`0`),q&&(q.style.opacity=`0`,q.style.pointerEvents=`none`),n(mt,{from:0,to:1,duration:100,display:`block`}).then(()=>{G&&(G.style.opacity=`1`,t(G,[{top:c,transform:`scale(0.35)`},{top:`0px`,transform:`scale(1)`}],{duration:350,easing:i.easeOutBack}).then(()=>{G.style.top=`0px`,G.style.transform=`scale(1)`})),K&&(K.style.opacity=`1`,t(K,[{top:u,transform:`scale(0.5)`},{top:`0px`,transform:`scale(1)`}],{duration:350,easing:i.easeOutBack}).then(()=>{K.style.top=`0px`,K.style.transform=`scale(1)`})),q&&setTimeout(()=>{n(q,{from:0,to:1,duration:200}).then(()=>{q.style.opacity=`1`,q.style.pointerEvents=``})},600)})};let c=()=>{J&&(J.className=a||``);let e=r(l.uiScaledNumber(50));q&&(q.style.pointerEvents=`none`,n(q,{from:1,to:0,duration:200}).then(()=>{q.style.opacity=`0`})),t(G,[{top:`0px`,transform:`scale(1)`},{top:e,transform:`scale(0.2)`}],{duration:350,easing:i.easeInExpo}).then(()=>{G&&(G.style.top=e,G.style.transform=`scale(0.2)`)}),t(K,[{top:`0px`,transform:`scale(1)`},{top:e,transform:`scale(0.2)`}],{duration:350,easing:i.easeInExpo}).then(()=>{K&&(K.style.top=e,K.style.transform=`scale(0.2)`)}),setTimeout(()=>{n(mt,{from:1,to:0,duration:200}).then(()=>{mt&&(mt.style.display=`none`,mt.style.opacity=``),B.resumeLevel(),s=null,Y&&(Y.style.removeProperty(`display`),window.getComputedStyle(Y).display===`none`&&(Y.style.display=o||``))})},200)},f=!1,p=e=>{if(!dt)return;let t=dt.getContext(`2d`);if(!t)return;let n=Date.now(),r=.1,i=0,a=0,o=0,s=1e3,c=600+s,l=700+c,d=500+l,f=800+d,p=0,m=e=>e<600?1:e<s?2:e<c?3:e<l?4:e<d?5:e<f?6:7,h=()=>{let g=Date.now()-n;switch(m(g)){case 1:r=0-u.easeOutBounce(g,0,100,600,1.5);break;case 2:g>700&&(a=-1*u.easeOutExpo(g-700,0,10,s-700),o=a);break;case 3:a=-10+u.easeInOutExpo(g-s,0,20,c-s),o=a;break;case 4:g>c+100&&(a=10-u.easeInOutExpo(g-(c+100),0,10,l-(c+100)),o=a);break;case 5:break;case 6:i=u.easeOutExpo(g-d,0,50,f-d);break}g>600&&g<c&&(p=u.easeInOutBounce(g-600,0,.02,c-600,6)),g>c&&g<d&&(p=.02-u.easeInOutBounce(g-c,0,.02,d-c,2));let _=75+i+r;t.save(),t.rotate(30*Math.PI/180),ut(t,.32,.32+p,0,_,a,o),t.restore(),g<f?window.requestAnimationFrame(h):e()};window.requestAnimationFrame(h)};this.showOmNom=()=>{if(!W)return;let t=W.getContext(`2d`);t&&(B.pauseLevel(),n(W,{from:0,to:1,duration:200,display:`block`}).then(()=>{let r=Date.now(),i=.1,a=.1,o=0,s=0,c=0,d=i,f=a,p=o,m=1e3,h=600+m,g=700+h,_=500+g,v=800+_,y=0,b=e=>e<600?1:e<m?2:e<h?3:e<g?4:e<_?5:e<v?6:7,x=()=>{let S=Date.now()-r;switch(b(S)){case 1:i=u.easeOutBounce(S,d,e,600,1.5),a=u.easeOutBounce(S,f,e,600,1.5);break;case 2:S>700&&(s=-1*u.easeOutExpo(S-700,0,l.uiScaledNumber(10),m-700),c=s);break;case 3:s=l.uiScaledNumber(-10)+u.easeInOutExpo(S-m,0,l.uiScaledNumber(20),h-m),c=s;break;case 4:S>h+100&&(s=l.uiScaledNumber(10)-u.easeInOutExpo(S-(h+100),0,l.uiScaledNumber(10),g-(h+100)),c=s);break;case 5:break;case 6:o=u.easeOutExpo(S-_,p,l.uiScaledNumber(300),v-_);let t=u.easeOutExpo(S-_,0,e-.1,v-_);i=e-t,a=e-t;break}S>600&&S<h&&(y=u.easeInOutBounce(S-600,0,.1,h-600,6)),S>h&&S<_&&(y=.1-u.easeInOutBounce(S-h,0,.1,_-h,2)),S<v?window.requestAnimationFrame(x):(n(W,{from:1,to:0,duration:200}).then(()=>{t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,W.width,W.height),W.style.display=`none`}),B.resumeLevel());let C=0+(l.uiScaledNumber(500)-i/e*l.uiScaledNumber(200)),w=o+(l.uiScaledNumber(600)-a/e*l.uiScaledNumber(400));ut(t,i,a+y,C,w,s,c)};window.requestAnimationFrame(x)}))}}},gt=document.getElementById(`levelResults`),_t=document.getElementById(`levelMenu`),vt=class{manager;constructor(e){this.manager=e}_notifyBeginTransition(e,t){let n=this.manager;n.isTransitionActive=!0,n._transitionTimeout!=null&&clearTimeout(n._transitionTimeout),n._transitionTimeout=window.setTimeout(()=>{n.isTransitionActive=!1,n._transitionTimeout=null},e)}_runScoreTicker(){let e=this.manager;if(ve(`#resultScore`,e._resultBottomLines[e._currentResultLine]??``),e._currentResultLine++,e._currentResultLine<e._resultTopLines.length){let t=e._currentResultLine<e._resultTimeShiftIndex?10:167;window.setTimeout(()=>this._runScoreTicker(),t)}}_isLastLevel(){let e=_.requiredCount()-1;if(_.currentBoxIndex!==e)return!1;let t=m.levelCount(_.currentBoxIndex);return _.currentLevelIndex===t?_.currentLevelIndex===t:!1}_openLevel(e,t,n){H.fadeIn(650,100),_.currentLevelIndex=e,this._isLastLevel()&&V.loadOutroVideo(),t?B.restartLevel():(N.showPanel(k.GAME,!0),window.setTimeout(()=>{this.openBox(!!n)},200))}openLevel(e,t,n){this._openLevel(e,t,n)}_closeLevel(){B.stopLevel()}_completeBox(){if(_.currentBoxIndex>=_.requiredCount()-1)H.hide(),V.playOutroVideo();else{this.manager.isInAdvanceBoxMode=!0;let e=o.disableBoxMenu?k.MENU:k.BOXES;N.showPanel(e,!1)}}_openLevelMenu(){B.pauseLevel(),O.pauseMusic(),ie(`#levelMenu`)}_closeLevelMenu(){j(`#levelMenu`),N.currentPanelId===k.GAME&&this.manager.gameEnabled&&B.isLevelActive()&&O.resumeMusic()}_showLevelBackground(){ie(`#levelBackground`)}_hideLevelBackground(){j(`#levelBackground`)}tapeBox(){let e=this.manager;e.isInMenuSelectMode&&(H.fadeOut(800,400),O.playMusic(nt)),S.closeBoxAnimation(()=>{e.isBoxOpen=!1,e.isInMenuSelectMode?N.showPanel(k.MENU,!1):(S.renderDoors(!0,0),N.showPanel(k.LEVELS,!0)),it()})}showGameUI(){this._hideLevelBackground(),D.showBoxBackgrounds&&o.enableBoxBackgroundEasterEgg&&ie(`#bg`),I(`#gameBtnTray`),it()}closeGameUI(){at(),S.renderDoors(!1,1),this._notifyBeginTransition(1e3),this._showLevelBackground(),D.showBoxBackgrounds&&o.enableBoxBackgroundEasterEgg&&j(`#bg`),A(`#gameBtnTray`)}openBox(e=!1){at();let t=N.currentPanelId===k.LEVELS?400:0;A(`#levelScore`),A(`#levelBack`),ae.setNavigationActive(!1),A(`#levelNavBack`),A(`#levelNavForward`),A(`#levelOptions`,t).then(()=>{this.manager.isBoxOpen?(A(`#levelResults`,800),e&&A(`#gameBtnTray`),window.setTimeout(()=>{B.startLevel(_.currentBoxIndex+1,_.currentLevelIndex),S.openDoors(!1,()=>{this.showGameUI()})},400)):S.openBoxAnimation(()=>{this.manager.isBoxOpen=!0,B.startLevel(_.currentBoxIndex+1,_.currentLevelIndex),S.openDoors(!0,()=>{this.showGameUI()})})})}closeBox(){at(),this.closeGameUI(),window.setTimeout(()=>{this.manager.isInLevelSelectMode||gt&&se(gt,750).then(()=>I(gt,250)),S.closeDoors(!1,()=>{this.manager.isInLevelSelectMode?this.tapeBox():window.setTimeout(()=>{this._runScoreTicker(),it()},250)})},250)}updateDevLink(){let e=this.manager;_e(window)<l.uiScaledNumber(1024)+120&&e._isDevLinkVisible?(A(`#moreLink`).then(()=>{e._isDevLinkVisible=!1}),A(`#zenbox_tab`)):_e(window)>l.uiScaledNumber(1024)+120&&!e._isDevLinkVisible&&(I(`#moreLink`).then(()=>{e._isDevLinkVisible=!0}),I(`#zenbox_tab`))}pauseGame(){N.currentPanelId===k.GAME&&B.isLevelActive()&&!this.manager.isTransitionActive?this._openLevelMenu():O.pauseMusic()}resumeGame(){!(_t&&_t.style.display!==`none`)&&N.currentPanelId!==k.GAMEMENU&&this.manager.gameEnabled&&O.resumeMusic()}domReady(){V.domReady(),ht.domReady(),N.domReady(),H.domReady(),et.domReady(),document.addEventListener(`visibilitychange`,()=>{document.hidden||document.visibilityState===`hidden`?this.pauseGame():this.resumeGame()}),window.addEventListener(`resize`,()=>{this.updateDevLink()})}appReady(){E.subscribe(E.ChannelId.LevelWon,(...e)=>{let[t]=e;t&&this.manager.results.onLevelWon(t)}),m.load(),S.appReady(),ht.appReady(),N.appReady(e=>{this.manager.panels.onInitializePanel(e)}),_.appReady(),T?it():et.stop(),E.publish(E.ChannelId.LanguageChanged),D.box!=null&&D.level!=null?this.noMenuStartLevel(D.box-1,D.level-1):w.showMenu&&N.showPanel(k.MENU,!0),E.subscribe(E.ChannelId.PauseGame,()=>{this.pauseGame()}),E.subscribe(E.ChannelId.EnableGame,()=>{this.manager.gameEnabled=!0,this.resumeGame()}),E.subscribe(E.ChannelId.DisableGame,()=>{this.manager.gameEnabled=!1,this.pauseGame()})}noMenuStartLevel(e,t){N.showPanel(k.GAME,!0),_.currentBoxIndex=e,_.currentLevelIndex=t+1,O.selectRandomGameMusic(),this.openBox()}openLevelMenu(e){this.manager.isBoxOpen=!1,S.renderDoors(!0,0),N.showPanel(k.LEVELS),H.setBoxBorder(e)}},yt=[{start:0,end:8},{start:9,end:17},{start:18,end:26}],bt=class{frameIndex;frameRange;texture;startX;startY;duration;endX;endY;x;y;startRotation;endRotation;rotation;scale;scaleGrowDuration;opacity;frameAnimationTimer;frameAnimationDelay;currentFrameOffset;age;constructor(e,t,n,r,i){this.frameIndex=n,this.frameRange=r,this.texture=i,this.startX=C.randomRange(-100,e),this.startY=C.randomRange(-40,100),this.duration=C.randomRange(2,5),this.endX=this.startX,this.endY=this.startY+C.randomRange(150,400),this.x=this.startX,this.y=this.startY,this.startRotation=C.randomRange(-360,360),this.endRotation=C.randomRange(-360,360),this.rotation=this.startRotation,this.scale=0,this.scaleGrowDuration=.3,this.opacity=1,this.frameAnimationTimer=0,this.frameAnimationDelay=.05,this.currentFrameOffset=C.randomRange(0,r.end-r.start),this.age=0}update(e){this.age+=e;let t=Math.min(this.age/this.duration,1);return this.x=this.startX+(this.endX-this.startX)*t,this.y=this.startY+(this.endY-this.startY)*t,this.rotation=this.startRotation+(this.endRotation-this.startRotation)*t,this.age<this.scaleGrowDuration?this.scale=this.age/this.scaleGrowDuration:this.scale=1,this.opacity=1-t,this.frameAnimationTimer+=e,this.frameAnimationTimer>=this.frameAnimationDelay&&(this.frameAnimationTimer-=this.frameAnimationDelay,this.currentFrameOffset=(this.currentFrameOffset+1)%(this.frameRange.end-this.frameRange.start+1)),this.frameIndex=this.frameRange.start+this.currentFrameOffset,this.age<this.duration}draw(e){let t=this.texture.rects[this.frameIndex];if(!t||!this.texture.image)return;e.save(),e.globalAlpha=this.opacity,e.translate(this.x,this.y),e.rotate(this.rotation*Math.PI/180);let n=t.w,r=t.h;e.drawImage(this.texture.image,t.x,t.y,n,r,-n/2,-r/2,n,r),e.restore()}},xt=class{canvas=null;ctx=null;particles=[];active=!1;animationFrame=null;lastTime=0;emissionTimer=0;emissionRate=200;duration=1;elapsed=0;totalParticles=50;initialBurst=15;texture=null;start(t){this.canvas=document.createElement(`canvas`),this.canvas.id=`confettiCanvas`,this.canvas.style.position=`absolute`,this.canvas.style.top=`0`,this.canvas.style.left=`0`,this.canvas.style.width=`100%`,this.canvas.style.height=`100%`,this.canvas.style.pointerEvents=`none`,this.canvas.style.zIndex=`9999`;let n=t.getBoundingClientRect();if(this.canvas.width=n.width,this.canvas.height=n.height,t.appendChild(this.canvas),this.ctx=this.canvas.getContext(`2d`),!this.ctx){console.error(`Confetti canvas failed to initialize rendering context`),this.stop();return}if(this.texture=h[e.IMG_CONFETTI_PARTICLES]?.texture??null,!this.texture||!this.texture.image){console.error(`Confetti texture not loaded`),this.stop();return}this.particles=[],this.active=!0,this.lastTime=performance.now(),this.elapsed=0,this.emissionTimer=0;for(let e=0;e<this.initialBurst;e++)this.createParticle();this.animate()}createParticle(){if(!this.canvas||!this.texture||this.particles.length>=this.totalParticles)return;let e=yt[C.randomRange(0,yt.length-1)];if(!e)return;let t=C.randomRange(e.start,e.end);this.particles.push(new bt(this.canvas.width,this.canvas.height,t,e,this.texture))}animate=()=>{if(!this.active)return;let e=performance.now(),t=(e-this.lastTime)/1e3;if(this.lastTime=e,this.elapsed+=t,this.emissionTimer+=t,this.elapsed<this.duration){let e=1/this.emissionRate;for(;this.emissionTimer>=e&&this.particles.length<this.totalParticles;)this.createParticle(),this.emissionTimer-=e}let n=this.ctx,r=this.canvas;if(!n||!r){this.stop();return}n.clearRect(0,0,r.width,r.height),this.particles=this.particles.filter(e=>{let r=e.update(t);return r&&e.draw(n),r}),this.particles.length>0||this.elapsed<this.duration?this.animationFrame=requestAnimationFrame(this.animate):this.stop()};stop(){this.active=!1,this.animationFrame!=null&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null),this.canvas&&this.canvas.parentElement&&this.canvas.parentElement.removeChild(this.canvas),this.canvas=null,this.ctx=null,this.particles=[]}},X=document.getElementById(`resultTickerValue`),Z=document.getElementById(`resultTickerLabel`),Q=document.getElementById(`resultScore`),$=document.getElementById(`resultImproved`),St=document.getElementById(`resultTickerMessage`),Ct=document.getElementById(`levelPanel`),wt=class{manager;constructor(e){this.manager=e}onLevelWon(e){let t=e.stars,n=e.score,r=e.time,i,a=0,o=t*1e3;switch(t){case 3:M(`#resultStar1`,`starEmpty`),F(`#resultStar1`,`star`),M(`#resultStar2`,`starEmpty`),F(`#resultStar2`,`star`),M(`#resultStar3`,`starEmpty`),F(`#resultStar3`,`star`),i=d.menuText(x.LEVEL_CLEARED4);break;case 2:M(`#resultStar1`,`starEmpty`),F(`#resultStar1`,`star`),M(`#resultStar2`,`starEmpty`),F(`#resultStar2`,`star`),M(`#resultStar3`,`star`),F(`#resultStar3`,`starEmpty`),i=d.menuText(x.LEVEL_CLEARED3);break;case 1:M(`#resultStar1`,`starEmpty`),F(`#resultStar1`,`star`),M(`#resultStar2`,`star`),F(`#resultStar2`,`starEmpty`),M(`#resultStar3`,`star`),F(`#resultStar3`,`starEmpty`),i=d.menuText(x.LEVEL_CLEARED2);break;default:M(`#resultStar1`,`star`),F(`#resultStar1`,`starEmpty`),M(`#resultStar2`,`star`),F(`#resultStar2`,`starEmpty`),M(`#resultStar3`,`star`),F(`#resultStar3`,`starEmpty`),i=d.menuText(x.LEVEL_CLEARED1);break}g.drawBig({text:i,imgSel:`#resultStatus canvas`,scaleToUI:!0,canvas:!0}),j(X),j(Z),Q&&(le(Q),j(Q)),j($),j(St);let s=e=>{let t=e/60|0,n=Math.round(e%60);return`${t}:${n<10?`0${n}`:n}`},c=(e,t)=>{let n=e,r=Date.now(),i=window.requestAnimationFrame,o=()=>{let s=Date.now(),c=s-r,l=Math.min(Math.round(e*c/1e3),n);r=s,n-=l,a+=l,n<=0?(n=0,a=e,A(Z,400),A(X,400).then(()=>{t?.()})):i&&i(o),X&&g.drawSmall({text:String(n),img:X,scaleToUI:!0,canvas:!0}),g.drawBigNumbers({text:String(a),imgParentId:`resultScore`,scaleToUI:!0,canvas:!0})};o()},l=(e,t,n)=>{let r=a+t,i=e,o=Math.max(1e3,2e3-e*50),c=Date.now(),l=window.requestAnimationFrame,u=()=>{let d=Date.now(),f=(d-c)/o;c=d,a+=Math.round(t*f),i-=e*f,i<=0?(i=0,a=r,A(Z,400),A(X,400).then(()=>{n?.()})):l&&l(u),X&&g.drawSmall({text:s(i),img:X,scaleToUI:!0,canvas:!0}),g.drawBigNumbers({text:String(a),imgParentId:`resultScore`,scaleToUI:!0,canvas:!0})};u()};Z&&g.drawSmall({text:d.menuText(x.STAR_BONUS),img:Z,scaleToUI:!0,canvas:!0}),X&&g.drawSmall({text:String(o),img:X,scaleToUI:!0,canvas:!0}),Q&&(Q.querySelectorAll(`img`).forEach(e=>{e.remove()}),Q.querySelectorAll(`canvas`).forEach(e=>{e.remove()}));let u=t===3?new xt:null,f=_.currentBoxIndex,p=_.currentLevelIndex,h=m.getScore(f,p-1);setTimeout(()=>{I(Z,300),I(X,300),I(Q,300).then(()=>{t===3&&u&&Ct&&u.start(Ct),c(o,()=>{Z&&g.drawSmall({text:d.menuText(x.TIME),img:Z,scaleToUI:!0,canvas:!0}),I(Z,300),X&&g.drawSmall({text:s(Math.ceil(r)),img:X,scaleToUI:!0,canvas:!0}),I(X,300).then(()=>{l(Math.ceil(r),n-a,()=>{I(St,300),h!=null&&h>0&&n>h&&(rt?ie($):$&&($.style.display=`block`,$.style.transform=`scale(2.5)`,$.style.opacity=`0`,$.style.transition=`none`,requestAnimationFrame(()=>{$.style.transition=`transform 600ms ease-in, opacity 600ms ease-in`,$.style.transform=`scale(1)`,$.style.opacity=`1`,setTimeout(()=>{$.style.transition=``},600)})))})})})})},1e3),m.setScore(f,p-1,n,!1),m.setStars(f,p-1,t,!1);let y=m.levelCount(f);y!=null&&y>p&&_.isNextLevelPlayable()&&m.setStars(f,p,0,!1),this.manager.isInLevelSelectMode=!1,this.manager.gameFlow.closeBox(),f===0&&p===1&&(e.fps!=null&&e.fps<this.manager._MIN_FPS&&!v.disableSlowWarning&&setTimeout(()=>{ze.showSlowComputerPopup()},3e3),V.removeIntroVideo())}},Tt=new class extends Se{useHDVersion;isInLevelSelectMode;isInMenuSelectMode;isInAdvanceBoxMode;isBoxOpen;isTransitionActive;gameEnabled;_MIN_FPS;_signedIn;_bounceTimeOut;_transitionTimeout;_resultTopLines;_resultBottomLines;_currentResultLine;_resultTimeShiftIndex;_isDevLinkVisible;_setImageBigText;gameFlow;results;panels;panelShow;constructor(){super(),this.useHDVersion=w.getIsHD()??!1,this.isInLevelSelectMode=!1,this.isInMenuSelectMode=!1,this.isInAdvanceBoxMode=!1,this.isBoxOpen=!1,this.isTransitionActive=!1,this.gameEnabled=!0,this._MIN_FPS=D.minFps??30,this._signedIn=!1,this._bounceTimeOut=null,this._transitionTimeout=null,this._resultTopLines=[],this._resultBottomLines=[],this._currentResultLine=0,this._resultTimeShiftIndex=0,this._isDevLinkVisible=!0,this._setImageBigText=Ce,this.gameFlow=new vt(this),this.results=new wt(this),this.panels=new st(this),this.panelShow=new lt(this),N.onShowPanel=e=>this.panelShow.onShowPanel(e),E.subscribe(E.ChannelId.SignIn,()=>{this._signedIn=!0,this._updateSignInControls()}),E.subscribe(E.ChannelId.SignOut,()=>{this._signedIn=!1,this._updateSignInControls()})}_updateSignInControls(){oe(`#achievementsBtn`,`disabled`,!this._signedIn),oe(`#leaderboardsBtn`,`disabled`,!this._signedIn)}},Et=(e,t,n)=>Math.min(n,Math.max(t,e)),Dt=new class{progressBar=null;betterLoader=null;gameFooterSocial=null;constructor(){xe.start(),E.publish(E.ChannelId.AppInit)}domReady(){if(this.progressBar=document.getElementById(`progress`),this.betterLoader=document.getElementById(`betterLoader`),this.gameFooterSocial=document.getElementById(`gameFooterSocial`),w.disableTextSelection&&document.body.addEventListener(`selectstart`,e=>{e.preventDefault()}),document.querySelectorAll(`.ctrCursor`).forEach(e=>{e instanceof HTMLElement&&(e.addEventListener(`mousedown`,()=>{e.classList.toggle(`ctrCursorActive`)}),e.addEventListener(`mouseup`,()=>{e.classList.toggle(`ctrCursorActive`)}))}),document.body.classList.add(`ui-${l.UI_WIDTH}`),T&&document.body.classList.add(`is-xmas`),r.domReady(`c`),!r.element)throw Error(`Canvas element not found`);r.element.width=l.CANVAS_WIDTH,r.element.height=l.CANVAS_HEIGHT,r.element.style.width=`${l.CANVAS_WIDTH}px`,r.element.style.height=`${l.CANVAS_HEIGHT}px`,typeof ee.domReady==`function`&&ee.domReady(),xe.domReady(),Tt.gameFlow.domReady(),E.publish(E.ChannelId.AppDomReady)}run(){let e=E.subscribe(E.ChannelId.PreloaderProgress,(...e)=>{let[t]=e;if(!t||typeof t!=`object`)return;let n=t.progress;if(this.progressBar&&typeof n==`number`){let e=Et(n,0,100);this.progressBar.style.transition=`width 0.3s ease-out`,this.progressBar.style.width=`${e}%`}});xe.run(()=>{E.unsubscribe(e),this.progressBar&&(this.progressBar.style.width=`100%`),window.setTimeout(()=>{this.betterLoader&&(this.betterLoader.style.transition=`opacity 0.5s`,this.betterLoader.style.opacity=`0`,window.setTimeout(()=>{this.betterLoader&&(this.betterLoader.style.display=`none`)},500))},200),Tt.gameFlow.appReady(),E.publish(E.ChannelId.AppRun),document.querySelectorAll(`.hideAfterLoad`).forEach(e=>{e instanceof HTMLElement&&(e.style.transition=`opacity 0.5s`,e.style.opacity=`0`,window.setTimeout(()=>{e.style.display=`none`},500))}),document.querySelectorAll(`.hideBeforeLoad`).forEach(e=>{e instanceof HTMLElement&&(e.style.display=e.style.display||`block`,e.style.opacity=`0`,e.style.transition=`opacity 0.5s`,e.offsetHeight,e.style.opacity=`1`)}),Tt.gameFlow.updateDevLink(),this.gameFooterSocial&&(this.gameFooterSocial.style.top=`0`)})}};export{Dt as t};