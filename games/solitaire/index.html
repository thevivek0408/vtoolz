<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Solitaire</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0b3d0b;color:#e0e0e0;font-family:'Segoe UI',Arial,sans-serif;min-height:100vh;padding:8px;user-select:none;overflow-x:hidden}
.top-bar{display:flex;justify-content:space-between;align-items:center;padding:4px 8px;margin-bottom:8px}
.top-bar h1{font-size:1.2rem;color:#fff;text-shadow:0 1px 3px #000}
.top-bar .info{font-size:.8rem;color:#cfc}
.top-bar button{background:#1a5a1a;border:1px solid #2a8a2a;color:#fff;padding:5px 12px;border-radius:6px;cursor:pointer;font-size:.8rem}
.top-bar button:hover{background:#2a8a2a}
.game{position:relative;max-width:700px;margin:0 auto}
.foundations{display:flex;gap:8px;position:absolute;top:0;right:0}
.stock-waste{display:flex;gap:8px;position:absolute;top:0;left:0}
.tableau{display:flex;gap:8px;margin-top:110px;justify-content:center}
.pile{position:relative;width:clamp(50px,12vw,85px);min-height:clamp(70px,17vw,120px)}
.card{position:absolute;width:clamp(50px,12vw,85px);height:clamp(70px,17vw,120px);border-radius:6px;cursor:pointer;font-size:clamp(11px,2.5vw,16px);font-weight:700;transition:box-shadow .15s;box-shadow:0 1px 3px rgba(0,0,0,.4)}
.card:hover{box-shadow:0 2px 8px rgba(0,0,0,.6)}
.card.face-up{background:#fff;border:1px solid #ccc}
.card.face-down{background:linear-gradient(135deg,#1a3a8a,#0d2060);border:1px solid #1a3a8a;background-image:repeating-linear-gradient(45deg,transparent,transparent 5px,#1a4a9a22 5px,#1a4a9a22 10px)}
.card.red{color:#d32f2f}
.card.black{color:#222}
.card .rank{position:absolute;top:4px;left:6px;line-height:1}
.card .suit{position:absolute;top:clamp(16px,4vw,24px);left:6px;font-size:clamp(10px,2vw,14px)}
.card .center-suit{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:clamp(20px,5vw,36px);opacity:.5}
.card .rank-btm{position:absolute;bottom:4px;right:6px;line-height:1;transform:rotate(180deg)}
.card.selected{box-shadow:0 0 0 3px #ffd93d,0 4px 12px rgba(0,0,0,.5)}
.placeholder{position:absolute;width:clamp(50px,12vw,85px);height:clamp(70px,17vw,120px);border:2px dashed #2a6a2a;border-radius:6px;top:0;left:0}
.stock .card{position:absolute;top:0;left:0}
.waste .card{position:absolute;top:0}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center;z-index:100}
.modal.show{display:flex}
.modal-content{background:#0b3d0b;border:2px solid #2a8a2a;border-radius:16px;padding:28px;text-align:center}
.modal-content h2{color:#ffd93d;margin-bottom:8px}
.modal-content p{color:#cfc;margin-bottom:16px}
.modal-content button{background:#2a8a2a;color:#fff;border:none;padding:10px 24px;border-radius:8px;cursor:pointer;font-size:1rem}
</style>
</head>
<body>
<div class="top-bar">
  <h1>â™  Solitaire</h1>
  <div class="info">
    <span>Moves: <b id="moves">0</b></span> &nbsp;
    <span>Time: <b id="timer">00:00</b></span>
  </div>
  <div>
    <button onclick="undoMove()">Undo</button>
    <button onclick="newGame()">New</button>
  </div>
</div>
<div class="game" id="game"></div>
<div class="modal" id="modal">
  <div class="modal-content">
    <h2>ðŸŽ‰ You Win!</h2>
    <p id="modal-msg"></p>
    <button onclick="document.getElementById('modal').classList.remove('show');newGame()">Play Again</button>
  </div>
</div>
<script>
const SUITS=['â™ ','â™¥','â™¦','â™£'],RANKS=['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
const RED=['â™¥','â™¦'];
let stock=[],waste=[],foundations=[[],[],[],[]],tableau=[[],[],[],[],[],[],[]];
let selected=null,moveCount=0,seconds=0,timerInterval,history=[];
const CW=Math.min(Math.floor(window.innerWidth*.12),85);
const CH=Math.floor(CW*1.4);
const OVERLAP=Math.floor(CW*.28);

function createDeck(){
  let deck=[];
  SUITS.forEach(s=>RANKS.forEach((r,i)=>deck.push({suit:s,rank:r,value:i+1,faceUp:false,red:RED.includes(s)})));
  for(let i=deck.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[deck[i],deck[j]]=[deck[j],deck[i]]}
  return deck;
}

function newGame(){
  let deck=createDeck();
  stock=[];waste=[];foundations=[[],[],[],[]];tableau=[[],[],[],[],[],[],[]];
  selected=null;moveCount=0;seconds=0;history=[];
  document.getElementById('moves').textContent='0';
  clearInterval(timerInterval);
  timerInterval=setInterval(()=>{seconds++;let m=String(Math.floor(seconds/60)).padStart(2,'0'),s=String(seconds%60).padStart(2,'0');document.getElementById('timer').textContent=m+':'+s},1000);
  for(let c=0;c<7;c++){
    for(let r=0;r<=c;r++){
      let card=deck.pop();
      card.faceUp=r===c;
      tableau[c].push(card);
    }
  }
  stock=deck.reverse();
  render();
}

function render(){
  const game=document.getElementById('game');game.innerHTML='';
  const gap=CW+8;
  // Stock
  let stockDiv=document.createElement('div');stockDiv.className='stock-waste';
  let stockPile=document.createElement('div');stockPile.className='pile stock';stockPile.style.width=CW+'px';stockPile.style.minHeight=CH+'px';
  let ph=document.createElement('div');ph.className='placeholder';ph.style.width=CW+'px';ph.style.height=CH+'px';stockPile.appendChild(ph);
  if(stock.length){
    let c=makeCard(stock[stock.length-1],false);c.style.top='0';c.style.left='0';
    c.addEventListener('click',drawFromStock);
    stockPile.appendChild(c);
  } else {
    ph.style.cursor='pointer';
    ph.addEventListener('click',recycleWaste);
    ph.innerHTML='<span style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:24px;color:#2a6a2a">â†º</span>';
  }
  stockDiv.appendChild(stockPile);
  // Waste
  let wastePile=document.createElement('div');wastePile.className='pile waste';wastePile.style.width=CW+'px';wastePile.style.minHeight=CH+'px';
  let wp=document.createElement('div');wp.className='placeholder';wp.style.width=CW+'px';wp.style.height=CH+'px';wastePile.appendChild(wp);
  waste.slice(-3).forEach((card,i,arr)=>{
    let c=makeCard(card,true);
    c.style.top='0';c.style.left=(i*15)+'px';
    if(i===arr.length-1){
      c.addEventListener('click',()=>selectCard('waste',0,waste.length-1));
      if(selected&&selected.source==='waste')c.classList.add('selected');
    }
    wastePile.appendChild(c);
  });
  stockDiv.appendChild(wastePile);
  game.appendChild(stockDiv);
  // Foundations
  let fDiv=document.createElement('div');fDiv.className='foundations';fDiv.style.right='0';
  foundations.forEach((f,fi)=>{
    let pile=document.createElement('div');pile.className='pile';pile.style.width=CW+'px';pile.style.minHeight=CH+'px';
    let ph2=document.createElement('div');ph2.className='placeholder';ph2.style.width=CW+'px';ph2.style.height=CH+'px';
    ph2.innerHTML=`<span style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:20px;color:#2a6a2aaa">${SUITS[fi]}</span>`;
    ph2.addEventListener('click',()=>placeOnFoundation(fi));
    pile.appendChild(ph2);
    if(f.length){
      let c=makeCard(f[f.length-1],true);c.style.top='0';c.style.left='0';
      c.addEventListener('click',()=>placeOnFoundation(fi));
      pile.appendChild(c);
    }
    fDiv.appendChild(pile);
  });
  game.appendChild(fDiv);
  // Tableau
  let tDiv=document.createElement('div');tDiv.className='tableau';
  tableau.forEach((col,ci)=>{
    let pile=document.createElement('div');pile.className='pile';pile.style.width=CW+'px';
    pile.style.minHeight=(CH+OVERLAP*12)+'px';
    let ph3=document.createElement('div');ph3.className='placeholder';ph3.style.width=CW+'px';ph3.style.height=CH+'px';
    ph3.addEventListener('click',()=>placeOnTableau(ci));
    pile.appendChild(ph3);
    col.forEach((card,ri)=>{
      let c=makeCard(card,card.faceUp);
      c.style.top=(ri*OVERLAP)+'px';c.style.left='0';
      if(card.faceUp){
        c.addEventListener('click',()=>selectCard('tableau',ci,ri));
        if(selected&&selected.source==='tableau'&&selected.col===ci&&selected.row===ri)c.classList.add('selected');
      }
      pile.appendChild(c);
    });
    tDiv.appendChild(pile);
  });
  game.appendChild(tDiv);
  // Check win
  if(foundations.every(f=>f.length===13)){
    clearInterval(timerInterval);
    let m=Math.floor(seconds/60),s=seconds%60;
    document.getElementById('modal-msg').textContent=`Completed in ${moveCount} moves and ${m}m ${s}s!`;
    document.getElementById('modal').classList.add('show');
  }
}

function makeCard(card,faceUp){
  let d=document.createElement('div');
  d.className='card '+(faceUp?'face-up':'face-down')+(card.red?' red':' black');
  if(faceUp){
    d.innerHTML=`<div class="rank">${card.rank}</div><div class="suit">${card.suit}</div><div class="center-suit">${card.suit}</div><div class="rank-btm">${card.rank}</div>`;
  }
  return d;
}

function drawFromStock(){
  if(!stock.length)return;
  history.push({type:'draw',card:null,waste:[...waste.map(c=>({...c}))],stock:stock.length});
  let card=stock.pop();card.faceUp=true;waste.push(card);
  moveCount++;document.getElementById('moves').textContent=moveCount;
  selected=null;render();
}
function recycleWaste(){
  if(waste.length===0)return;
  history.push({type:'recycle',waste:waste.map(c=>({...c})),stockLen:stock.length});
  stock=waste.reverse().map(c=>{c.faceUp=false;return c});waste=[];
  selected=null;render();
}

function selectCard(source,col,row){
  if(selected){
    // If tapping the same card, try auto-move to foundation or another tableau pile
    if(selected.source===source&&selected.col===col&&selected.row===row){
      if(tryAutoMove(source,col,row))return;
      selected=null;render();return;
    }
    // Try to place
    if(source==='tableau'){
      if(placeOnTableau(col))return;
    }
    // Try foundation auto
  }
  selected={source,col,row};render();
}

function tryAutoMove(source,col,row){
  let card;
  if(source==='waste')card=waste[waste.length-1];
  else if(source==='tableau'){
    let c2=tableau[col];
    if(row!==c2.length-1)return false;
    card=c2[c2.length-1];
  }
  if(!card)return false;
  // Try foundations first
  for(let fi=0;fi<4;fi++){
    let f=foundations[fi];
    if(f.length===0&&card.value===1&&card.suit===SUITS[fi]){placeOnFoundation(fi);return true}
    if(f.length&&card.suit===f[f.length-1].suit&&card.value===f[f.length-1].value+1){placeOnFoundation(fi);return true}
  }
  // Try tableau
  for(let ci=0;ci<7;ci++){
    if(source==='tableau'&&ci===col)continue;
    let target=tableau[ci];
    if(target.length===0&&card.value===13){if(placeOnTableau(ci))return true}
    else if(target.length){
      let top=target[target.length-1];
      if(top.faceUp&&top.red!==card.red&&top.value===card.value+1){if(placeOnTableau(ci))return true}
    }
  }
  return false;
}

function placeOnTableau(ci){
  if(!selected)return false;
  let cards;
  if(selected.source==='waste'){
    cards=[waste[waste.length-1]];
  } else if(selected.source==='tableau'){
    cards=tableau[selected.col].slice(selected.row);
  } else return false;
  if(!cards.length)return false;
  let first=cards[0];
  let target=tableau[ci];
  let canPlace=false;
  if(target.length===0){canPlace=first.value===13} // Only K on empty
  else{
    let top=target[target.length-1];
    canPlace=top.faceUp&&top.red!==first.red&&top.value===first.value+1;
  }
  if(!canPlace){selected=null;render();return false}
  // Save history
  let hist={type:'move',source:selected.source,fromCol:selected.col,fromRow:selected.row,toCol:ci,cards:cards.length,flipped:false};
  if(selected.source==='waste'){
    waste.pop();
    hist.wasWaste=true;
  } else {
    tableau[selected.col].splice(selected.row);
    if(tableau[selected.col].length&&!tableau[selected.col][tableau[selected.col].length-1].faceUp){
      tableau[selected.col][tableau[selected.col].length-1].faceUp=true;hist.flipped=true;
    }
  }
  cards.forEach(c=>tableau[ci].push(c));
  history.push(hist);
  moveCount++;document.getElementById('moves').textContent=moveCount;
  selected=null;render();return true;
}

function placeOnFoundation(fi){
  let card,source;
  if(selected){
    if(selected.source==='waste'){card=waste[waste.length-1];source='waste'}
    else if(selected.source==='tableau'){
      let col=tableau[selected.col];
      if(selected.row!==col.length-1){selected=null;render();return}
      card=col[col.length-1];source='tableau';
    }
  } else {
    // Try auto from waste
    return;
  }
  if(!card)return;
  let f=foundations[fi];
  let canPlace=false;
  if(f.length===0)canPlace=card.value===1&&card.suit===SUITS[fi];
  else canPlace=card.suit===f[f.length-1].suit&&card.value===f[f.length-1].value+1;
  if(!canPlace){selected=null;render();return}
  let hist={type:'foundation',source,fromCol:selected.col,fromRow:selected.row,fi,flipped:false};
  if(source==='waste'){waste.pop();hist.wasWaste=true}
  else{
    tableau[selected.col].pop();
    if(tableau[selected.col].length&&!tableau[selected.col][tableau[selected.col].length-1].faceUp){
      tableau[selected.col][tableau[selected.col].length-1].faceUp=true;hist.flipped=true;
    }
  }
  foundations[fi].push(card);
  history.push(hist);
  moveCount++;document.getElementById('moves').textContent=moveCount;
  selected=null;render();
}

function undoMove(){
  if(!history.length)return;
  let h=history.pop();
  if(h.type==='draw'){
    if(waste.length){
      let card=waste.pop();
      card.faceUp=false;
      stock.push(card);
    }
  } else if(h.type==='recycle'){
    waste=h.waste.map(c=>{c.faceUp=true;return c});
    stock=[];
  } else if(h.type==='move'){
    if(h.flipped&&tableau[h.fromCol].length)tableau[h.fromCol][tableau[h.fromCol].length-1].faceUp=false;
    let moved=tableau[h.toCol].splice(-h.cards);
    if(h.wasWaste){waste.push(moved[0]);moved[0].faceUp=true}
    else{moved.forEach(c=>tableau[h.fromCol].push(c))}
  } else if(h.type==='foundation'){
    let card=foundations[h.fi].pop();
    if(h.flipped&&tableau[h.fromCol].length)tableau[h.fromCol][tableau[h.fromCol].length-1].faceUp=false;
    if(h.wasWaste){waste.push(card);card.faceUp=true}
    else{tableau[h.fromCol].push(card)}
  }
  selected=null;moveCount=Math.max(0,moveCount-1);
  document.getElementById('moves').textContent=moveCount;
  render();
}

// Double-click to auto-place on foundation
document.addEventListener('dblclick',e=>{
  if(!selected)return;
  let card;
  if(selected.source==='waste')card=waste[waste.length-1];
  else if(selected.source==='tableau'){
    let col=tableau[selected.col];
    if(selected.row!==col.length-1)return;
    card=col[col.length-1];
  }
  if(!card)return;
  for(let fi=0;fi<4;fi++){
    let f=foundations[fi];
    if(f.length===0&&card.value===1&&card.suit===SUITS[fi]){placeOnFoundation(fi);return}
    if(f.length&&card.suit===f[f.length-1].suit&&card.value===f[f.length-1].value+1){placeOnFoundation(fi);return}
  }
});

newGame();
</script>
</body>
</html>
