<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Asteroids</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#000;color:#e0e0e0;font-family:'Courier New',monospace;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:4px;user-select:none;overflow:hidden}
canvas{display:block;touch-action:none}
.hud{position:fixed;top:8px;left:50%;transform:translateX(-50%);display:flex;gap:16px;font-size:.8rem;color:#0ff;z-index:5}
.touch-controls{position:fixed;bottom:10px;left:0;right:0;display:flex;justify-content:space-between;padding:0 12px;z-index:5}
.touch-btn{width:56px;height:56px;border-radius:50%;background:rgba(0,255,255,.12);border:1px solid rgba(0,255,255,.25);color:#0ff;font-size:20px;display:flex;align-items:center;justify-content:center;cursor:pointer;-webkit-tap-highlight-color:transparent}
.touch-group{display:flex;gap:8px}
@media(hover:hover){.touch-controls{display:none}}
</style>
</head>
<body>
<div class="hud">
  <span>SCORE: <b id="score">0</b></span>
  <span>LIVES: <b id="lives">3</b></span>
  <span>BEST: <b id="best">0</b></span>
</div>
<canvas id="c"></canvas>
<div class="touch-controls">
  <div class="touch-group">
    <div class="touch-btn" id="t-left">â—€</div>
    <div class="touch-btn" id="t-right">â–¶</div>
  </div>
  <div class="touch-group">
    <div class="touch-btn" id="t-thrust">â–²</div>
    <div class="touch-btn" id="t-fire">ðŸ”¥</div>
  </div>
</div>
<script>
const canvas=document.getElementById('c'),ctx=canvas.getContext('2d');
let W,H;
function resize(){W=canvas.width=window.innerWidth;H=canvas.height=window.innerHeight}
resize();window.addEventListener('resize',resize);

let ship,asteroids,bullets,particles,score,lives,level,gameOver,invincible,invTimer;
let keys={},best=+localStorage.getItem('asteroids_best')||0;
document.getElementById('best').textContent=best;

function init(){
  ship={x:W/2,y:H/2,angle:0,dx:0,dy:0,r:14,thrust:false,flames:[]};
  asteroids=[];bullets=[];particles=[];score=0;lives=3;level=1;gameOver=false;invincible=60;invTimer=0;
  document.getElementById('score').textContent=0;
  document.getElementById('lives').textContent=3;
  spawnAsteroids(4);loop();
}

function spawnAsteroids(n){
  for(let i=0;i<n;i++){
    let x,y;
    do{x=Math.random()*W;y=Math.random()*H}while(Math.hypot(x-ship.x,y-ship.y)<150);
    let angle=Math.random()*Math.PI*2;
    let speed=0.5+Math.random()*1.5;
    asteroids.push({x,y,dx:Math.cos(angle)*speed,dy:Math.sin(angle)*speed,r:35+Math.random()*15,verts:genVerts(8)});
  }
}

function genVerts(n){
  let v=[];for(let i=0;i<n;i++){v.push(0.7+Math.random()*0.5)}return v;
}

function loop(){
  if(gameOver)return;
  update();draw();requestAnimationFrame(loop);
}

function update(){
  // Ship controls
  if(keys.left)ship.angle-=0.06;
  if(keys.right)ship.angle+=0.06;
  if(keys.up){
    ship.dx+=Math.cos(ship.angle)*0.12;
    ship.dy+=Math.sin(ship.angle)*0.12;
    ship.thrust=true;
    if(Math.random()>.5)ship.flames.push({x:ship.x-Math.cos(ship.angle)*18,y:ship.y-Math.sin(ship.angle)*18,life:6});
  } else ship.thrust=false;
  // Friction
  ship.dx*=0.995;ship.dy*=0.995;
  let maxV=8;
  let spd=Math.hypot(ship.dx,ship.dy);
  if(spd>maxV){ship.dx*=maxV/spd;ship.dy*=maxV/spd}
  ship.x+=ship.dx;ship.y+=ship.dy;
  // Wrap
  if(ship.x<-20)ship.x=W+20;if(ship.x>W+20)ship.x=-20;
  if(ship.y<-20)ship.y=H+20;if(ship.y>H+20)ship.y=-20;
  ship.flames.forEach(f=>f.life--);ship.flames=ship.flames.filter(f=>f.life>0);
  if(invincible>0)invincible--;
  // Bullets
  bullets.forEach(b=>{b.x+=b.dx;b.y+=b.dy;b.life--});
  bullets=bullets.filter(b=>b.life>0&&b.x>-10&&b.x<W+10&&b.y>-10&&b.y<H+10);
  // Asteroids
  asteroids.forEach(a=>{
    a.x+=a.dx;a.y+=a.dy;
    if(a.x<-50)a.x=W+50;if(a.x>W+50)a.x=-50;
    if(a.y<-50)a.y=H+50;if(a.y>H+50)a.y=-50;
  });
  // Bullet-asteroid collision
  bullets.forEach(b=>{
    asteroids.forEach(a=>{
      if(a.dead)return;
      if(Math.hypot(b.x-a.x,b.y-a.y)<a.r){
        b.life=0;a.dead=true;
        score+=a.r<20?100:a.r<30?50:20;
        document.getElementById('score').textContent=score;
        for(let i=0;i<6;i++)particles.push({x:a.x,y:a.y,dx:(Math.random()-.5)*4,dy:(Math.random()-.5)*4,life:15});
        if(a.r>18){
          for(let i=0;i<2;i++){
            let ang=Math.random()*Math.PI*2,sp=1+Math.random()*2;
            asteroids.push({x:a.x,y:a.y,dx:Math.cos(ang)*sp,dy:Math.sin(ang)*sp,r:a.r*0.5,verts:genVerts(7)});
          }
        }
      }
    });
  });
  asteroids=asteroids.filter(a=>!a.dead);
  // Ship-asteroid collision
  if(invincible<=0){
    for(let a of asteroids){
      if(Math.hypot(ship.x-a.x,ship.y-a.y)<a.r+ship.r){
        lives--;document.getElementById('lives').textContent=lives;
        for(let i=0;i<15;i++)particles.push({x:ship.x,y:ship.y,dx:(Math.random()-.5)*6,dy:(Math.random()-.5)*6,life:20});
        ship.x=W/2;ship.y=H/2;ship.dx=0;ship.dy=0;invincible=90;
        if(lives<=0){endGame()}
        break;
      }
    }
  }
  // Particles
  particles.forEach(p=>{p.x+=p.dx;p.y+=p.dy;p.life--});
  particles=particles.filter(p=>p.life>0);
  // Next level
  if(asteroids.length===0){level++;spawnAsteroids(3+level)}
}

function endGame(){
  gameOver=true;
  if(score>best){best=score;localStorage.setItem('asteroids_best',best)}
  document.getElementById('best').textContent=best;
  drawGameOver();
}

function draw(){
  ctx.fillStyle='#000';ctx.fillRect(0,0,W,H);
  // Ship
  if(invincible>0&&invincible%6<3){}else{
    ctx.save();ctx.translate(ship.x,ship.y);ctx.rotate(ship.angle);
    ctx.strokeStyle='#0ff';ctx.lineWidth=1.5;ctx.shadowColor='#0ff';ctx.shadowBlur=6;
    ctx.beginPath();
    ctx.moveTo(18,0);ctx.lineTo(-12,-10);ctx.lineTo(-6,0);ctx.lineTo(-12,10);ctx.closePath();
    ctx.stroke();ctx.shadowBlur=0;
    // Thrust flame
    if(ship.thrust){
      ctx.fillStyle='#f80';ctx.beginPath();
      ctx.moveTo(-8,-5);ctx.lineTo(-20-Math.random()*8,0);ctx.lineTo(-8,5);ctx.fill();
    }
    ctx.restore();
  }
  // Flames
  ship.flames.forEach(f=>{
    ctx.globalAlpha=f.life/6;ctx.fillStyle='#f80';
    ctx.beginPath();ctx.arc(f.x,f.y,3,0,Math.PI*2);ctx.fill();
  });
  ctx.globalAlpha=1;
  // Asteroids
  asteroids.forEach(a=>{
    ctx.strokeStyle='#888';ctx.lineWidth=1.5;
    ctx.beginPath();
    for(let i=0;i<a.verts.length;i++){
      let ang=i/a.verts.length*Math.PI*2;
      let r=a.r*a.verts[i];
      let x=a.x+Math.cos(ang)*r,y=a.y+Math.sin(ang)*r;
      i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
    }
    ctx.closePath();ctx.stroke();
  });
  // Bullets
  ctx.fillStyle='#0ff';ctx.shadowColor='#0ff';ctx.shadowBlur=6;
  bullets.forEach(b=>{ctx.beginPath();ctx.arc(b.x,b.y,2.5,0,Math.PI*2);ctx.fill()});
  ctx.shadowBlur=0;
  // Particles
  particles.forEach(p=>{
    ctx.globalAlpha=p.life/20;ctx.fillStyle='#fff';
    ctx.fillRect(p.x-1.5,p.y-1.5,3,3);
  });
  ctx.globalAlpha=1;
}

function drawGameOver(){
  draw();
  ctx.fillStyle='rgba(0,0,0,.65)';ctx.fillRect(0,0,W,H);
  ctx.fillStyle='#0ff';ctx.font='bold 30px Courier New';ctx.textAlign='center';
  ctx.fillText('GAME OVER',W/2,H/2-15);
  ctx.fillStyle='#888';ctx.font='16px Courier New';
  ctx.fillText('Score: '+score,W/2,H/2+18);
  ctx.fillText('Click/tap to restart',W/2,H/2+48);
}

function fire(){
  if(gameOver)return;
  bullets.push({x:ship.x+Math.cos(ship.angle)*18,y:ship.y+Math.sin(ship.angle)*18,dx:Math.cos(ship.angle)*8+ship.dx*.3,dy:Math.sin(ship.angle)*8+ship.dy*.3,life:55});
}

document.addEventListener('keydown',e=>{
  if(e.key==='ArrowLeft'||e.key==='a')keys.left=true;
  if(e.key==='ArrowRight'||e.key==='d')keys.right=true;
  if(e.key==='ArrowUp'||e.key==='w')keys.up=true;
  if(e.key===' '){e.preventDefault();fire()}
});
document.addEventListener('keyup',e=>{
  if(e.key==='ArrowLeft'||e.key==='a')keys.left=false;
  if(e.key==='ArrowRight'||e.key==='d')keys.right=false;
  if(e.key==='ArrowUp'||e.key==='w')keys.up=false;
});

// Touch
function tb(id,key){
  const el=document.getElementById(id);
  el.addEventListener('touchstart',e=>{e.preventDefault();keys[key]=true},{passive:false});
  el.addEventListener('touchend',e=>{e.preventDefault();keys[key]=false},{passive:false});
}
tb('t-left','left');tb('t-right','right');tb('t-thrust','up');
document.getElementById('t-fire').addEventListener('touchstart',e=>{e.preventDefault();fire()},{passive:false});

canvas.addEventListener('click',()=>{if(gameOver)init()});
canvas.addEventListener('touchend',e=>{if(gameOver){e.preventDefault();init()}},{passive:false});

init();
</script>
</body>
</html>
