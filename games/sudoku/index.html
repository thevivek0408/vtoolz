<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Sudoku</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0f0f1a;color:#e0e0e0;font-family:'Segoe UI',Arial,sans-serif;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:12px;user-select:none}
h1{font-size:1.6rem;margin-bottom:8px;background:linear-gradient(135deg,#6c5ce7,#a29bfe);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}
.controls{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap;justify-content:center}
.controls button{background:#1e1e3a;border:1px solid #333;color:#e0e0e0;padding:8px 16px;border-radius:8px;cursor:pointer;font-size:.85rem;transition:all .2s}
.controls button:hover,.controls button.active{background:#6c5ce7;border-color:#6c5ce7;color:#fff}
.board{display:grid;grid-template-columns:repeat(9,1fr);gap:1px;background:#333;border:2px solid #6c5ce7;border-radius:8px;overflow:hidden;max-width:min(90vw,420px);max-height:min(90vw,420px);width:420px;height:420px}
.cell{background:#1a1a2e;display:flex;align-items:center;justify-content:center;font-size:clamp(14px,4vw,22px);font-weight:700;cursor:pointer;aspect-ratio:1;transition:background .15s}
.cell:hover{background:#2a2a4e}
.cell.selected{background:#3a2a6e;box-shadow:inset 0 0 0 2px #6c5ce7}
.cell.given{color:#8888cc}
.cell.user{color:#a29bfe}
.cell.error{color:#ff4757;background:#3a1a2e}
.cell.highlight{background:#252545}
.cell.same-num{background:#2a2a5e}
.cell[data-col="2"],.cell[data-col="5"]{border-right:2px solid #6c5ce7}
.cell[data-row="2"],.cell[data-row="5"]{border-bottom:2px solid #6c5ce7}
.numpad{display:grid;grid-template-columns:repeat(5,1fr);gap:6px;margin-top:12px;max-width:300px;width:100%}
.numpad button{background:#1e1e3a;border:1px solid #444;color:#a29bfe;font-size:1.2rem;font-weight:700;padding:12px;border-radius:8px;cursor:pointer;transition:all .15s}
.numpad button:hover{background:#6c5ce7;color:#fff}
.numpad button.erase{color:#ff6b81;font-size:.9rem}
.info{display:flex;gap:20px;margin-bottom:8px;font-size:.85rem;color:#888}
.timer{color:#a29bfe}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center;z-index:10}
.modal.show{display:flex}
.modal-content{background:#1a1a2e;border:1px solid #6c5ce7;border-radius:16px;padding:32px;text-align:center}
.modal-content h2{color:#a29bfe;margin-bottom:12px}
.modal-content button{background:#6c5ce7;color:#fff;border:none;padding:10px 24px;border-radius:8px;cursor:pointer;font-size:1rem;margin-top:12px}
.pencil-marks{display:grid;grid-template-columns:repeat(3,1fr);gap:0;width:100%;height:100%;font-size:clamp(7px,1.8vw,10px);color:#667;font-weight:400}
.pencil-marks span{display:flex;align-items:center;justify-content:center}
</style>
</head>
<body>
<h1>Sudoku</h1>
<div class="info">
  <span id="diff">Medium</span>
  <span id="mistakes">Mistakes: 0/3</span>
  <span class="timer" id="timer">00:00</span>
</div>
<div class="controls">
  <button onclick="newGame('easy')" id="btn-easy">Easy</button>
  <button onclick="newGame('medium')" id="btn-medium" class="active">Medium</button>
  <button onclick="newGame('hard')" id="btn-hard">Hard</button>
  <button onclick="togglePencil()" id="btn-pencil">Pencil</button>
  <button onclick="giveHint()">Hint</button>
  <button onclick="undoMove()">Undo</button>
</div>
<div class="board" id="board"></div>
<div class="numpad" id="numpad"></div>
<div class="modal" id="modal">
  <div class="modal-content">
    <h2 id="modal-title">Congratulations!</h2>
    <p id="modal-msg"></p>
    <button onclick="closeModal();newGame(currentDifficulty)">New Game</button>
  </div>
</div>
<script>
const board=document.getElementById('board'),numpadEl=document.getElementById('numpad');
let grid=[],solution=[],given=[],pencilMarks=[],selected=null,mistakes=0,pencilMode=false,currentDifficulty='medium',timerInterval,seconds=0,history=[];
const CLUES={easy:45,medium:35,hard:27};

function generateSudoku(){
  let b=Array.from({length:9},()=>Array(9).fill(0));
  fillBoard(b);
  return b;
}
function fillBoard(b){
  let empty=findEmpty(b);
  if(!empty)return true;
  let[r,c]=empty,nums=shuffle([1,2,3,4,5,6,7,8,9]);
  for(let n of nums){if(isValid(b,r,c,n)){b[r][c]=n;if(fillBoard(b))return true;b[r][c]=0}}
  return false;
}
function findEmpty(b){for(let r=0;r<9;r++)for(let c=0;c<9;c++)if(b[r][c]===0)return[r,c];return null}
function isValid(b,r,c,n){
  for(let i=0;i<9;i++){if(b[r][i]===n||b[i][c]===n)return false}
  let br=Math.floor(r/3)*3,bc=Math.floor(c/3)*3;
  for(let i=br;i<br+3;i++)for(let j=bc;j<bc+3;j++)if(b[i][j]===n)return false;
  return true;
}
function shuffle(a){for(let i=a.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}

function newGame(diff){
  currentDifficulty=diff;
  document.querySelectorAll('.controls button').forEach(b=>{b.classList.remove('active');if(b.id==='btn-'+diff)b.classList.add('active')});
  document.getElementById('diff').textContent=diff.charAt(0).toUpperCase()+diff.slice(1);
  solution=generateSudoku();
  grid=solution.map(r=>[...r]);
  given=Array.from({length:9},()=>Array(9).fill(false));
  pencilMarks=Array.from({length:9},()=>Array.from({length:9},()=>new Set()));
  let cells=shuffle([...Array(81).keys()]);
  let toRemove=81-CLUES[diff];
  for(let i=0;i<toRemove;i++){let r=Math.floor(cells[i]/9),c=cells[i]%9;grid[r][c]=0}
  for(let r=0;r<9;r++)for(let c=0;c<9;c++)given[r][c]=grid[r][c]!==0;
  mistakes=0;selected=null;history=[];seconds=0;
  document.getElementById('mistakes').textContent='Mistakes: 0/3';
  clearInterval(timerInterval);
  timerInterval=setInterval(()=>{seconds++;
    let m=String(Math.floor(seconds/60)).padStart(2,'0'),s=String(seconds%60).padStart(2,'0');
    document.getElementById('timer').textContent=m+':'+s},1000);
  render();
}
function render(){
  board.innerHTML='';
  for(let r=0;r<9;r++)for(let c=0;c<9;c++){
    let cell=document.createElement('div');
    cell.className='cell';
    cell.dataset.row=r;cell.dataset.col=c;
    if(given[r][c]){cell.classList.add('given');cell.textContent=grid[r][c]}
    else if(grid[r][c]){
      cell.classList.add('user');cell.textContent=grid[r][c];
      if(grid[r][c]!==solution[r][c])cell.classList.add('error');
    } else if(pencilMarks[r][c].size>0){
      let pm=document.createElement('div');pm.className='pencil-marks';
      for(let n=1;n<=9;n++){let s=document.createElement('span');s.textContent=pencilMarks[r][c].has(n)?n:'';pm.appendChild(s)}
      cell.appendChild(pm);
    }
    if(selected&&r===selected[0]&&c===selected[1])cell.classList.add('selected');
    if(selected){
      let[sr,sc]=selected;
      if(r===sr||c===sc||Math.floor(r/3)===Math.floor(sr/3)&&Math.floor(c/3)===Math.floor(sc/3))cell.classList.add('highlight');
      if(grid[sr][sc]&&grid[r][c]===grid[sr][sc]&&(r!==sr||c!==sc))cell.classList.add('same-num');
    }
    cell.addEventListener('click',()=>selectCell(r,c));
    board.appendChild(cell);
  }
}
function selectCell(r,c){selected=[r,c];render()}
function placeNumber(n){
  if(!selected)return;
  let[r,c]=selected;
  if(given[r][c])return;
  history.push({r,c,prev:grid[r][c],pencil:new Set(pencilMarks[r][c])});
  if(pencilMode){
    if(n===0)pencilMarks[r][c].clear();
    else pencilMarks[r][c].has(n)?pencilMarks[r][c].delete(n):pencilMarks[r][c].add(n);
    grid[r][c]=0;
  } else {
    pencilMarks[r][c].clear();
    if(n===0){grid[r][c]=0}
    else{
      grid[r][c]=n;
      if(n!==solution[r][c]){mistakes++;document.getElementById('mistakes').textContent=`Mistakes: ${mistakes}/3`;
        if(mistakes>=3){clearInterval(timerInterval);showModal('Game Over','Too many mistakes! Try again.')}
      } else {
        // Remove pencil marks in same row/col/box
        for(let i=0;i<9;i++){pencilMarks[r][i].delete(n);pencilMarks[i][c].delete(n)}
        let br=Math.floor(r/3)*3,bc=Math.floor(c/3)*3;
        for(let i=br;i<br+3;i++)for(let j=bc;j<bc+3;j++)pencilMarks[i][j].delete(n);
      }
      if(checkWin()){clearInterval(timerInterval);let m=Math.floor(seconds/60),s=seconds%60;showModal('You Win!',`Solved in ${m}m ${s}s with ${mistakes} mistake(s).`)}
    }
  }
  render();
}
function checkWin(){for(let r=0;r<9;r++)for(let c=0;c<9;c++)if(grid[r][c]!==solution[r][c])return false;return true}
function togglePencil(){pencilMode=!pencilMode;document.getElementById('btn-pencil').classList.toggle('active',pencilMode)}
function giveHint(){
  if(!selected)return;let[r,c]=selected;
  if(given[r][c]||grid[r][c]===solution[r][c])return;
  grid[r][c]=solution[r][c];pencilMarks[r][c].clear();render();
  if(checkWin()){clearInterval(timerInterval);let m=Math.floor(seconds/60),s=seconds%60;showModal('You Win!',`Solved in ${m}m ${s}s.`)}
}
function undoMove(){
  if(!history.length)return;
  let h=history.pop();grid[h.r][h.c]=h.prev;pencilMarks[h.r][h.c]=h.pencil;render();
}
function showModal(t,m){document.getElementById('modal-title').textContent=t;document.getElementById('modal-msg').textContent=m;document.getElementById('modal').classList.add('show')}
function closeModal(){document.getElementById('modal').classList.remove('show')}
// Build numpad
for(let n=1;n<=9;n++){let b=document.createElement('button');b.textContent=n;b.addEventListener('click',()=>placeNumber(n));numpadEl.appendChild(b)}
let eb=document.createElement('button');eb.textContent='Erase';eb.className='erase';eb.addEventListener('click',()=>placeNumber(0));numpadEl.appendChild(eb);
// Keyboard
document.addEventListener('keydown',e=>{
  if(e.key>='1'&&e.key<='9')placeNumber(+e.key);
  else if(e.key==='Backspace'||e.key==='Delete')placeNumber(0);
  else if(e.key==='ArrowUp'&&selected)selected=[Math.max(0,selected[0]-1),selected[1]],render();
  else if(e.key==='ArrowDown'&&selected)selected=[Math.min(8,selected[0]+1),selected[1]],render();
  else if(e.key==='ArrowLeft'&&selected)selected=[selected[0],Math.max(0,selected[1]-1)],render();
  else if(e.key==='ArrowRight'&&selected)selected=[selected[0],Math.min(8,selected[1]+1)],render();
});
newGame('medium');
</script>
</body>
</html>
