<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Typing Speed Test</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#1a1a2e;color:#e0e0e0;font-family:'Roboto Mono','Courier New',monospace;display:flex;flex-direction:column;align-items:center;min-height:100vh;padding:20px 16px;user-select:none;overflow-x:hidden}
h1{font-size:1.4rem;margin-bottom:6px;background:linear-gradient(135deg,#00cec9,#81ecec);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:2px;text-transform:uppercase}
.subtitle{font-size:.7rem;color:#555;margin-bottom:18px;letter-spacing:1px}
.tabs{display:flex;gap:6px;margin-bottom:18px}
.tab{background:transparent;border:none;color:#555;padding:6px 16px;border-radius:6px;cursor:pointer;font-size:.85rem;font-family:inherit;transition:all .15s}
.tab:hover{color:#aaa}
.tab.active{color:#00cec9;background:#00cec915}
.stats{display:flex;gap:24px;margin-bottom:16px;min-height:42px;align-items:flex-end}
.stat{text-align:center}
.stat .val{font-size:1.8rem;font-weight:700;color:#00cec9;line-height:1}
.stat .lbl{font-size:.6rem;color:#555;text-transform:uppercase;letter-spacing:1px;margin-top:2px}
.word-box{position:relative;width:100%;max-width:750px;padding:10px 4px;overflow:hidden;margin-bottom:18px;font-size:clamp(18px,3.5vw,24px);line-height:2.2em;height:calc(2.2em * 3 + 20px);cursor:text}
.word-wrap{position:absolute;left:4px;right:4px;transition:top .15s ease}
.word{display:inline-block;margin:0 .45em 0 0}
.word .letter{color:#555;transition:color .05s}
.word .letter.correct{color:#e0e0e0}
.word .letter.wrong{color:#e74c3c}
.word .letter.extra{color:#7f1d1d;font-size:.85em;opacity:.7}
.caret{position:absolute;width:2px;background:#00cec9;border-radius:1px;transition:left .08s ease,top .08s ease;z-index:5;animation:blink 1s step-end infinite}
@keyframes blink{50%{opacity:0}}
.typing .caret{animation:none;opacity:1}
#input{position:absolute;left:-9999px;opacity:0}
.overlay{display:none;position:fixed;inset:0;background:#1a1a2eee;z-index:10;align-items:center;justify-content:center;flex-direction:column;padding:20px}
.overlay.show{display:flex}
.result-card{background:#12122a;border:1px solid #333;border-radius:16px;padding:32px 40px;text-align:center;max-width:420px;width:100%}
.result-card h2{color:#00cec9;margin-bottom:20px;font-size:1.1rem;text-transform:uppercase;letter-spacing:2px}
.big-num{font-size:4rem;font-weight:800;color:#00cec9;line-height:1}
.big-label{font-size:.75rem;color:#555;text-transform:uppercase;letter-spacing:2px;margin-bottom:18px}
.result-stats{display:flex;gap:20px;justify-content:center;flex-wrap:wrap;margin-bottom:20px}
.result-stats .rs{text-align:center}
.result-stats .rs .rv{font-size:1.5rem;font-weight:700;color:#e0e0e0}
.result-stats .rs .rl{font-size:.6rem;color:#555;text-transform:uppercase}
.restart-btn{background:#00cec9;color:#0f0f1a;border:none;padding:10px 28px;border-radius:8px;cursor:pointer;font-size:.9rem;font-family:inherit;font-weight:600;transition:opacity .15s}
.restart-btn:hover{opacity:.85}
.hint{color:#444;font-size:.7rem;margin-top:10px}
.focus-msg{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:#1a1a2ecc;border-radius:12px;z-index:4;font-size:1rem;color:#555;cursor:pointer;backdrop-filter:blur(3px);transition:opacity .2s}
.focus-msg.hidden{opacity:0;pointer-events:none}
.mobile-focus{display:none;background:#1e1e3a;border:1px solid #444;color:#888;padding:8px 18px;border-radius:8px;cursor:pointer;font-size:.8rem;margin-bottom:10px;font-family:inherit}
@media(hover:none)and (pointer:coarse){.mobile-focus{display:inline-block}}
@media(max-width:500px){
  .stats{gap:14px}
  .stat .val{font-size:1.4rem}
  .result-card{padding:24px 20px}
  .big-num{font-size:3rem}
}
</style>
</head>
<body>
<h1>Typing Test</h1>
<div class="subtitle">Test your typing speed</div>

<div class="tabs" id="tabs">
  <button class="tab" data-t="15">15</button>
  <button class="tab" data-t="30">30</button>
  <button class="tab active" data-t="60">60</button>
  <button class="tab" data-t="120">120</button>
</div>

<div class="stats" id="statsbar">
  <div class="stat"><div class="val" id="liveWpm">-</div><div class="lbl">wpm</div></div>
  <div class="stat"><div class="val" id="liveAcc">-</div><div class="lbl">acc</div></div>
  <div class="stat"><div class="val" id="liveTime">60</div><div class="lbl">time</div></div>
</div>

<button class="mobile-focus" id="mobFocus">Tap to start typing</button>

<div class="word-box" id="wordBox">
  <div class="focus-msg" id="focusMsg">Click here or start typing to focus</div>
  <div class="caret" id="caret"></div>
  <div class="word-wrap" id="wordWrap"></div>
</div>

<input id="input" type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">

<div class="overlay" id="overlay">
  <div class="result-card">
    <h2>Results</h2>
    <div class="big-num" id="resWpm">0</div>
    <div class="big-label">words per minute</div>
    <div class="result-stats">
      <div class="rs"><div class="rv" id="resAcc">0%</div><div class="rl">accuracy</div></div>
      <div class="rs"><div class="rv" id="resRaw">0</div><div class="rl">raw wpm</div></div>
      <div class="rs"><div class="rv" id="resChars">0</div><div class="rl">correct/wrong/extra/missed</div></div>
      <div class="rs"><div class="rv" id="resTime">0s</div><div class="rl">time</div></div>
    </div>
    <button class="restart-btn" onclick="restart()">Try Again</button>
    <div class="hint">Tab + Enter to restart</div>
  </div>
</div>

<script>
const WORDS="the be to of and a in that have it for not on with he as you do at this but his by from they we say her she or an will my one all would there their what so up out if about who get which go me when make can like time no just him know take people into year your good some could them see other than then now look only come its over think also back after use two how our work first well way even new want because any these give day most us than being long find here thing many well large must between even never next old under cause much last live help after state again begin where own end move point world very still small home place around turn start same number might play small end large hand big spell write does set high even learn every near add food between few read over idea sometimes mountain cut real almost night far enough left eat right sea let thought hard long open begin life seem together ever children city tree cross head stand table short sure boat face watch base quite run land letter sit sometimes dear mother answer found study still learn should school world turn still most small own carry late real line feel girl usual young less good year work long any high day after thing give just name very come could show only round turn help next hand four keep point near old change why does off need house picture try us again animal point page letter mother answer found study world need same".split(" ");

let duration=60,words=[],wordEls=[];
let wIdx=0,lIdx=0;
let startTime=null,timerInt=null,finished=false;
let correctChars=0,wrongChars=0,extraChars=0,missedChars=0;
let rawCorrect=0,rawTotal=0;
let lineHeight=0,currentLine=0;
let typingTimeout=null;

const $=s=>document.getElementById(s);

function genWords(n){
  const arr=[];let prev='';
  for(let i=0;i<n;i++){
    let w;
    do{w=WORDS[Math.random()*WORDS.length|0]}while(w===prev);
    arr.push(w);prev=w;
  }
  return arr;
}

function render(){
  const wrap=$('wordWrap');
  wrap.innerHTML='';wordEls=[];
  words.forEach((w,wi)=>{
    const span=document.createElement('span');
    span.className='word';span.dataset.i=wi;
    for(let ci=0;ci<w.length;ci++){
      const ls=document.createElement('span');
      ls.className='letter';ls.textContent=w[ci];
      span.appendChild(ls);
    }
    wrap.appendChild(span);wordEls.push(span);
  });
  wrap.style.top='0px';currentLine=0;
  updateCaret();
}

function updateCaret(){
  const caret=$('caret'),box=$('wordBox');
  if(!wordEls[wIdx])return;
  const wordEl=wordEls[wIdx];
  const letters=wordEl.querySelectorAll('.letter');
  let target;
  if(lIdx<letters.length){target=letters[lIdx]}
  else if(letters.length>0){target=letters[letters.length-1]}
  if(!target)return;
  const boxRect=box.getBoundingClientRect();
  const tRect=target.getBoundingClientRect();
  if(lIdx>=letters.length){
    caret.style.left=(tRect.right-boxRect.left)+'px';
  }else{
    caret.style.left=(tRect.left-boxRect.left)+'px';
  }
  caret.style.top=(tRect.top-boxRect.top)+'px';
  caret.style.height=tRect.height+'px';

  if(!lineHeight)lineHeight=tRect.height;
  const wrapTop=parseFloat($('wordWrap').style.top||0);
  const wordTop=tRect.top-boxRect.top+Math.abs(wrapTop);
  const rowH=lineHeight*2.2;
  const line=Math.floor(wordTop/rowH+0.1);
  if(line>currentLine+1){
    currentLine=line-1;
    $('wordWrap').style.top=(-currentLine*rowH)+'px';
  }
}

function focusInput(){
  $('input').focus();$('focusMsg').classList.add('hidden');
}

$('wordBox').addEventListener('click',focusInput);
$('focusMsg').addEventListener('click',focusInput);
$('mobFocus').addEventListener('click',focusInput);
$('input').addEventListener('focus',()=>$('focusMsg').classList.add('hidden'));
$('input').addEventListener('blur',()=>{if(!finished)$('focusMsg').classList.remove('hidden')});

$('input').addEventListener('input',e=>{
  if(finished)return;
  if(!startTime)startTimer();
  setTyping();
  const val=$('input').value;
  lIdx=val.length;
  const wordEl=wordEls[wIdx],wordStr=words[wIdx];
  wordEl.querySelectorAll('.letter.extra').forEach(el=>el.remove());
  const baseLetters=wordEl.querySelectorAll('.letter:not(.extra)');
  for(let i=0;i<baseLetters.length;i++){
    baseLetters[i].className='letter';
    if(i<val.length)baseLetters[i].classList.add(val[i]===wordStr[i]?'correct':'wrong');
  }
  if(val.length>wordStr.length){
    for(let i=wordStr.length;i<val.length;i++){
      const ex=document.createElement('span');
      ex.className='letter extra wrong';ex.textContent=val[i];
      wordEl.appendChild(ex);
    }
  }
  updateCaret();updateLiveStats();
});

$('input').addEventListener('keydown',e=>{
  if(finished)return;
  if(e.key===' '){
    e.preventDefault();
    if(lIdx===0)return;
    if(!startTime)startTimer();
    setTyping();submitWord();return;
  }
  if(e.key==='Backspace'&&e.ctrlKey){
    e.preventDefault();
    $('input').value='';lIdx=0;
    const wordEl=wordEls[wIdx];
    wordEl.querySelectorAll('.letter.extra').forEach(el=>el.remove());
    wordEl.querySelectorAll('.letter').forEach(l=>l.className='letter');
    updateCaret();return;
  }
  if(e.key==='Tab'){e.preventDefault();restart();return;}
});

function submitWord(){
  const val=$('input').value,wordStr=words[wIdx];
  for(let i=0;i<wordStr.length;i++){
    rawTotal++;
    if(i<val.length&&val[i]===wordStr[i]){correctChars++;rawCorrect++}
    else if(i<val.length){wrongChars++}
    else{missedChars++}
  }
  extraChars+=Math.max(0,val.length-wordStr.length);
  rawTotal+=Math.max(0,val.length-wordStr.length);

  if(val!==wordStr){
    const baseLetters=wordEls[wIdx].querySelectorAll('.letter:not(.extra)');
    for(let i=val.length;i<baseLetters.length;i++)baseLetters[i].classList.add('wrong');
  }
  wIdx++;lIdx=0;$('input').value='';

  if(wIdx>=words.length-20){
    const nw=genWords(50);words.push(...nw);
    const wrap=$('wordWrap');
    nw.forEach((w,i)=>{
      const span=document.createElement('span');
      span.className='word';span.dataset.i=words.length-50+i;
      for(let ci=0;ci<w.length;ci++){
        const ls=document.createElement('span');
        ls.className='letter';ls.textContent=w[ci];
        span.appendChild(ls);
      }
      wrap.appendChild(span);wordEls.push(span);
    });
  }
  updateCaret();updateLiveStats();
}

function startTimer(){startTime=Date.now();timerInt=setInterval(tick,200)}

function tick(){
  if(finished||!startTime)return;
  const elapsed=(Date.now()-startTime)/1000;
  const remaining=Math.max(0,duration-elapsed);
  $('liveTime').textContent=Math.ceil(remaining);
  if(remaining<=0)endTest();
}

function updateLiveStats(){
  if(!startTime)return;
  const elapsed=(Date.now()-startTime)/1000;
  if(elapsed<1)return;
  const wpm=Math.round((correctChars/5)/(elapsed/60));
  const acc=rawTotal>0?Math.round((rawCorrect/rawTotal)*100):100;
  $('liveWpm').textContent=wpm;
  $('liveAcc').textContent=acc+'%';
}

function setTyping(){
  $('wordBox').classList.add('typing');
  clearTimeout(typingTimeout);
  typingTimeout=setTimeout(()=>$('wordBox').classList.remove('typing'),500);
}

function endTest(){
  finished=true;clearInterval(timerInt);
  const val=$('input').value;
  if(val.length>0){
    const wordStr=words[wIdx];
    for(let i=0;i<Math.min(val.length,wordStr.length);i++){
      rawTotal++;
      if(val[i]===wordStr[i]){correctChars++;rawCorrect++}else{wrongChars++}
    }
    extraChars+=Math.max(0,val.length-wordStr.length);
    rawTotal+=Math.max(0,val.length-wordStr.length);
  }
  const elapsed=Math.min((Date.now()-startTime)/1000,duration);
  const wpm=Math.round((correctChars/5)/(elapsed/60));
  const raw=Math.round(((correctChars+wrongChars+extraChars)/5)/(elapsed/60));
  const acc=rawTotal>0?Math.round((rawCorrect/rawTotal)*100):100;
  $('resWpm').textContent=wpm;
  $('resAcc').textContent=acc+'%';
  $('resRaw').textContent=raw;
  $('resChars').textContent=correctChars+'/'+wrongChars+'/'+extraChars+'/'+missedChars;
  $('resTime').textContent=Math.round(elapsed)+'s';
  $('overlay').classList.add('show');
  $('input').blur();
  const key='typing-best-'+duration;
  const prev=localStorage.getItem(key);
  if(!prev||wpm>+prev)localStorage.setItem(key,wpm);
}

function restart(){
  clearInterval(timerInt);finished=false;startTime=null;
  wIdx=0;lIdx=0;
  correctChars=0;wrongChars=0;extraChars=0;missedChars=0;
  rawCorrect=0;rawTotal=0;lineHeight=0;currentLine=0;
  $('input').value='';
  $('liveWpm').textContent='-';
  $('liveAcc').textContent='-';
  $('liveTime').textContent=duration;
  $('overlay').classList.remove('show');
  words=genWords(100);render();focusInput();
}

document.querySelectorAll('.tab').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');duration=+btn.dataset.t;restart();
  });
});

document.addEventListener('keydown',e=>{
  if(e.key==='Tab'&&$('overlay').classList.contains('show')){e.preventDefault();restart()}
  if(!finished&&e.key.length===1&&!e.ctrlKey&&!e.altKey&&!e.metaKey){
    if(document.activeElement!==$('input'))focusInput();
  }
});

restart();
</script>
</body>
</html>
