<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Minesweeper</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { width: 100%; height: 100%; overflow: auto; background: #1a1a2e; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #e0e0e0; }
        #header { display: flex; align-items: center; gap: 20px; margin-bottom: 10px; font-size: 18px; font-weight: bold; }
        #mines-left { color: #e74c3c; }
        #timer { color: #4ecca3; }
        #face { font-size: 28px; cursor: pointer; user-select: none; }
        #board { display: inline-grid; gap: 2px; background: #16213e; padding: 4px; border-radius: 8px; border: 2px solid #333; touch-action: manipulation; }
        .cell { width: var(--cell); height: var(--cell); display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: var(--font); border-radius: 3px; cursor: pointer; user-select: none; transition: background 0.1s; }
        .cell.hidden { background: #3a3a5c; }
        .cell.hidden:hover { background: #4a4a6c; }
        .cell.revealed { background: #252545; }
        .cell.mine { background: #e74c3c; }
        .cell.flagged::after { content: 'üö©'; }
        .c1 { color: #3b82f6; } .c2 { color: #4ecca3; } .c3 { color: #e74c3c; }
        .c4 { color: #6c5ce7; } .c5 { color: #ff9f43; } .c6 { color: #00cec9; }
        .c7 { color: #fff; } .c8 { color: #aaa; }
        #difficulty { display: flex; gap: 8px; margin-bottom: 10px; }
        #difficulty button { padding: 6px 16px; border: none; border-radius: 6px; background: #333; color: #ccc; cursor: pointer; font-size: 13px; }
        #difficulty button.active { background: #6c5ce7; color: #fff; }
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(0,0,0,0.7); z-index: 10; }
        #overlay h1 { font-size: 30px; color: #6c5ce7; margin-bottom: 10px; }
        #overlay p { color: #ccc; margin-bottom: 14px; font-size: 14px; }
        .btn { padding: 10px 28px; font-size: 16px; border: none; border-radius: 8px; background: #6c5ce7; color: #fff; cursor: pointer; font-weight: bold; }
        .btn:hover { background: #5a4bd1; }
        #result { display: none; font-size: 22px; margin-bottom: 8px; }
    </style>
</head>
<body>
    <div id="overlay">
        <h1>üí£ Minesweeper</h1>
        <p id="result"></p>
        <p>Left click to reveal, right click / long press to flag</p>
        <button class="btn" id="startBtn">Play</button>
    </div>
    <div id="difficulty">
        <button class="active" data-d="easy">Easy</button>
        <button data-d="medium">Medium</button>
        <button data-d="hard">Hard</button>
    </div>
    <div id="header">
        <span>üí£ <span id="mines-left">10</span></span>
        <span id="face" title="New Game">üòä</span>
        <span>‚è± <span id="timer">0</span></span>
    </div>
    <div id="board"></div>

    <script>
    (function() {
        const boardEl = document.getElementById('board');
        const minesLeftEl = document.getElementById('mines-left');
        const timerEl = document.getElementById('timer');
        const faceEl = document.getElementById('face');
        const overlay = document.getElementById('overlay');
        const startBtn = document.getElementById('startBtn');
        const resultEl = document.getElementById('result');

        const CONFIGS = {
            easy: {rows: 9, cols: 9, mines: 10},
            medium: {rows: 16, cols: 16, mines: 40},
            hard: {rows: 16, cols: 30, mines: 99}
        };

        let config, grid, revealed, flagged, mineSet, firstClick, gameOver, timerID, seconds;

        function setDifficulty(d) {
            config = CONFIGS[d];
            document.querySelectorAll('#difficulty button').forEach(b => b.classList.toggle('active', b.dataset.d === d));
            initGame();
        }

        function initGame() {
            const maxW = window.innerWidth - 20;
            const maxH = window.innerHeight - 120;
            const cellW = Math.floor(maxW / config.cols);
            const cellH = Math.floor(maxH / config.rows);
            const cell = Math.max(14, Math.min(36, cellW, cellH));
            document.documentElement.style.setProperty('--cell', cell + 'px');
            document.documentElement.style.setProperty('--font', Math.floor(cell * 0.55) + 'px');

            grid = Array.from({length: config.rows}, () => Array(config.cols).fill(0));
            revealed = Array.from({length: config.rows}, () => Array(config.cols).fill(false));
            flagged = Array.from({length: config.rows}, () => Array(config.cols).fill(false));
            mineSet = new Set();
            firstClick = true;
            gameOver = false;
            seconds = 0;
            clearInterval(timerID);
            timerEl.textContent = '0';
            minesLeftEl.textContent = config.mines;
            faceEl.textContent = 'üòä';

            boardEl.style.gridTemplateColumns = `repeat(${config.cols}, var(--cell))`;
            boardEl.innerHTML = '';

            for (let r = 0; r < config.rows; r++) {
                for (let c = 0; c < config.cols; c++) {
                    const el = document.createElement('div');
                    el.className = 'cell hidden';
                    el.dataset.r = r;
                    el.dataset.c = c;

                    el.addEventListener('click', () => handleClick(r, c));
                    el.addEventListener('contextmenu', e => { e.preventDefault(); toggleFlag(r, c); });

                    // Long press for mobile
                    let lp;
                    el.addEventListener('touchstart', e => { lp = setTimeout(() => { e.preventDefault(); toggleFlag(r, c); lp = -1; }, 400); }, {passive: false});
                    el.addEventListener('touchend', e => { if (lp === -1) { e.preventDefault(); } else { clearTimeout(lp); } });
                    el.addEventListener('touchmove', () => clearTimeout(lp));

                    boardEl.appendChild(el);
                }
            }
        }

        function placeMines(safeR, safeC) {
            const safe = new Set();
            for (let dr = -1; dr <= 1; dr++)
                for (let dc = -1; dc <= 1; dc++)
                    safe.add(`${safeR+dr},${safeC+dc}`);

            while (mineSet.size < config.mines) {
                const r = Math.floor(Math.random() * config.rows);
                const c = Math.floor(Math.random() * config.cols);
                const key = `${r},${c}`;
                if (!safe.has(key) && !mineSet.has(key)) {
                    mineSet.add(key);
                    grid[r][c] = -1;
                }
            }
            // Calculate numbers
            for (let r = 0; r < config.rows; r++)
                for (let c = 0; c < config.cols; c++)
                    if (grid[r][c] !== -1) {
                        let count = 0;
                        for (let dr = -1; dr <= 1; dr++)
                            for (let dc = -1; dc <= 1; dc++) {
                                const nr = r+dr, nc = c+dc;
                                if (nr >= 0 && nr < config.rows && nc >= 0 && nc < config.cols && grid[nr][nc] === -1) count++;
                            }
                        grid[r][c] = count;
                    }
        }

        function getCell(r, c) {
            return boardEl.children[r * config.cols + c];
        }

        function handleClick(r, c) {
            if (gameOver || flagged[r][c] || revealed[r][c]) return;
            if (firstClick) {
                firstClick = false;
                placeMines(r, c);
                timerID = setInterval(() => { seconds++; timerEl.textContent = seconds; }, 1000);
            }
            if (grid[r][c] === -1) {
                revealAll();
                faceEl.textContent = 'üòµ';
                getCell(r, c).style.background = '#c0392b';
                resultEl.textContent = 'üí• You hit a mine!';
                resultEl.style.display = 'block';
                resultEl.style.color = '#e74c3c';
                gameOver = true;
                clearInterval(timerID);
                setTimeout(() => overlay.style.display = 'flex', 800);
                startBtn.textContent = 'Play Again';
                return;
            }
            reveal(r, c);
            checkWin();
        }

        function reveal(r, c) {
            if (r < 0 || r >= config.rows || c < 0 || c >= config.cols) return;
            if (revealed[r][c] || flagged[r][c]) return;
            revealed[r][c] = true;
            const el = getCell(r, c);
            el.classList.remove('hidden');
            el.classList.add('revealed');
            if (grid[r][c] > 0) {
                el.textContent = grid[r][c];
                el.classList.add('c' + grid[r][c]);
            } else if (grid[r][c] === 0) {
                for (let dr = -1; dr <= 1; dr++)
                    for (let dc = -1; dc <= 1; dc++)
                        reveal(r+dr, c+dc);
            }
        }

        function toggleFlag(r, c) {
            if (gameOver || revealed[r][c]) return;
            flagged[r][c] = !flagged[r][c];
            const el = getCell(r, c);
            el.classList.toggle('flagged');
            const cnt = flagged.flat().filter(Boolean).length;
            minesLeftEl.textContent = config.mines - cnt;
        }

        function revealAll() {
            for (let r = 0; r < config.rows; r++)
                for (let c = 0; c < config.cols; c++) {
                    const el = getCell(r, c);
                    if (grid[r][c] === -1) {
                        el.classList.remove('hidden');
                        el.classList.add('mine');
                        el.textContent = 'üí£';
                    }
                }
        }

        function checkWin() {
            let unrevealed = 0;
            for (let r = 0; r < config.rows; r++)
                for (let c = 0; c < config.cols; c++)
                    if (!revealed[r][c]) unrevealed++;
            if (unrevealed === config.mines) {
                gameOver = true;
                clearInterval(timerID);
                faceEl.textContent = 'üòé';
                resultEl.textContent = 'üéâ You win! Time: ' + seconds + 's';
                resultEl.style.display = 'block';
                resultEl.style.color = '#4ecca3';
                startBtn.textContent = 'Play Again';
                setTimeout(() => overlay.style.display = 'flex', 600);
            }
        }

        // Events
        startBtn.addEventListener('click', () => { overlay.style.display = 'none'; resultEl.style.display = 'none'; initGame(); });
        faceEl.addEventListener('click', initGame);
        document.querySelectorAll('#difficulty button').forEach(b => b.addEventListener('click', () => setDifficulty(b.dataset.d)));

        setDifficulty('easy');
    })();
    </script>
</body>
</html>
