<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Clock - VtoolZ</title>
    <link rel="icon" href="../../favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .clock-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .clock-card {
            background: var(--surface-color);
            padding: 20px;
            border-radius: 10px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            position: relative;
            text-align: center;
        }

        .delete-clock {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1.2rem;
        }

        .delete-clock:hover {
            color: var(--danger-color);
        }

        .clock-time {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-color);
            font-family: monospace;
            margin: 10px 0;
        }

        .clock-date {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .add-clock-section {
            background: var(--bg-color);
            padding: 20px;
            border-radius: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
        }

        select {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid var(--border-color);
            min-width: 250px;
        }
    </style>
</head>

<body>
    <header>
        <div class="container">
            <a href="../../index.html" class="logo">VtoolZ</a>
            <nav>
                <ul>
                    <li><a href="../../index.html">Home</a></li>
                    <li><a href="index.html">Time Tools</a></li>
                    <li><a href="#" class="active">World Clock</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <div class="container tool-container">
            <h1>World Clock</h1>

            <div class="add-clock-section">
                <select id="timezoneSelect">
                    <option value="" disabled selected>Select a city...</option>
                    <!-- Options populated by JS -->
                </select>
                <button id="addClockBtn" class="btn btn-primary"><i class="fas fa-plus"></i> Add Clock</button>
            </div>

            <div class="clock-grid" id="clockGrid">
                <!-- Clocks will appear here -->
            </div>
        </div>
    </main>

    <script type="module">
        import '../../js/utils/common.js';

        // Timezones list
        const timezones = [
            "America/New_York", "America/Los_Angeles", "America/Chicago",
            "Europe/London", "Europe/Paris", "Europe/Berlin",
            "Asia/Tokyo", "Asia/Dubai", "Asia/Singapore",
            "Australia/Sydney", "Pacific/Auckland", "UTC"
        ];

        const select = document.getElementById('timezoneSelect');
        const grid = document.getElementById('clockGrid');
        const addBtn = document.getElementById('addClockBtn');

        // Populate Select
        timezones.sort().forEach(tz => {
            const option = document.createElement('option');
            option.value = tz;
            option.textContent = tz.replace('_', ' ');
            select.appendChild(option);
        });

        // Load Saved Clocks
        let savedClocks = JSON.parse(localStorage.getItem('vtoolz_clocks')) || ["America/New_York", "Europe/London", "Asia/Tokyo"];

        function saveClocks() {
            localStorage.setItem('vtoolz_clocks', JSON.stringify(savedClocks));
        }

        function renderClocks() {
            grid.innerHTML = '';
            savedClocks.forEach((tz, index) => {
                const card = document.createElement('div');
                card.className = 'clock-card';
                card.innerHTML = `
                    <button class="delete-clock" data-index="${index}">&times;</button>
                    <h3>${tz.split('/')[1].replace('_', ' ')}</h3>
                    <div class="clock-time" id="time-${index}">--:--</div>
                    <div class="clock-date" id="date-${index}">--</div>
                `;
                grid.appendChild(card);
            });

            // Re-attach listeners
            document.querySelectorAll('.delete-clock').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const idx = e.target.dataset.index;
                    savedClocks.splice(idx, 1);
                    saveClocks();
                    renderClocks();
                    updateTime(); // quick refresh
                });
            });
            updateTime();
        }

        function updateTime() {
            const now = new Date();
            savedClocks.forEach((tz, index) => {
                const timeEl = document.getElementById(`time-${index}`);
                const dateEl = document.getElementById(`date-${index}`);

                if (timeEl && dateEl) {
                    try {
                        const timeString = new Intl.DateTimeFormat('en-US', {
                            timeZone: tz,
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit',
                            hour12: true
                        }).format(now);

                        const dateString = new Intl.DateTimeFormat('en-US', {
                            timeZone: tz,
                            weekday: 'short',
                            month: 'short',
                            day: 'numeric'
                        }).format(now);

                        timeEl.textContent = timeString;
                        dateEl.textContent = dateString;
                    } catch (e) {
                        console.error("Timezone error", e);
                    }
                }
            });
        }

        addBtn.addEventListener('click', () => {
            const val = select.value;
            if (val && !savedClocks.includes(val)) {
                savedClocks.push(val);
                saveClocks();
                renderClocks();
            } else if (savedClocks.includes(val)) {
                alert("Clock already exists!");
            }
        });

        // Initialize
        renderClocks();
        setInterval(updateTime, 1000);

    </script>
</body>

</html>